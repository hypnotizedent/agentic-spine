# ═══════════════════════════════════════════════════════════════════════════
# Capability Registry - Governed actions the spine can execute
# ═══════════════════════════════════════════════════════════════════════════
#
# Each capability is an allowed action with:
#   - name: unique identifier
#   - command: what to run
#   - safety: read-only | mutating | destructive
#   - approval: auto | manual
#   - description: what it does
#
# Rule: Only capabilities listed here can be executed via `ops cap run`
# ═══════════════════════════════════════════════════════════════════════════

version: "1.0"
updated: "2026-02-07"

capabilities:

  # ─────────────────────────────────────────────────────────────────────────
  # SPINE HEALTH (always safe)
  # ─────────────────────────────────────────────────────────────────────────

  spine.verify:
    description: "Run drift gates to verify spine health"
    command: "./surfaces/verify/drift-gate.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  spine.replay:
    description: "Run replay test to verify determinism"
    command: "./surfaces/verify/replay-test.sh --compare"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  spine.status:
    description: "Show watcher and queue status"
    command: "./ops/runtime/inbox/agent-status.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  codex.worktree.status:
    description: "Check codex worktree hygiene (stale/dirty/orphaned/count)."
    command: "./surfaces/verify/d48-codex-worktree-hygiene.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  spine.watcher.status:
    description: "Canonical watcher status (launchd + PID + lock + queue counts)"
    command: "./ops/runtime/inbox/agent-status.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  spine.watcher.restart:
    description: "Restart the canonical launchd watcher (bootout + bootstrap)"
    command: "./ops/runtime/inbox/agent-restart.sh"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  loops.status:
    description: "Open loop ledger summary (open/closed counts)."
    command: "./ops/plugins/loops/bin/loops-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  loops.reconcile:
    description: "Reconcile stale run-failure loops with superseding pass receipts (conservative auto-close)."
    command: "./ops/plugins/loops/bin/loops-reconcile --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - loops.status
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # MONOLITH READ (safe exploration)
  # ─────────────────────────────────────────────────────────────────────────

  monolith.tree:
    description: "List directory structure of allowed paths"
    command: "ls -la"
    cwd: "$HOME/code"
    safety: read-only
    approval: auto
    args:
      - name: path
        required: false
        default: "."
        validate: "^[a-zA-Z0-9_./-]+$"
    outputs: ["stdout"]

  monolith.search:
    description: "Search code with ripgrep (exit=1 treated as OK: no matches)"
    command: "agentic-spine/ops/plugins/monolith/bin/monolith-search"
    cwd: "$HOME/code"
    safety: read-only
    approval: auto
    args:
      - name: pattern
        required: true
      - name: path
        required: false
        default: "."
    outputs: ["stdout"]

  monolith.git_status:
    description: "Show git status of a repo"
    command: "agentic-spine/ops/plugins/monolith/bin/monolith-git-status"
    cwd: "$HOME/code"
    safety: read-only
    approval: auto
    args:
      - name: repo
        required: false
        default: "agentic-spine"
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # N8N (workflow governance via API; receipted)
  # ─────────────────────────────────────────────────────────────────────────

  n8n.workflows.list:
    description: "List n8n workflows (read-only). Requires secrets injection for N8N_API_KEY."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  n8n.workflows.get:
    description: "Get a single n8n workflow by ID (read-only)."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows get"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]

  n8n.workflows.export:
    description: "Export a single n8n workflow to JSON (mutating: writes file)."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows export"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
      - name: output_file
        required: false
        default: ""
    outputs: ["stdout"]

  n8n.workflows.import:
    description: "Import a workflow JSON file (mutating)."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows import"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: input_file
        required: true
    outputs: ["stdout"]

  n8n.workflows.activate:
    description: "Activate a workflow (mutating)."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows activate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]

  n8n.workflows.deactivate:
    description: "Deactivate a workflow (mutating)."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows deactivate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]

  n8n.workflows.update:
    description: "Update a workflow from JSON file (mutating)."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows update"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
      - name: input_file
        required: true
    outputs: ["stdout"]

  n8n.workflows.delete:
    description: "Delete a workflow (destructive)."
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows delete"
    cwd: "$SPINE_CODE"
    safety: destructive
    approval: manual
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # INFRASTRUCTURE (read-only checks)
  # ─────────────────────────────────────────────────────────────────────────

  infra.docker_ps:
    description: "List running Docker containers"
    command: "docker ps --format 'table {{.Names}}\t{{.Status}}\t{{.Ports}}'"
    safety: read-only
    approval: auto
    outputs: ["stdout"]


  secrets.status:
    description: "Check secrets configuration presence (no values, no network). Fails if not configured."
    command: "./ops/plugins/secrets/bin/secrets-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]
  infra.gh_issue:
    description: "Get GitHub issue details"
    command: "gh issue view"
    safety: read-only
    approval: auto
    args:
      - name: issue_number
        required: true
        validate: "^[0-9]+$"
    outputs: ["stdout"]


  secrets.binding:
    description: "Print non-secret secrets provider binding (SSOT). STOP if incomplete."
    command: "./ops/plugins/secrets/bin/secrets-binding"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  secrets.auth.status:
    description: "Check secrets auth presence for Infisical (NO values). STOP if missing."
    command: "./ops/plugins/secrets/bin/secrets-auth-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  secrets.auth.load:
    description: "Validate Infisical Universal Auth creds file exists + perms; print one-liner to source it. Does NOT store secrets."
    command: "./ops/plugins/secrets/bin/secrets-auth-load"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  secrets.projects.status:
    description: "Compare SSOT inventory vs live Infisical projects. Reports parity deltas (names only, no secrets)."
    command: "./ops/plugins/secrets/bin/secrets-projects-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.inventory.status:
    description: "Read-only SSOT inventory (project names + counts). No network, no secrets values."
    command: "./ops/plugins/secrets/bin/secrets-inventory-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  secrets.namespace.status:
    description: "Read-only namespace hygiene for bound Infisical project (required key paths + root-path freeze regression check)."
    command: "./ops/plugins/secrets/bin/secrets-namespace-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p1.root_cleanup.status:
    description: "Dry-run guarded check for P1 root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p1.root_cleanup.execute:
    description: "Execute guarded P1 root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p2.copy_first.status:
    description: "Dry-run copy-first guard for P2 edge/network keys from root to /spine/network/edge."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/network/edge"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p2.copy_first.execute:
    description: "Execute copy-first for P2 edge/network keys from root to /spine/network/edge."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/network/edge --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p2.root_cleanup.status:
    description: "Dry-run guarded check for P2 root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/network/edge"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p2.root_cleanup.execute:
    description: "Execute guarded P2 root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/network/edge"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p3.copy_first.status:
    description: "Dry-run copy-first guard for P3 storage/NAS keys from root to /spine/storage/nas."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/storage/nas"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p3.copy_first.execute:
    description: "Execute copy-first for P3 storage/NAS keys from root to /spine/storage/nas."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/storage/nas --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p3.root_cleanup.status:
    description: "Dry-run guarded check for P3 root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/storage/nas"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p3.root_cleanup.execute:
    description: "Execute guarded P3 root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/storage/nas"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p4.copy_first.status:
    description: "Dry-run copy-first guard for P4 commerce/mail keys from root to /spine/integrations/commerce-mail."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/integrations/commerce-mail"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p4.copy_first.execute:
    description: "Execute copy-first for P4 commerce/mail keys from root to /spine/integrations/commerce-mail."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/integrations/commerce-mail --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p4.root_cleanup.status:
    description: "Dry-run guarded check for P4 root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/integrations/commerce-mail"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p4.root_cleanup.execute:
    description: "Execute guarded P4 root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/integrations/commerce-mail"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.immich.copy_first.status:
    description: "Dry-run copy-first guard for P5 Immich keys from root to /spine/services/immich."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/immich"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.immich.copy_first.execute:
    description: "Execute copy-first for P5 Immich keys from root to /spine/services/immich."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/immich --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.immich.root_cleanup.status:
    description: "Dry-run guarded check for P5 Immich root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/immich"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.immich.root_cleanup.execute:
    description: "Execute guarded P5 Immich root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/immich"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mail_archiver.copy_first.status:
    description: "Dry-run copy-first guard for P5 mail-archiver keys from root to /spine/services/mail-archiver."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mail-archiver"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mail_archiver.copy_first.execute:
    description: "Execute copy-first for P5 mail-archiver keys from root to /spine/services/mail-archiver."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mail-archiver --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mail_archiver.root_cleanup.status:
    description: "Dry-run guarded check for P5 mail-archiver root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/mail-archiver"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mail_archiver.root_cleanup.execute:
    description: "Execute guarded P5 mail-archiver root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/mail-archiver"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.finance.copy_first.status:
    description: "Dry-run copy-first guard for P5 finance keys from root to /spine/services/finance."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/finance"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.finance.copy_first.execute:
    description: "Execute copy-first for P5 finance keys from root to /spine/services/finance."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/finance --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.finance.root_cleanup.status:
    description: "Dry-run guarded check for P5 finance root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/finance"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.finance.root_cleanup.execute:
    description: "Execute guarded P5 finance root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/finance"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.paperless.copy_first.status:
    description: "Dry-run copy-first guard for P5 paperless keys from root to /spine/services/paperless."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/paperless"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.paperless.copy_first.execute:
    description: "Execute copy-first for P5 paperless keys from root to /spine/services/paperless."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/paperless --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.paperless.root_cleanup.status:
    description: "Dry-run guarded check for P5 paperless root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/paperless"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.paperless.root_cleanup.execute:
    description: "Execute guarded P5 paperless root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/paperless"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mcpjungle.copy_first.status:
    description: "Dry-run copy-first guard for P5 mcpjungle keys from root to /spine/services/mcpjungle."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mcpjungle"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mcpjungle.copy_first.execute:
    description: "Execute copy-first for P5 mcpjungle keys from root to /spine/services/mcpjungle."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mcpjungle --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mcpjungle.root_cleanup.status:
    description: "Dry-run guarded check for P5 mcpjungle root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/mcpjungle"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p5.mcpjungle.root_cleanup.execute:
    description: "Execute guarded P5 mcpjungle root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/mcpjungle"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p6.ai.copy_first.status:
    description: "Dry-run copy-first guard for P6 AI keys from root to /spine/ai/providers."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/ai/providers"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p6.ai.copy_first.execute:
    description: "Execute copy-first for P6 AI keys from root to /spine/ai/providers."
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/ai/providers --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p6.ai.root_cleanup.status:
    description: "Dry-run guarded check for P6 AI key root-path cleanup eligibility (no deletes)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/ai/providers"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.p6.ai.root_cleanup.execute:
    description: "Execute guarded P6 AI key root-path cleanup (delete only root copies after parity checks)."
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/ai/providers"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]

  secrets.cli.status:
    description: "Hash parity check: canonical (spine) vs vendored (workbench) infisical-agent.sh."
    command: "./ops/plugins/secrets/bin/secrets-cli-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # MEDIA (media stack governance)
  # ─────────────────────────────────────────────────────────────────────────

  recyclarr.sync:
    description: "Run Recyclarr sync on VM 209 to apply quality profile governance"
    command: "ssh ubuntu@100.107.36.76 'sudo docker exec recyclarr recyclarr sync'"
    safety: mutating
    approval: manual
    tags: [media, governance]
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # FUTURE: MUTATING (require manual approval)
  # ─────────────────────────────────────────────────────────────────────────


  secrets.exec:
    description: "Run a command with secrets injected (Infisical). Requires secrets.binding + secrets.auth.status OK."
    command: "./ops/plugins/secrets/bin/secrets-exec"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    outputs: ["stdout", "stderr"]
  # git.commit:
  #   description: "Create a git commit"
  #   command: "git commit -m"
  #   safety: mutating
  #   approval: manual
  #   args:
  #     - name: message
  #       required: true
  #   outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # CLOUDFLARE (read-only status checks)
  # ─────────────────────────────────────────────────────────────────────────

  cloudflare.status:
    description: "Read-only Cloudflare status (zones + DNS record counts; no values)."
    command: "./ops/plugins/cloudflare/bin/cloudflare-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  cloudflare.dns.status:
    description: "DNS record counts per bound zone (read-only)."
    command: "./ops/plugins/cloudflare/bin/cloudflare-dns-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  cloudflare.tunnel.status:
    description: "Tunnel inventory + creation timestamps for bound tunnels."
    command: "./ops/plugins/cloudflare/bin/cloudflare-tunnel-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  cloudflare.inventory.sync:
    description: "Verify cloudflare.inventory metadata matches live zones/tunnels."
    command: "./ops/plugins/cloudflare/bin/cloudflare-inventory-sync"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  cloudflare.tunnel.ingress.status:
    description: "Export Cloudflare tunnel ingress rules (hostname -> service)."
    command: "./ops/plugins/cloudflare/bin/cloudflare-tunnel-ingress-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  cloudflare.domain_routing.diff:
    description: "Diff Cloudflare tunnel ingress hostnames vs DOMAIN_ROUTING_REGISTRY (routing_layer=cloudflare_tunnel)."
    command: "./ops/plugins/cloudflare/bin/cloudflare-domain-routing-diff"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # GITHUB (read-only repo health)
  # ─────────────────────────────────────────────────────────────────────────

  github.status:
    description: "Read-only GitHub repo health (branch, HEAD, clean, tags)."
    command: "./ops/plugins/github/bin/github-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  github.queue.status:
    description: "GitHub queue counts (open PRs + open issues). Read-only, counts only."
    command: "./ops/plugins/github/bin/github-queue-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  github.actions.status:
    description: "GitHub Actions workflow run counts + latest conclusion. Read-only, no names/URLs."
    command: "./ops/plugins/github/bin/github-actions-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]

  github.labels.status:
    description: "GitHub label parity (declared vs live). Read-only, counts + delta."
    command: "./ops/plugins/github/bin/github-labels-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # SSH (read-only connectivity checks)
  # ─────────────────────────────────────────────────────────────────────────

  ssh.target.status:
    description: "Connectivity status for declared SSH targets (read-only, no prompts, no known_hosts writes)."
    command: "./ops/plugins/ssh/bin/ssh-target-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  nodes.status:
    description: "Node/VM reachability across Tier 1-3 estate (alias for ssh.target.status)."
    command: "./ops/plugins/ssh/bin/ssh-target-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # NETWORK (LAN-only device status, cutover preflight)
  # ─────────────────────────────────────────────────────────────────────────

  network.lan.device.status:
    description: "Ping check for LAN-only devices via probe_via host (no credentials, read-only)."
    command: "./ops/plugins/network/bin/network-lan-device-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  network.lan.host.identify:
    description: "Read-only: identify LAN host(s) via probe_via (ping + neigh + best-effort TCP/HTTP banner)."
    command: "./ops/plugins/network/bin/network-lan-host-identify"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  network.shop.audit.status:
    description: "Composite audit: shop network SSOT parity, duplicate IPs, and binding coverage (local files only)."
    command: "./ops/plugins/network/bin/network-shop-audit-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  network.oob.guard.status:
    description: "Read-only guard: verify shop LAN (iDRAC/switch/NVR) is reachable without relying on pve (subnet router safety gate)."
    command: "./ops/plugins/network/bin/network-oob-guard-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  network.cutover.preflight:
    description: "Composite pre-cutover verification (template, sequencing, companion changepack checks)."
    command: "./ops/plugins/network/bin/network-cutover-preflight"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    requires:
      - spine.verify
      - ssh.target.status
      - network.shop.audit.status
    outputs: ["stdout"]

  network.pve.post_cutover.harden:
    description: "Mutating: post-cutover hardening on pve (tailscale accept-routes off, DNS upstream fix, prune stale NFS exports)."
    command: "./ops/plugins/network/bin/network-pve-post-cutover-harden"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    requires:
      - ssh.target.status
    outputs: ["stdout"]

  network.md1400.pm8072.stage:
    description: "Mutating: stage persistent pm80xx binding for PM8072 (MD1400 path) on pve (fixes incorrect options pm80xx new_id=...)."
    command: "./ops/plugins/network/bin/network-md1400-pm8072-stage"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    requires:
      - ssh.target.status
    outputs: ["stdout"]

  network.md1400.bind_test:
    description: "Mutating: hot-bind PM8072 via sysfs new_id on pve with before/after evidence capture (lspci/dmesg/lsblk)."
    command: "./ops/plugins/network/bin/network-md1400-bind-test"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - ssh.target.status
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # PROXMOX MAINTENANCE (receipt-backed; guarded)
  # ─────────────────────────────────────────────────────────────────────────

  infra.proxmox.maintenance.precheck:
    description: "Read-only: capture guest state + MD1400/PM8072 evidence on a Proxmox host."
    command: "./ops/plugins/infra/bin/infra-proxmox-maintenance"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.proxmox.maintenance.shutdown:
    description: "Mutating: guarded shutdown of all running guests on a Proxmox host (optional host poweroff)."
    command: "./ops/plugins/infra/bin/infra-proxmox-maintenance"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    outputs: ["stdout"]

  infra.proxmox.maintenance.startup:
    description: "Mutating: start key guests on a Proxmox host, then print postcheck commands."
    command: "./ops/plugins/infra/bin/infra-proxmox-maintenance"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # DOCKER (read-only compose status)
  # ─────────────────────────────────────────────────────────────────────────

  docker.compose.status:
    description: "Read-only docker compose status per stack (no restarts, no deploys)."
    command: "./ops/plugins/docker/bin/docker-compose-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  docker.compose.logs:
    description: "Read-only: docker compose logs for a declared stack (WARNING: may include secrets)."
    command: "./ops/plugins/docker/bin/docker-compose-logs"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: manual
    outputs: ["stdout"]

  docker.compose.up:
    description: "Mutating: docker compose up -d for a declared stack."
    command: "./ops/plugins/docker/bin/docker-compose-up"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  docker.compose.down:
    description: "Mutating: docker compose down for a declared stack."
    command: "./ops/plugins/docker/bin/docker-compose-down"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  docker.compose.pull:
    description: "Mutating: docker compose pull for a declared stack."
    command: "./ops/plugins/docker/bin/docker-compose-pull"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # BACKUP (read-only inventory status)
  # ─────────────────────────────────────────────────────────────────────────

  # ─────────────────────────────────────────────────────────────────────────
  # SERVICES (read-only HTTP health probes)
  # ─────────────────────────────────────────────────────────────────────────

  services.health.status:
    description: "Read-only HTTP health probe for declared service endpoints (no auth, no verbose)."
    command: "./ops/plugins/services/bin/services-health-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  backup.status:
    description: "Read-only backup inventory status (file_glob only, freshness + reason codes)."
    command: "./ops/plugins/backup/bin/backup-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    # NOTE: No requires - script handles SSH errors per-target with reason codes.
    # Run ssh.target.status separately if you need pre-flight SSH connectivity check.
    outputs: ["stdout"]

  backup.vzdump.status:
    description: "Read-only: show vzdump job config and latest vzdump artifacts on pve."
    command: "./ops/plugins/backup/bin/backup-vzdump-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  backup.vzdump.vmid.set:
    description: "Mutating: update vmid list for vzdump job in /etc/pve/jobs.cfg (dry-run by default)."
    command: "./ops/plugins/backup/bin/backup-vzdump-vmid-set"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  backup.vzdump.run:
    description: "Mutating: trigger vzdump run on pve for selected VMIDs (dry-run by default)."
    command: "./ops/plugins/backup/bin/backup-vzdump-run"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  backup.vzdump.prune:
    description: "Mutating: prune vzdump backups on pve storage (dry-run by default; use --execute)."
    command: "./ops/plugins/backup/bin/backup-vzdump-prune"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # HOST (read-only home/config/entrypoint drift audit)
  # ─────────────────────────────────────────────────────────────────────────

  host.drift.audit:
    description: "Audit host-level drift across active configs, launchd entrypoints, and home output sinks."
    command: "./ops/plugins/host/bin/host-drift-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  host.claude.entrypoint.status:
    description: "Check Claude entrypoint compliance (shim, path case, forbidden headings)."
    command: "./ops/plugins/host/bin/host-claude-entrypoint-lock"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  host.claude.entrypoint.canonicalize:
    description: "Canonicalize Claude home files: rewrite CLAUDE.md to shim, fix path case."
    command: "./ops/plugins/host/bin/host-claude-entrypoint-lock --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  host.hidden.inventory.status:
    description: "Hidden-root inventory: classify all dot-entries under $HOME as managed/volatile/excluded/forbidden/unmanaged."
    command: "./ops/plugins/host/bin/host-hidden-root-inventory"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  host.macbook.drift.check:
    description: "Read-only: enforce MacBook drift invariants (Claude entrypoint + workbench verifier)."
    command: "./ops/plugins/host/bin/host-macbook-drift-check"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  host.macbook.managed_configs.apply:
    description: "Mutating: enforce managed config symlinks and canonicalize Claude entrypoint, then verify."
    command: "./ops/plugins/host/bin/host-macbook-managed-configs-apply"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # DOCS (workbench infrastructure extraction tracking)
  # ─────────────────────────────────────────────────────────────────────────

  docs.status:
    description: "Verify workbench infrastructure docs extraction integrity (file counts per dir)."
    command: "./ops/plugins/docs/bin/docs-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.extraction.status:
    description: "Track infrastructure extraction coverage into workbench (23 asset groups, % complete)."
    command: "./ops/plugins/docs/bin/infra-extraction-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  docs.lint:
    description: "Lint spine docs hierarchy: folder placement, metadata headers, README registration, legacy isolation."
    command: "./ops/plugins/docs/bin/docs-lint"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  mcp.inventory.status:
    description: "Validate workbench MCP inventory vs MCPJungle configs (read-only)."
    command: "./ops/plugins/mcp/bin/mcp-inventory-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # INFRA RELOCATION (read-only VM/service move governance)
  # ─────────────────────────────────────────────────────────────────────────

  infra.placement.policy:
    description: "Canonical placement policy check (site/hypervisor/vmid/service target enforcement)."
    command: "./ops/plugins/infra/bin/infra-placement-policy-check --check all"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.hypervisor.identity:
    description: "Verify proxmox host identity uniqueness (id/hostname/machine-id) to prevent wrong-host execution."
    command: "./ops/plugins/infra/bin/infra-hypervisor-identity-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.hypervisor.hostname.set:
    description: "Set canonical hostname for a proxmox host-id (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-hypervisor-hostname-set"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - infra.placement.policy
    outputs: ["stdout"]

  infra.timezone.set:
    description: "Set timezone + enable NTP on infrastructure hosts (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-timezone-set"
    cwd: "$SPINE_REPO"
    safety: mutating
    approval: manual
    outputs: ["stdout"]

  infra.relocation.preflight:
    description: "Pre-flight check: host reachability + health baseline for relocation manifest."
    command: "./ops/plugins/infra/bin/infra-relocation-preflight"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.relocation.parity:
    description: "Verify cross-SSOT parity + canonical placement policy for relocation manifest."
    command: "./ops/plugins/infra/bin/infra-relocation-parity"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.relocation.impact:
    description: "Print required docs/bindings/gates delta matrix for current relocation."
    command: "./ops/plugins/infra/bin/infra-relocation-impact"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.relocation.rollback.plan:
    description: "Generate deterministic rollback checklist and commands for current relocation."
    command: "./ops/plugins/infra/bin/infra-relocation-rollback"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  infra.vm.provision:
    description: "Provision Proxmox VM from relocation target/profile (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-vm-provision"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.preflight
      - infra.relocation.parity
    outputs: ["stdout"]

  infra.vm.bootstrap:
    description: "Bootstrap a provisioned VM to spine-ready profile baseline (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-vm-bootstrap"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.preflight
    outputs: ["stdout"]

  infra.relocation.state.transition:
    description: "Controlled relocation state transition + vm_targets status/IP update (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-relocation-state-transition"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.parity
    outputs: ["stdout"]

  infra.relocation.service.transition:
    description: "Controlled service status update within relocation manifest (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-relocation-service-transition"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.parity
    outputs: ["stdout"]

  infra.relocation.promote:
    description: "Promotion gate runner: validates promotion gates (tunnel, health, rollback; optional soak window), then promotes service from cutover to migrated with full gate verification (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-relocation-promote"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.parity
    outputs: ["stdout"]

  infra.proxmox.node_path.migrate:
    description: "Fix Proxmox node-name mismatch by migrating /etc/pve/nodes/<from> -> <to> on a hypervisor (dry-run by default, --execute to mutate)."
    command: "./ops/plugins/infra/bin/infra-proxmox-node-path-migrate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - infra.hypervisor.identity
    outputs: ["stdout"]

  infra.vm.ready.status:
    description: "Read-only readiness report for relocation VM target (running + ssh + tailscale + profile checks)."
    command: "./ops/plugins/infra/bin/infra-vm-ready-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────
  # BUDGET (read-only token budget diagnostics)
  # ─────────────────────────────────────────────────────────────

  budget.check:
    description: "Check token budget against a receipt (read-only diagnostic)."
    command: "./ops/plugins/budget/bin/budget"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # MAKER (digital-to-physical toolkit)
  # ─────────────────────────────────────────────────────────────────────────

  maker.tools.status:
    description: "Read-only maker tools inventory probe (installed/missing/hardware status)."
    command: "./ops/plugins/maker/bin/maker-tools-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

  maker.qr.generate:
    description: "Generate QR code (PNG/SVG/terminal) to mailroom/outbox/maker/."
    command: "./ops/plugins/maker/bin/maker-qr-generate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - maker.tools.status
    outputs: ["stdout"]

  maker.label.print:
    description: "Print label to Brother QL thermal printer (requires hardware)."
    command: "./ops/plugins/maker/bin/maker-label-print"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    requires:
      - maker.tools.status
    outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # AUDIT
  # ─────────────────────────────────────────────────────────────────────────

  audit.export.governance_iac:
    description: "Export repo tree + governance/IaC significant file contents for spine + workbench (redacted)"
    command: "./ops/plugins/audit/bin/audit-export"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    outputs: ["stdout"]

# ═══════════════════════════════════════════════════════════════════════════
# Safety Levels
# ═══════════════════════════════════════════════════════════════════════════
#
# read-only:   Cannot modify state. Safe to run autonomously.
# mutating:    Modifies state but is recoverable. Requires receipt.
# destructive: Cannot be undone. Requires manual approval + confirmation.
#
# ═══════════════════════════════════════════════════════════════════════════
