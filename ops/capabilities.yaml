# ═══════════════════════════════════════════════════════════════════════════
# Capability Registry - Governed actions the spine can execute
# ═══════════════════════════════════════════════════════════════════════════
#
# Each capability is an allowed action with:
#   - name: unique identifier
#   - command: what to run
#   - safety: read-only | mutating | destructive
#   - approval: auto | manual
#   - description: what it does
#   - plane: fabric | domain_external (optional classification)
#   - domain: <domain-name> | none (optional classification)
#   - implementation_repo: absolute repo root (optional)
#   - implementation_path: repo-relative implementation path (optional)
#
# Rule: Only capabilities listed here can be executed via `ops cap run`
# ═══════════════════════════════════════════════════════════════════════════

version: "1.0"
updated: "2026-02-21"
schema:
  optional_fields:
    - plane
    - domain
    - implementation_repo
    - implementation_path
  enums:
    plane:
      - fabric
      - domain_external
capabilities:
  # ─────────────────────────────────────────────────────────────────────────
  # SPINE HEALTH (always safe)
  # ─────────────────────────────────────────────────────────────────────────
  spine.verify:
    description: "Run drift gates to verify spine health"
    tags: [spine, verify]
    command: "./surfaces/verify/spine-verify.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.replay:
    description: "Run replay test to verify determinism"
    tags: [spine, verify]
    command: "./surfaces/verify/replay-test.sh --compare"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.status:
    description: "Show watcher and queue status"
    tags: [spine]
    command: "./ops/runtime/inbox/agent-status.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.briefing:
    description: "Generate unified daily briefing (stability, work, verify, calendar, alerts, handoffs)."
    tags: [spine, briefing, situational-awareness]
    command: "./ops/plugins/briefing/bin/spine-briefing"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/outbox/briefing/*"]
    domain: none
    plane: fabric
  spine.control.tick:
    description: "Read-only control-plane aggregation across loops/gaps/proposals/calendar/alerts/handoffs/timeline/verify signals."
    tags: [spine, control-plane, orchestration, situational-awareness]
    command: "./ops/plugins/evidence/bin/spine-control tick"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.control.plan:
    description: "Read-only prioritized next-action queue with deterministic route targets (capability vs agent tool)."
    tags: [spine, control-plane, orchestration, planning]
    command: "./ops/plugins/evidence/bin/spine-control plan"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.control.execute:
    description: "Mutating/manual execution of selected control-plan actions with receipt linkage and control-plane latest artifact output."
    tags: [spine, control-plane, orchestration, execution]
    command: "./ops/plugins/evidence/bin/spine-control execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout", "mailroom/outbox/operations/*"]
    domain: none
    plane: fabric
  spine.control.cycle:
    description: "Mutating/manual autonomous observe-plan-act cycle: executes capability actions and delegates agent_tool routes into governed mailroom tasks."
    tags: [spine, control-plane, orchestration, autonomy]
    command: "./ops/plugins/evidence/bin/spine-control cycle"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout", "mailroom/outbox/operations/*"]
    domain: none
    plane: fabric
  spine.terminal.launch:
    description: "Lane-aware terminal launcher — list lanes/loops and launch terminals with profile selection."
    tags: [spine, terminal, launcher, lane]
    command: "./ops/commands/terminal-launch.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.work.index:
    description: "Unified runtime work index over gaps, loop scopes, and proposals with optional domain filter."
    tags: [spine, work, index, loops, gaps, proposals]
    command: "./ops/plugins/work-index/bin/work-index"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  codex.worktree.status:
    description: "Check codex worktree hygiene (stale/dirty/orphaned/count)."
    tags: [spine]
    command: "./surfaces/verify/d48-codex-worktree-hygiene.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.watcher.status:
    description: "Canonical watcher status (launchd + PID + lock + queue counts)"
    tags: [spine]
    command: "./ops/runtime/inbox/agent-status.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.watcher.restart:
    description: "Restart the canonical launchd watcher (bootout + bootstrap)"
    tags: [spine]
    command: "./ops/runtime/inbox/agent-restart.sh"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # MAILROOM BRIDGE (remote read/write API)
  # ─────────────────────────────────────────────────────────────────────────
  mailroom.bridge.status:
    description: "Read-only: show mailroom bridge server status (PID + /health)."
    tags: [mailroom]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-bridge-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.bridge.start:
    description: "Mutating: start mailroom bridge server (binds per ops/bindings/mailroom.bridge.yaml)."
    tags: [mailroom]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-bridge-start"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.bridge.stop:
    description: "Mutating: stop mailroom bridge server."
    tags: [mailroom]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-bridge-stop"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.bridge.expose.status:
    description: "Read-only: show tailnet exposure status for mailroom bridge (tailscale serve + health)."
    tags: [mailroom]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-bridge-expose-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.bridge.expose.enable:
    description: "Mutating: expose mailroom bridge to tailnet via tailscale serve (requires bridge running)."
    tags: [mailroom]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-bridge-expose-enable"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.bridge.expose.disable:
    description: "Mutating: disable tailnet exposure for mailroom bridge (safe only if serve config is exclusive)."
    tags: [mailroom]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-bridge-expose-disable"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.enqueue:
    description: "Governed task lifecycle: enqueue task payload under $SPINE_STATE/agent-tasks/queued."
    tags: [mailroom, bridge, tasks]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-enqueue"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.claim:
    description: "Governed task lifecycle: claim queued task into running with optional strict agent health preflight."
    tags: [mailroom, bridge, tasks]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-claim"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.heartbeat:
    description: "Governed task lifecycle: update heartbeat/progress for a running task."
    tags: [mailroom, bridge, tasks]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-heartbeat"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.complete:
    description: "Governed task lifecycle: mark running task complete and archive under done."
    tags: [mailroom, bridge, tasks]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-complete"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.fail:
    description: "Governed task lifecycle: mark running task failed and archive under failed."
    tags: [mailroom, bridge, tasks]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-fail"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.worker.start:
    description: "Start autonomous mailroom task worker daemon (spine.control.cycle cadence + task lifecycle consumption)."
    tags: [mailroom, bridge, tasks, autonomy]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-worker --daemon"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.worker.stop:
    description: "Stop autonomous mailroom task worker daemon."
    tags: [mailroom, bridge, tasks, autonomy]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-worker --stop"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.worker.status:
    description: "Read autonomous mailroom task worker status, last tick, and runtime paths."
    tags: [mailroom, bridge, tasks, autonomy]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-worker --status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mailroom.task.worker.once:
    description: "Run one autonomous worker tick (control cycle + task consumption) in foreground."
    tags: [mailroom, bridge, tasks, autonomy]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-task-worker --once"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  calendar.generate:
    description: "Generate canonical global/per-layer ICS artifacts from calendar.global binding."
    tags: [calendar]
    command: "./ops/plugins/calendar/bin/calendar-generate"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: ms-graph
    plane: fabric
  calendar.operator.surface:
    description: "Build operator-facing calendar surface artifacts (today + operator index) from existing calendar outputs."
    tags: [calendar]
    command: "./ops/plugins/calendar/bin/calendar-operator-surface"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: ms-graph
    plane: fabric
  calendar.status:
    description: "Validate calendar.global binding and report generated artifact freshness."
    tags: [calendar]
    command: "./ops/plugins/calendar/bin/calendar-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: ms-graph
    plane: fabric
  calendar.sync.plan:
    description: "Read-only planner: output intended calendar pull/push actions using graph.calendar contracts."
    tags: [calendar]
    command: "./ops/plugins/calendar/bin/calendar-sync-plan"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: ms-graph
    plane: fabric
  calendar.sync.execute:
    description: "Mutating calendar sync executor with lock/state/idempotency contract for spine/external authority lanes."
    tags: [calendar]
    command: "./ops/plugins/calendar/bin/calendar-sync-execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  loops.status:
    description: "Open loop ledger summary (open/closed counts)."
    tags: [loops]
    command: "./ops/plugins/loops/bin/loops-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  gaps.status:
    description: "Gap-loop reconciliation: list open gaps, check parent loop status, flag orphans."
    tags: [loops, gaps]
    command: "./ops/plugins/loops/bin/gaps-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  gaps.claim:
    description: "Claim a gap for exclusive work. Prevents concurrent agents from working on the same gap."
    tags: [loops, gaps, claims]
    command: "./ops/plugins/loops/bin/gaps-claim"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  gaps.unclaim:
    description: "Release a gap claim. Only the owning process (or stale-recovery) can release."
    tags: [loops, gaps, claims]
    command: "./ops/plugins/loops/bin/gaps-unclaim"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  gaps.file:
    description: "Create a new gap entry in the registry. Atomic: acquires git-lock, appends, commits."
    tags: [loops, gaps]
    command: "./ops/plugins/loops/bin/gaps-file"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  gaps.close:
    description: "Close or fix a gap. Atomic: acquires git-lock, validates claim, updates status, commits."
    tags: [loops, gaps]
    command: "./ops/plugins/loops/bin/gaps-close"
    cwd: "$SPINE_CODE"
    safety: destructive
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # LIFECYCLE (gap/loop lifecycle automation)
  # ─────────────────────────────────────────────────────────────────────────
  gaps.quick:
    description: "One-liner gap filing with auto-generated ID and defaults from lifecycle.rules.yaml."
    tags: [lifecycle, gaps]
    command: "./ops/plugins/lifecycle/bin/gaps-quick"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  loops.progress:
    description: "Show gap-level progress for a loop (linked gap counts, completion percentage)."
    tags: [lifecycle, loops]
    command: "./ops/plugins/lifecycle/bin/loops-progress"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  loops.auto.close:
    description: "Auto-close loops whose linked gaps are all resolved."
    tags: [lifecycle, loops]
    command: "./ops/plugins/lifecycle/bin/loops-auto-close"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  gaps.aging:
    description: "Report on aging open gaps with configurable warning/critical thresholds."
    tags: [lifecycle, gaps]
    command: "./ops/plugins/lifecycle/bin/gaps-aging"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  lifecycle.health:
    description: "Composite lifecycle dashboard: gap summary, aging, loop progress, orphan check."
    tags: [lifecycle, gaps, loops]
    command: "./ops/plugins/lifecycle/bin/lifecycle-health"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  loops.create:
    description: "Create a new loop scope file from template with auto-generated ID."
    tags: [lifecycle, loops]
    command: "./ops/plugins/lifecycle/bin/loops-create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  gaps.batch.close:
    description: "Close all open gaps linked to a loop in one command."
    tags: [lifecycle, gaps]
    command: "./ops/plugins/lifecycle/bin/gaps-batch-close"
    cwd: "$SPINE_CODE"
    safety: destructive
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  lane.standard.run:
    description: "One-command ceremony runner: snapshot, core verify, domain verify, status checks, with markdown report."
    tags: [lifecycle, ceremony, verify]
    command: "./ops/plugins/lifecycle/bin/lane-standard-run"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "file"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # ORCHESTRATION (machine-enforced loop orchestration)
  # ─────────────────────────────────────────────────────────────────────────
  orchestration.loop.open:
    description: "Create an orchestration manifest and lane scaffold for a loop."
    tags: [orchestration, loops]
    command: "./ops/plugins/orchestration/bin/orchestration-loop-open"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  orchestration.ticket.issue:
    description: "Issue a worker-lane ticket with assigned branch/worker metadata."
    tags: [orchestration, loops]
    command: "./ops/plugins/orchestration/bin/orchestration-ticket-issue"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  orchestration.handoff.validate:
    description: "Validate lane handoff against manifest policy (branch/base/files/sequence)."
    tags: [orchestration, loops]
    command: "./ops/plugins/orchestration/bin/orchestration-handoff-validate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  orchestration.integrate:
    description: "Integrate a validated lane commit into main (dry-run default; --apply to mutate)."
    tags: [orchestration, loops]
    command: "./ops/plugins/orchestration/bin/orchestration-integrate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  orchestration.loop.close:
    description: "Close an orchestration loop after all sequence lanes are integrated."
    tags: [orchestration, loops]
    command: "./ops/plugins/orchestration/bin/orchestration-loop-close"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  orchestration.status:
    description: "Show orchestration loop/ticket/validation/integration status."
    tags: [orchestration, loops]
    command: "./ops/plugins/orchestration/bin/orchestration-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  orchestration.terminal.entry:
    description: "Resolve strict per-lane orchestration worktree context for launcher sessions."
    tags: [orchestration, loops]
    command: "./ops/plugins/orchestration/bin/orchestration-terminal-entry"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "env"]
    domain: loop_gap
    plane: fabric

  # ─────────────────────────────────────────────────────────────────────────
  # WAVE ORCHESTRATION (lane-aware multi-terminal coordination)
  # ─────────────────────────────────────────────────────────────────────────
  orchestration.wave.start:
    description: "Create a new wave with objective for multi-terminal coordination."
    tags: [orchestration, wave]
    command: "./ops/plugins/orchestration/bin/orchestration-wave start"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.wave.dispatch:
    description: "Dispatch a task to a specific lane within an active wave."
    tags: [orchestration, wave]
    command: "./ops/plugins/orchestration/bin/orchestration-wave dispatch"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.wave.collect:
    description: "Collect and display results from all lanes in a wave."
    tags: [orchestration, wave]
    command: "./ops/plugins/orchestration/bin/orchestration-wave collect"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.wave.ack:
    description: "Acknowledge a dispatched task completion with result and run key."
    tags: [orchestration, wave]
    command: "./ops/plugins/orchestration/bin/orchestration-wave ack"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.wave.status:
    description: "Show status of a wave including lanes, dispatches, and watcher checks."
    tags: [orchestration, wave]
    command: "./ops/plugins/orchestration/bin/orchestration-wave status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.wave.close:
    description: "Close a wave, generate merge receipt with run keys and residual blockers."
    tags: [orchestration, wave]
    command: "./ops/plugins/orchestration/bin/orchestration-wave close"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.lane.list:
    description: "List available lane profiles with write scopes and permissions."
    tags: [orchestration, lane]
    command: "./ops/plugins/orchestration/bin/orchestration-lane list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.lane.open:
    description: "Open a lane with write-scope enforcement for a terminal."
    tags: [orchestration, lane]
    command: "./ops/plugins/orchestration/bin/orchestration-lane open"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.lane.status:
    description: "Show all open lanes with terminal assignments and permissions."
    tags: [orchestration, lane]
    command: "./ops/plugins/orchestration/bin/orchestration-lane status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.preflight.fast:
    description: "Fast non-blocking preflight (<=120s) with go/no-go verdict and blockers."
    tags: [orchestration, preflight]
    command: "./ops/plugins/orchestration/bin/orchestration-preflight-fast"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.watcher.enqueue:
    description: "Enqueue long-running checks to watcher lane (stability, verify, pack)."
    tags: [orchestration, watcher]
    command: "./ops/plugins/orchestration/bin/orchestration-watcher enqueue"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.watcher.status:
    description: "Show status of background watcher checks across active waves."
    tags: [orchestration, watcher]
    command: "./ops/plugins/orchestration/bin/orchestration-watcher status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  orchestration.wave.receipt.validate:
    description: "Validate an EXEC_RECEIPT JSON artifact against the canonical schema."
    tags: [orchestration, wave, receipt]
    command: "./ops/plugins/orchestration/bin/orchestration-wave receipt-validate"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric

  session.handoff.create:
    description: "Create a cross-session handoff artifact for active loop execution."
    tags: [session, handoff, loops]
    command: "./ops/plugins/handoff/bin/session-handoff-create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/state/handoffs/*"]
    domain: none
    plane: fabric
  session.handoff.get:
    description: "Read a specific session handoff artifact by ID."
    tags: [session, handoff, loops]
    command: "./ops/plugins/handoff/bin/session-handoff-get"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  session.handoff.list:
    description: "List handoff artifacts filtered by lifecycle state."
    tags: [session, handoff, loops]
    command: "./ops/plugins/handoff/bin/session-handoff-list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  session.handoff.close:
    description: "Close an active handoff with a resolution note."
    tags: [session, handoff, loops]
    command: "./ops/plugins/handoff/bin/session-handoff-close"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/state/handoffs/*"]
    domain: none
    plane: fabric
  session.handoff.expire:
    description: "Expire stale active handoffs whose TTL has elapsed."
    tags: [session, handoff, loops]
    command: "./ops/plugins/handoff/bin/session-handoff-expire"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/state/handoffs/*"]
    domain: none
    plane: fabric
  session.handoff.status:
    description: "Show handoff dashboard counts (active/closed/expired)."
    tags: [session, handoff, loops]
    command: "./ops/plugins/handoff/bin/session-handoff-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # SESSION (terminal session traceability)
  # ─────────────────────────────────────────────────────────────────────────
  session.start:
    description: "Initialize a governed spine session. Defaults to fast startup with no args; supports full mode and lane-based session wiring."
    tags: [session, startup]
    command: "./ops/plugins/session/bin/session-start"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "env"]
    domain: none
    plane: fabric
  terminal.heartbeat.post:
    description: "Write terminal heartbeat evidence for scope ownership and collision checks."
    tags: [session, stabilization]
    command: "./ops/plugins/session/bin/terminal-heartbeat-post"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  terminal.scope.status:
    description: "Read active terminal heartbeats and detect overlapping write scopes."
    tags: [session, stabilization]
    command: "./ops/plugins/session/bin/terminal-scope-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  terminal.contract.status:
    description: "Validate terminal role contract completeness, freshness, and cross-reference parity."
    tags: [session, stabilization, governance]
    command: "./ops/plugins/session/bin/terminal-contract-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  loops.reconcile:
    description: "Reconcile stale run-failure loops with superseding pass receipts (conservative auto-close)."
    tags: [loops]
    command: "./ops/plugins/loops/bin/loops-reconcile --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - loops.status
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # MONOLITH READ (safe exploration)
  # ─────────────────────────────────────────────────────────────────────────
  monolith.tree:
    description: "List directory structure of allowed paths"
    tags: [monolith]
    command: "ls -la"
    cwd: "$HOME/code"
    safety: read-only
    approval: auto
    lifecycle: ready
    args:
      - name: path
        required: false
        default: "."
        validate: "^[a-zA-Z0-9_./-]+$"
    outputs: ["stdout"]
    domain: none
    plane: fabric
  monolith.search:
    description: "Search code with ripgrep (exit=1 treated as OK: no matches)"
    tags: [monolith]
    command: "agentic-spine/ops/plugins/monolith/bin/monolith-search"
    cwd: "$HOME/code"
    safety: read-only
    approval: auto
    lifecycle: ready
    args:
      - name: pattern
        required: true
      - name: path
        required: false
        default: "."
    outputs: ["stdout"]
    domain: none
    plane: fabric
  monolith.git_status:
    description: "Show git status of a repo"
    tags: [monolith]
    command: "agentic-spine/ops/plugins/monolith/bin/monolith-git-status"
    cwd: "$HOME/code"
    safety: read-only
    approval: auto
    lifecycle: ready
    args:
      - name: repo
        required: false
        default: "agentic-spine"
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # N8N (workflow governance via API; receipted)
  # default classification: plane=domain_external, domain=n8n
  # ─────────────────────────────────────────────────────────────────────────
  n8n.workflows.list:
    description: "List n8n workflows (read-only). Requires secrets injection for N8N_API_KEY."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  n8n.workflows.get:
    description: "Get a single n8n workflow by ID (read-only)."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows get"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.export:
    description: "Export a single n8n workflow to JSON (mutating: writes file)."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows export"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
      - name: output_file
        required: false
        default: ""
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.import:
    description: "Import a workflow JSON file (mutating)."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows import"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: input_file
        required: true
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.activate:
    description: "Activate a workflow (mutating)."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows activate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.deactivate:
    description: "Deactivate a workflow (mutating)."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows deactivate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.update:
    description: "Update a workflow from JSON file (mutating)."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows update"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
      - name: input_file
        required: true
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.delete:
    description: "Delete a workflow (destructive)."
    tags: [n8n]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows delete"
    cwd: "$SPINE_CODE"
    safety: destructive
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: workflow_id
        required: true
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.snapshot:
    description: "Export all n8n workflows to a timestamped snapshot directory via API."
    tags: [n8n, backup]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-workflows export-all"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: output_dir
        required: false
        default: ""
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.workflows.snapshot.status:
    description: "Check n8n workflow snapshot artifacts on automation-stack (SSH)."
    tags: [n8n, backup]
    command: "./ops/plugins/n8n/bin/n8n-snapshot-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    outputs: ["stdout"]
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/tools/src/
  n8n.infra.health:
    description: "n8n infra reliability lane check: uptime + API auth + snapshot freshness + backup coverage."
    tags: [n8n, infra, health, backup]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/n8n/bin/n8n-infra-health"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  n8n.infra.health.quick:
    description: "Low-latency n8n reliability probe for control loops: uptime + snapshot + backup coverage (skips API auth)."
    tags: [n8n, infra, health, backup, control-plane]
    command: "env N8N_INFRA_SKIP_API_AUTH=true ./ops/plugins/n8n/bin/n8n-infra-health"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: n8n
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/n8n/
    touches_api: false
    outputs: ["stdout"]
  # ─────────────────────────────────────────────────────────────────────────
  # INFRASTRUCTURE (read-only checks)
  # ─────────────────────────────────────────────────────────────────────────
  infra.docker_ps:
    description: "List running Docker containers"
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-docker-ps"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  spine.ripple.check:
    description: "List all binding/SSOT files referencing a given host (mutation impact check)"
    tags: [infra, spine]
    command: "./ops/plugins/infra/bin/ripple-check"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  vm.governance.audit:
    description: "Read-only VM lifecycle governance coverage report (cross-file parity check)"
    tags: [infra, vm, governance]
    command: "./ops/plugins/vm/bin/vm-governance-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  vm.profile.audit:
    description: "Read-only VM operating profile parity check (every active VM has valid profile)"
    tags: [infra, vm, governance]
    command: "./ops/plugins/vm/bin/vm-profile-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  authority.project.status:
    description: "Read-only check: verify a product repo follows spine project-governance baseline."
    tags: [authority, governance, repos]
    command: "./ops/plugins/authority/bin/project-governance-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  authority.project.bootstrap:
    description: "Bootstrap/align a product repo to spine governance baseline (dry-run by default, --execute to mutate)."
    tags: [authority, governance, repos]
    command: "./ops/plugins/authority/bin/project-governance-bootstrap"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.drift_gates.certify:
    description: "Fast drift gate inventory/certification report (supports --profile, --list-domains, --domain <name>, --brief)"
    tags: [verify]
    command: "./ops/plugins/verify/bin/drift-gates-certify"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.drift_gates.failure_stats:
    description: "Analyze historical spine.verify receipts: per-gate fail counts and co-failure pairs"
    tags: [verify]
    command: "./ops/plugins/verify/bin/drift-gates-failure-stats"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  policy.autotune.weekly:
    description: "Read-only weekly policy autotune collector: soak, churn, queue friction, release quality, and recommendations."
    tags: [verify, policy, aof]
    command: "./ops/plugins/verify/bin/policy-autotune-weekly"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/outbox/reports/policy-autotune/*"]
    domain: aof
    plane: fabric
  policy.autotune.propose:
    description: "Mutating autotune proposer: submits policy recommendation proposal(s) only. Never applies."
    tags: [verify, policy, proposals, aof]
    command: "./ops/plugins/verify/bin/policy-autotune-propose"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/outbox/reports/policy-autotune/*", "mailroom/outbox/proposals/*"]
    domain: aof
    plane: fabric
  verify.core.run:
    description: "Run Core-8 transition gates (day-to-day deterministic preflight, <60s, no network)."
    tags: [verify, fast, session-start]
    command: "./ops/plugins/verify/bin/verify-topology core"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.fast:
    description: "Alias for verify.core.run — fast session-start verify (core-8 only, <60s, no network calls)."
    tags: [verify, fast, session-start]
    command: "./ops/plugins/verify/bin/verify-topology core"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.domain.run:
    description: "Integration/debug/certification lane (not default day lane). Use verify.pack.run for day-to-day."
    tags: [verify]
    command: "./ops/plugins/verify/bin/verify-topology domain"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.release.run:
    description: "Run release/nightly full certification (core + all domains via spine drift suite)."
    tags: [verify]
    command: "./ops/plugins/verify/bin/verify-topology release"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.route.recommend:
    description: "Recommend pack-run lane from changed paths/capabilities using topology path_triggers and prefixes."
    tags: [verify]
    command: "./ops/plugins/verify/bin/verify-topology recommend"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.vertical_integration.parity_status:
    description: "Read-only parity status for mint pricing/suppliers surfaces (code, runtime, endpoint, MCP, docs/contracts)."
    tags: [verify, mint]
    command: "./ops/plugins/verify/bin/vertical-integration-parity-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.pack.list:
    description: "List available verify packs (agent-scoped + domain packs) and default pack."
    tags: [verify]
    command: "./ops/plugins/verify/bin/verify-pack list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.pack.run:
    description: "Run scoped verify pack by agent_id or domain (pack-first day-to-day verify)."
    tags: [verify]
    command: "./ops/plugins/verify/bin/verify-pack run"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  verify.pack.explain:
    description: "Explain which gates a verify pack executes and how they map to scripts."
    tags: [verify]
    command: "./ops/plugins/verify/bin/verify-pack explain"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  gate.topology.validate:
    description: "Validate gate.execution.topology contract integrity and domain assignment completeness."
    tags: [verify, governance]
    command: "./ops/plugins/verify/bin/gate-topology-validate"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  gate.topology.assign:
    description: "Assign or update gate -> domain ownership in topology contract."
    tags: [verify, governance]
    command: "./ops/plugins/verify/bin/gate-topology-assign"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  gate.registry.add:
    description: "Add a new gate to gate.registry.yaml through governed mutation surface."
    tags: [verify, governance]
    command: "./ops/plugins/verify/bin/gate-registry-add"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  gate.registry.update:
    description: "Update existing gate metadata through governed mutation surface."
    tags: [verify, governance]
    command: "./ops/plugins/verify/bin/gate-registry-update"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  gate.mutation.trailers:
    description: "Generate D128-compliant Gate-* commit trailers for gate contract mutations."
    tags: [verify, governance]
    command: "./ops/plugins/verify/bin/gate-mutation-trailers"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  domain.onboard.new:
    description: "Onboard a new domain into topology/profile/docs contracts atomically."
    tags: [verify, governance]
    command: "./ops/plugins/verify/bin/domain-onboard-new"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  surface.boundary.audit:
    description: "Audit spine boundary contract violations (workbench-owned and runtime-only artifacts misplaced in spine)."
    tags: [surface, governance, audit]
    command: "./ops/plugins/surface/bin/surface-boundary-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: none
    outputs: ["stdout"]
  surface.boundary.reconcile.plan:
    description: "Emit deterministic reconcile plan for boundary violations with exact move/archive targets."
    tags: [surface, governance, audit]
    command: "./ops/plugins/surface/bin/surface-boundary-reconcile-plan"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: none
    outputs: ["stdout"]
  catalog.domain.sync:
    description: "Sync domain-scoped capability catalogs from capabilities registry into docs/governance/domains."
    tags: [docs, governance, catalog]
    command: "./ops/plugins/docs/bin/catalog-domain-sync"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: none
    outputs: ["stdout"]
  mailroom.runtime.migrate:
    description: "Migrate live mailroom runtime artifacts to external runtime root per mailroom.runtime.contract."
    tags: [mailroom, runtime, governance]
    command: "./ops/plugins/mailroom-bridge/bin/mailroom-runtime-migrate --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: none
    outputs: ["stdout"]
  stabilization.mode.status:
    description: "Show stabilization window status, verify bypass targets, and required preflight capability."
    tags: [aof, tenant, stabilization]
    command: "./ops/plugins/tenant/bin/stabilization-mode-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: none
    outputs: ["stdout"]
  surface.audit.full:
    description: "Run full surface parity audit and emit certification report under docs/governance/_audits."
    tags: [verify, governance, audit]
    command: "./ops/plugins/verify/bin/surface-audit-full"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  calendar.surface.audit:
    description: "Run canonical calendar surface audit (calendar+graph+backup+AOF control-plane matrix) and emit certification report."
    tags: [verify, calendar, governance, audit]
    command: "./ops/plugins/verify/bin/calendar-surface-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "docs/governance/_audits/CALENDAR_SURFACE_AUDIT_*"]
    domain: ms-graph
    plane: fabric
  workbench.impl.audit:
    description: "Audit domain_external implementation paths against canonical workbench repo for discovery + parity."
    tags: [verify, workbench, governance]
    command: "./ops/plugins/verify/bin/workbench-impl-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  schema.conventions.audit:
    description: "Audit spine binding schema conventions and emit normalization report."
    tags: [verify, governance, schema]
    command: "./ops/plugins/verify/bin/schema-conventions-audit --mode full --report"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: none
    outputs: ["stdout"]
  stability.control.snapshot:
    description: "Runtime reliability + predictive snapshot for critical domains (automation, finance, Z2M, Immich) with VM headroom/latency scoring."
    tags: [stability, observability, runtime]
    command: "./ops/plugins/observability/bin/stability-control-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  automation.stack.latency.status:
    description: "Repeated-sample latency budget status for automation-stack endpoints + n8n quick probe timing."
    tags: [stability, observability, runtime, latency, automation]
    command: "./ops/plugins/observability/bin/automation-stack-latency-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: observability
    plane: fabric
  infra.core.slo.status:
    description: "Service-level SLO status for infra-core required services (Caddy, Authentik, Vaultwarden, Infisical, Cloudflared) with optional Pi-hole lane."
    tags: [stability, observability, runtime, infra-core, slo]
    command: "./ops/plugins/observability/bin/infra-core-slo-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: observability
    plane: fabric
  stability.control.reconcile:
    description: "Guided-only reconcile planner that prints exact manual recovery commands for degraded critical domains (aligned to snapshot incident set)."
    tags: [stability, observability, runtime]
    command: "./ops/plugins/observability/bin/stability-control-reconcile"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  alerting.probe:
    description: "Run stability snapshot in JSON mode and stage it for alerting dispatch."
    tags: [alerting, observability, runtime]
    command: "./ops/plugins/alerting/bin/alerting-probe"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "/tmp/spine-alerting-probe-latest.json"]
    domain: none
    plane: fabric
  alerting.dispatch:
    description: "Evaluate snapshot status against alerting rules and dispatch to configured channels."
    tags: [alerting, observability, runtime]
    command: "./ops/plugins/alerting/bin/alerting-dispatch"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/outbox/alerts/*"]
    domain: none
    plane: fabric
  alerting.status:
    description: "Read-only alerting status dashboard (history + cooldown state)."
    tags: [alerting, observability, runtime]
    command: "./ops/plugins/alerting/bin/alerting-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # RAG (AnythingLLM + Qdrant on ai-consolidation VM 207)
  # NOTE: This does NOT change watcher RAG-lite behavior; it's an operator surface.
  # ─────────────────────────────────────────────────────────────────────────
  rag.health:
    description: "RAG health probe (AnythingLLM ping + Qdrant healthz)"
    tags: [rag]
    command: "./ops/plugins/rag/bin/rag health"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.anythingllm.status:
    description: "Show AnythingLLM workspace document count (requires AnythingLLM API key)"
    tags: [rag]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/rag/bin/rag status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.anythingllm.ask:
    description: "Query AnythingLLM workspace (vector RAG); prints answer + sources if available"
    tags: [rag]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/rag/bin/rag ask"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.anythingllm.sync:
    description: "Index governed spine docs into AnythingLLM workspace (bulk upload + embed)"
    tags: [rag]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/rag/bin/rag sync"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.anythingllm.tune:
    description: "Tune AnythingLLM on ai-consolidation (set Ollama chat model; recreate container)"
    tags: [rag]
    command: "./ops/plugins/rag/bin/anythingllm-tune"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.mcp.server:
    description: "MCP stdio server adapter wrapping RAG query/retrieve/health for Claude Code tool calls"
    tags: [rag, mcp]
    command: "python3 ./ops/plugins/rag/bin/rag-mcp-server"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    notes: "Not invoked via ops cap run. Started by Claude Code via .mcp.json. Registered here for discoverability and D67 parity."
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.reindex.remote.start:
    description: "Start detached/server-side RAG reindex on VM 207 (dry-run by default)"
    tags: [rag, remote, reindex]
    command: "./ops/plugins/rag/bin/rag-reindex-remote-start"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.reindex.remote.status:
    description: "Read detached/server-side RAG reindex progress/session/log status"
    tags: [rag, remote, reindex]
    command: "./ops/plugins/rag/bin/rag-reindex-remote-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.reindex.remote.stop:
    description: "Stop detached/server-side RAG reindex session (dry-run by default)"
    tags: [rag, remote, reindex]
    command: "./ops/plugins/rag/bin/rag-reindex-remote-stop"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.reindex.remote.verify:
    description: "Verify RAG reindex completion quality against rag.reindex.quality.yaml contract"
    tags: [rag, remote, reindex, verify]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/rag/bin/rag-reindex-remote-verify"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.remote.dependency.probe:
    description: "Probe RAG dependencies (AnythingLLM/Qdrant/Ollama) from VM207 perspective with timing SLOs"
    tags: [rag, remote, health]
    command: "./ops/plugins/rag/bin/rag-remote-dependency-probe"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.embedding.probe:
    description: "Probe embedding backend health — repeated embedding requests with dimension/latency/HTTP checks"
    tags: [rag, embedding, health]
    command: "./ops/plugins/rag/bin/rag-embedding-probe"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: rag
    plane: fabric
  rag.reindex.smoke:
    description: "Short-batch smoke test — upload N docs to validate embedding pipeline before full reindex"
    tags: [rag, reindex, smoke]
    command: "./ops/plugins/rag/bin/rag-reindex-smoke"
    cwd: "$SPINE_CODE"
    safety: mutating
    touches_api: true
    approval: manual
    lifecycle: ready
    outputs: ["stdout", "mailroom/state/rag-sync/smoke-evidence.json"]
    requires:
      - secrets.binding
      - secrets.auth.status
    domain: rag
    plane: fabric
  secrets.status:
    description: "Check secrets configuration presence (no values, no network). Fails if not configured."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  infra.gh_issue:
    description: "Get GitHub issue details"
    tags: [infra]
    command: "gh issue view"
    safety: read-only
    approval: auto
    lifecycle: ready
    auth_model: gh-cli # Uses gh CLI auth (gh auth login), not Infisical secrets
    args:
      - name: issue_number
        required: true
        validate: "^[0-9]+$"
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  secrets.binding:
    description: "Print non-secret secrets provider binding (SSOT). STOP if incomplete."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-binding"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.auth.status:
    description: "Check secrets auth presence for Infisical (NO values). STOP if missing."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-auth-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.auth.load:
    description: "Validate Infisical Universal Auth creds file exists + perms; print one-liner to source it. Does NOT store secrets."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-auth-load"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.credentials.parity:
    description: "Audit Infisical credentials file parity across declared nodes (non-secret output only)."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-credentials-parity"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.projects.status:
    description: "Compare SSOT inventory vs live Infisical projects. Reports parity deltas (names only, no secrets)."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-projects-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.inventory.status:
    description: "Read-only SSOT inventory (project names + counts). No network, no secrets values."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-inventory-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.namespace.status:
    description: "Read-only namespace hygiene for bound Infisical project (required key paths + root-path freeze regression check)."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-namespace-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.runway.status:
    description: "Container/domain secrets runway audit: checks active compose stacks + required domain keys against canonical project/path routing."
    tags: [secrets, governance, runtime]
    command: "./ops/plugins/secrets/bin/secrets-runway-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.bundle.verify:
    description: "Verify canonical secret bundle routes + endpoint auth checks without mutation. Example: secrets.bundle.verify finance"
    tags: [secrets, governance, runtime]
    command: "./ops/plugins/secrets/bin/secrets-bundle-apply --verify-only"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.bundle.apply:
    description: "Canonical CLI bundle rotation for secrets (write + verify + legacy-shadow detection). Example: secrets.bundle.apply finance --clipboard --sync-local-env"
    tags: [secrets, governance, runtime]
    command: "./ops/plugins/secrets/bin/secrets-bundle-apply"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p1.root_cleanup.status:
    description: "Dry-run guarded check for P1 root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p1.root_cleanup.execute:
    description: "Execute guarded P1 root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p2.copy_first.status:
    description: "Dry-run copy-first guard for P2 edge/network keys from root to /spine/network/edge."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/network/edge"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p2.copy_first.execute:
    description: "Execute copy-first for P2 edge/network keys from root to /spine/network/edge."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/network/edge --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p2.root_cleanup.status:
    description: "Dry-run guarded check for P2 root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/network/edge"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p2.root_cleanup.execute:
    description: "Execute guarded P2 root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/network/edge"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p3.copy_first.status:
    description: "Dry-run copy-first guard for P3 storage/NAS keys from root to /spine/storage/nas."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/storage/nas"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p3.copy_first.execute:
    description: "Execute copy-first for P3 storage/NAS keys from root to /spine/storage/nas."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/storage/nas --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p3.root_cleanup.status:
    description: "Dry-run guarded check for P3 root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/storage/nas"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p3.root_cleanup.execute:
    description: "Execute guarded P3 root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/storage/nas"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p4.copy_first.status:
    description: "Dry-run copy-first guard for P4 commerce/mail keys from root to /spine/integrations/commerce-mail."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/integrations/commerce-mail"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p4.copy_first.execute:
    description: "Execute copy-first for P4 commerce/mail keys from root to /spine/integrations/commerce-mail."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/integrations/commerce-mail --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p4.root_cleanup.status:
    description: "Dry-run guarded check for P4 root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/integrations/commerce-mail"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p4.root_cleanup.execute:
    description: "Execute guarded P4 root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/integrations/commerce-mail"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.immich.copy_first.status:
    description: "Dry-run copy-first guard for P5 Immich keys from root to /spine/services/immich."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/immich"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.immich.copy_first.execute:
    description: "Execute copy-first for P5 Immich keys from root to /spine/services/immich."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/immich --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.immich.root_cleanup.status:
    description: "Dry-run guarded check for P5 Immich root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/immich"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.immich.root_cleanup.execute:
    description: "Execute guarded P5 Immich root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/immich"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mail_archiver.copy_first.status:
    description: "Dry-run copy-first guard for P5 mail-archiver keys from root to /spine/services/mail-archiver."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mail-archiver"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mail_archiver.copy_first.execute:
    description: "Execute copy-first for P5 mail-archiver keys from root to /spine/services/mail-archiver."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mail-archiver --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mail_archiver.root_cleanup.status:
    description: "Dry-run guarded check for P5 mail-archiver root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/mail-archiver"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mail_archiver.root_cleanup.execute:
    description: "Execute guarded P5 mail-archiver root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/mail-archiver"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.finance.copy_first.status:
    description: "Dry-run copy-first guard for P5 finance keys from root to /spine/services/finance."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/finance"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.finance.copy_first.execute:
    description: "Execute copy-first for P5 finance keys from root to /spine/services/finance."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/finance --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.finance.root_cleanup.status:
    description: "Dry-run guarded check for P5 finance root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/finance"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.finance.root_cleanup.execute:
    description: "Execute guarded P5 finance root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/finance"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.paperless.copy_first.status:
    description: "Dry-run copy-first guard for P5 paperless keys from root to /spine/services/paperless."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/paperless"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.paperless.copy_first.execute:
    description: "Execute copy-first for P5 paperless keys from root to /spine/services/paperless."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/paperless --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.paperless.root_cleanup.status:
    description: "Dry-run guarded check for P5 paperless root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/paperless"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.paperless.root_cleanup.execute:
    description: "Execute guarded P5 paperless root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/paperless"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mcpjungle.copy_first.status:
    description: "Dry-run copy-first guard for P5 mcpjungle keys from root to /spine/services/mcpjungle."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mcpjungle"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mcpjungle.copy_first.execute:
    description: "Execute copy-first for P5 mcpjungle keys from root to /spine/services/mcpjungle."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/services/mcpjungle --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mcpjungle.root_cleanup.status:
    description: "Dry-run guarded check for P5 mcpjungle root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/services/mcpjungle"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p5.mcpjungle.root_cleanup.execute:
    description: "Execute guarded P5 mcpjungle root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/services/mcpjungle"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p6.ai.copy_first.status:
    description: "Dry-run copy-first guard for P6 AI keys from root to /spine/ai/providers."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/ai/providers"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p6.ai.copy_first.execute:
    description: "Execute copy-first for P6 AI keys from root to /spine/ai/providers."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-cohort-copy-first --target-path /spine/ai/providers --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p6.ai.root_cleanup.status:
    description: "Dry-run guarded check for P6 AI key root-path cleanup eligibility (no deletes)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --target-path /spine/ai/providers"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.p6.ai.root_cleanup.execute:
    description: "Execute guarded P6 AI key root-path cleanup (delete only root copies after parity checks)."
    tags: [migration, secrets]
    command: "./ops/plugins/secrets/bin/secrets-p1-root-cleanup --execute --target-path /spine/ai/providers"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.cli.status:
    description: "Hash parity check: canonical (spine) vs vendored (workbench) infisical-agent.sh."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-cli-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.identity.rbac.status:
    description: "Probe identity project memberships and roles (no secret values). Reports deprecated_writable count."
    tags: [secrets, rbac]
    command: "./ops/plugins/secrets/bin/secrets-identity-rbac-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  secrets.identity.rbac.lock:
    description: "Downgrade identity roles on deprecated projects to viewer (dry-run by default, --execute to mutate)."
    tags: [secrets, rbac]
    command: "./ops/plugins/secrets/bin/secrets-identity-rbac-lock"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # HOME ASSISTANT (SSOT governance)
  # default classification: plane=domain_external, domain=home-assistant
  # ─────────────────────────────────────────────────────────────────────────
  ha.refresh:
    description: "Run all HA snapshot capabilities in sequence to refresh all bindings"
    tags: [ha, refresh, unified]
    command: "./ops/plugins/ha/bin/ha-refresh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.status:
    description: "Unified HA status dashboard — API health, counts, add-ons, device map, binding freshness, gaps"
    tags: [ha, status, unified]
    command: "./ops/plugins/ha/bin/ha-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/
    touches_api: false
    requires: []
    outputs: ["stdout"]
  ha.ssot.propose:
    description: "Fetch HA live facts and diff against HASS_OPERATIONAL_RUNBOOK.md sections 2-4"
    tags: [ha, ssot, governance]
    command: "./ops/plugins/ha/bin/ha-ssot-propose"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.ssot.apply:
    description: "Apply ha.ssot.propose diff to HASS_OPERATIONAL_RUNBOOK.md sections 2-4"
    tags: [ha, ssot, governance]
    command: "./ops/plugins/ha/bin/ha-ssot-apply"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.config.extract:
    description: "Extract HA config files (configuration.yaml, automations.yaml, etc.) to workbench for version control"
    tags: [ha, config, extraction]
    command: "./ops/plugins/ha/bin/ha-config-extract"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.z2m.health:
    description: "Read-only: Z2M device health report — battery, staleness, bridge status for all Zigbee devices."
    tags: [ha, zigbee, z2m, health]
    command: "./ops/plugins/ha/bin/ha-z2m-health"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires: ["secrets.binding", "secrets.auth.status"]
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.z2m.devices.snapshot:
    description: "Read-only: extract Zigbee2MQTT device registry from HA to ops/bindings/z2m.devices.yaml."
    tags: [ha, zigbee, z2m]
    command: "./ops/plugins/ha/bin/ha-z2m-devices-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.zwave.devices.snapshot:
    description: "Read-only: extract Z-Wave device list from HA API to ops/bindings/zwave.devices.yaml."
    tags: [ha, zwave, z-wave]
    command: "./ops/plugins/ha/bin/ha-zwave-devices-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.addon.restart:
    description: "Mutating: restart an HA Supervisor add-on by slug via SSH + Supervisor API."
    tags: [ha, supervisor, addons]
    command: "./ops/plugins/ha/bin/ha-addon-restart"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.addons.snapshot:
    description: "Read-only: extract HA Supervisor add-on inventory to ops/bindings/ha.addons.yaml."
    tags: [ha, supervisor, addons]
    command: "./ops/plugins/ha/bin/ha-addons-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.device.map.build:
    description: "Read-only: cross-reference HA entities with home device registry and Z2M devices to ops/bindings/ha.device.map.yaml."
    tags: [ha, devices, cross-reference]
    command: "./ops/plugins/ha/bin/ha-device-map-build"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.dashboard.snapshot:
    description: "Read-only: snapshot HA Lovelace dashboards to ops/bindings/ha.dashboards.yaml (SSH .storage method)"
    tags: [ha, dashboards, lovelace, snapshot]
    command: "./ops/plugins/ha/bin/ha-dashboard-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.dashboard.backup:
    description: "Backup HA YAML dashboard files to workbench infra/ha-dashboards/ for domain-owned version control"
    tags: [ha, dashboards, backup]
    command: "./ops/plugins/ha/bin/ha-dashboard-backup"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.integrations.snapshot:
    description: "Read-only: snapshot HA config entries (integrations) to ops/bindings/ha.integrations.yaml"
    tags: [ha, integrations, snapshot]
    command: "./ops/plugins/ha/bin/ha-integrations-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.automations.snapshot:
    description: "Read-only: snapshot HA automation states to ops/bindings/ha.automations.yaml"
    tags: [ha, automations, snapshot]
    command: "./ops/plugins/ha/bin/ha-automations-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.helpers.snapshot:
    description: "Read-only: snapshot HA helper entities (input_*, counter, timer) to ops/bindings/ha.helpers.yaml"
    tags: [ha, helpers, snapshot]
    command: "./ops/plugins/ha/bin/ha-helpers-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.scenes.snapshot:
    description: "Read-only: snapshot HA scene entities to ops/bindings/ha.scenes.yaml"
    tags: [ha, scenes, snapshot]
    command: "./ops/plugins/ha/bin/ha-scenes-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.scripts.snapshot:
    description: "Read-only: snapshot HA script entities to ops/bindings/ha.scripts.yaml"
    tags: [ha, scripts, snapshot]
    command: "./ops/plugins/ha/bin/ha-scripts-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.hacs.snapshot:
    description: "Read-only: snapshot HACS repository inventory to ops/bindings/ha.hacs.yaml"
    tags: [ha, hacs, snapshot]
    command: "./ops/plugins/ha/bin/ha-hacs-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.hacs.updates.check:
    description: "Read-only: check HACS repositories for pending updates from ha.hacs.yaml binding"
    tags: [ha, hacs, updates, monitoring]
    command: "./ops/plugins/ha/bin/ha-hacs-updates-check"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.entity.state.baseline:
    description: "Read-only: snapshot all HA entity states as regression-proof baseline to ops/bindings/ha.entity.state.baseline.yaml"
    tags: [ha, entities, baseline, snapshot]
    command: "./ops/plugins/ha/bin/ha-entity-state-baseline"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.ssot.baseline.build:
    description: "Read-only: build unified HA SSOT baseline from all sub-bindings to ops/bindings/ha.ssot.baseline.yaml"
    tags: [ha, ssot, baseline, unified]
    command: "./ops/plugins/ha/bin/ha-ssot-baseline-build"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  # ─────────────────────────────────────────────────────────────────────────
  # HOME ASSISTANT (scoped service calls)
  # ─────────────────────────────────────────────────────────────────────────
  ha.service.call:
    description: "Scoped HA service call via REST API — base for domain-specific wrappers"
    tags: [ha, service-calls, api]
    command: "./ops/plugins/ha/bin/ha-service-call"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.scene.activate:
    description: "Activate a Home Assistant scene (idempotent preset)"
    tags: [ha, service-calls, scene]
    command: "./ops/plugins/ha/bin/ha-scene-activate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.light.toggle:
    description: "Toggle a Home Assistant light entity on/off"
    tags: [ha, service-calls, light]
    command: "./ops/plugins/ha/bin/ha-light-toggle"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.lock.control:
    description: "Lock or unlock a Home Assistant lock entity (physical security — manual approval)"
    tags: [ha, service-calls, lock, security]
    command: "./ops/plugins/ha/bin/ha-lock-control"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.device.rename:
    description: "Rename an HA device via WebSocket API (sets name_by_user)"
    tags: [ha, device-registry, websocket]
    command: "./ops/plugins/ha/bin/ha-device-rename"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    post_action: ha.device.map.build
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.automation.create:
    description: "Create or update an HA automation via REST API config endpoint"
    tags: [ha, service-calls, automation]
    command: "./ops/plugins/ha/bin/ha-automation-create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    post_action: ha.automations.snapshot
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.automation.trigger:
    description: "Trigger a Home Assistant automation"
    tags: [ha, service-calls, automation]
    command: "./ops/plugins/ha/bin/ha-automation-trigger"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.script.run:
    description: "Run a Home Assistant script"
    tags: [ha, service-calls, script]
    command: "./ops/plugins/ha/bin/ha-script-run"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.backup.create:
    description: "Create a Home Assistant backup via SSH + ha CLI (physical backup — manual approval)"
    tags: [ha, backup, ssh]
    command: "./ops/plugins/ha/bin/ha-backup-create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.health.status:
    description: "HA API health probe — confirms API running, reports version, location, component count"
    tags: [ha, health, api]
    command: "./ops/plugins/ha/bin/ha-health-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.entity.status:
    description: "Single HA entity state lookup — returns state, friendly_name, last_changed, attributes"
    tags: [ha, entity, api]
    command: "./ops/plugins/ha/bin/ha-entity-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.mcp.status:
    description: "MCP server file validation — checks source exists, GOVERNED_TOOLS block, ha_call_service blocked, policy doc"
    tags: [ha, mcp, validation]
    command: "./ops/plugins/ha/bin/ha-mcp-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.sync.start:
    description: "Start the HA sync agent daemon (event-driven binding refresh)"
    tags: [ha, sync, daemon]
    command: "./ops/plugins/ha/bin/ha-sync-start"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: false
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.sync.stop:
    description: "Stop the HA sync agent daemon"
    tags: [ha, sync, daemon]
    command: "./ops/plugins/ha/bin/ha-sync-stop"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  ha.sync.status:
    description: "Check HA sync agent daemon status"
    tags: [ha, sync, daemon]
    command: "./ops/plugins/ha/bin/ha-sync-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    touches_api: false
    requires: []
    outputs: ["stdout"]
    plane: domain_external
    domain: home-assistant
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/home-assistant/docs/
  # ─────────────────────────────────────────────────────────────────────────
  # MEDIA (media stack governance)
  # default classification: plane=domain_external, domain=media
  # ─────────────────────────────────────────────────────────────────────────
  recyclarr.sync:
    description: "Run Recyclarr sync on VM 209 to apply quality profile governance"
    command: "./ops/plugins/media/bin/recyclarr-sync"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/
    tags: [media, governance]
    outputs: ["stdout"]
  # ─────────────────────────────────────────────────────────────────────────
  # MINT MODULES (product operator tooling)
  # ─────────────────────────────────────────────────────────────────────────
  mint.modules.health:
    description: "Health probe for all mint module endpoints (fresh-slate VMs 212+213)"
    tags: [mint, health]
    command: "./ops/plugins/mint/bin/modules-health"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  mint.seeds.query:
    description: "Query artwork_seeds on mint-data via SSH + psql (read-only)"
    tags: [mint, seeds, query]
    command: "./ops/plugins/mint/bin/seeds-query"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  mint.intake.validate:
    description: "Validate JSON payload against order-intake contract endpoint"
    tags: [mint, intake, validation]
    command: "./ops/plugins/mint/bin/intake-validate"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  mint.deploy.status:
    description: "Docker container status for mint fresh-slate VMs (apps + data)"
    tags: [mint, deploy, docker]
    command: "./ops/plugins/mint/bin/deploy-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  mint.deploy.sync:
    description: "Sync committed mint-modules source to VM 213 and rebuild selected modules with post-deploy proofs."
    tags: [mint, deploy, sync]
    command: "./ops/plugins/mint/bin/deploy-sync-from-main"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  mint.runtime.proof:
    description: "Deep runtime proof for mint module behavior (catches stale stub builds despite healthy containers)."
    tags: [mint, runtime, proof]
    command: "./ops/plugins/mint/bin/runtime-proof"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  mint.migrate.dryrun:
    description: "Check pending database migrations on mint-data (read-only)"
    tags: [mint, migrations, database]
    command: "./ops/plugins/mint/bin/migrate-dryrun"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  mint.loop.daily:
    description: "Run the mint-agent daily operating loop (route, verify, health, migrate)"
    tags: [mint, loop, daily]
    command: "./ops/plugins/mint/bin/loop-daily"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: mint
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/mint-agent/
    outputs: ["stdout"]
  # ─────────────────────────────────────────────────────────────────────────
  # COMMUNICATIONS STACK (WS1 PILOT + TRANSACTIONAL SURFACES)
  # ─────────────────────────────────────────────────────────────────────────
  communications.stack.status:
    description: "Read-only WS1 communications stack status surface (contract parity + live Graph probe in non-simulation mode)."
    tags: [communications, email, pilot]
    command: "./ops/plugins/communications/bin/communications-stack-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  communications.mailboxes.list:
    description: "List WS1 pilot communications mailboxes from contract (read-only)."
    tags: [communications, email, pilot]
    command: "./ops/plugins/communications/bin/communications-mailboxes-list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.mail.search:
    description: "Search WS1 pilot communications mailbox surface (contract catalog in simulation; Graph mailbox in live mode)."
    tags: [communications, email, pilot]
    command: "./ops/plugins/communications/bin/communications-mail-search"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  communications.mail.send.test:
    description: "Manual-approval pilot send-test surface (simulation artifact in simulation mode; live Graph send in live mode)."
    tags: [communications, email, pilot]
    command: "./ops/plugins/communications/bin/communications-mail-send-test"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  communications.provider.status:
    description: "Read-only communications provider routing/status surface (Graph + Resend + Twilio)."
    tags: [communications, email, sms, providers]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/communications/bin/communications-provider-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  communications.policy.status:
    description: "Read-only communications consent/compliance policy status (opt-in, quiet-hours, SMS policy)."
    tags: [communications, policy, compliance]
    command: "./ops/plugins/communications/bin/communications-policy-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.templates.list:
    description: "Read-only communications template catalog by channel and message_type."
    tags: [communications, templates, email, sms]
    command: "./ops/plugins/communications/bin/communications-templates-list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.send.preview:
    description: "Read-only transactional send planner: resolves provider route, applies policy gates, renders message body, and writes preview receipt linkage artifact."
    tags: [communications, transactional, preview, email, sms]
    command: "./ops/plugins/communications/bin/communications-send-preview"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.send.execute:
    description: "Manual-approval transactional execution surface for canonical Resend/Twilio/Graph routes (requires preview linkage on --execute; simulation-first with cutover phase controls)."
    tags: [communications, transactional, email, sms]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/communications/bin/communications-send-execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  communications.delivery.log:
    description: "Read-only query surface for normalized communications delivery log artifacts."
    tags: [communications, delivery, audit]
    command: "./ops/plugins/communications/bin/communications-delivery-log"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.delivery.anomaly.status:
    description: "Read-only anomaly evaluator for communications delivery log (failure/policy/timeouts with warn/incident thresholds)."
    tags: [communications, delivery, anomaly, alerting]
    command: "./ops/plugins/communications/bin/communications-delivery-anomaly-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.delivery.anomaly.dispatch:
    description: "Manual-approval alert dispatcher for communications delivery anomalies (outbox artifact + channel dispatch + cooldown)."
    tags: [communications, delivery, anomaly, alerting]
    command: "./ops/plugins/communications/bin/communications-delivery-anomaly-dispatch"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.alerts.flush:
    description: "Manual-approval flush of pending alerting email intents through governed communications dispatch pipeline (preview + execute per intent)."
    tags: [communications, alerting, email, flush]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/communications/bin/communications-alerts-flush"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  communications.alerts.queue.status:
    description: "Read-only queue status for pending alerting email intents (counts, ages, top intents)."
    tags: [communications, alerting, email, queue, observability]
    command: "./ops/plugins/communications/bin/communications-alerts-queue-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.alerts.queue.slo.status:
    description: "Evaluate alerting email intent queue against SLO thresholds (ok/warn/incident with reasons and recommended action)."
    tags: [communications, alerting, email, queue, slo, observability]
    command: "./ops/plugins/communications/bin/communications-alerts-queue-slo-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.alerts.queue.escalate:
    description: "Governed incident escalation for alert-intent queue SLO breaches (mailroom task + proposal skeleton, manual approval, cooldown dedupe)."
    tags: [communications, alerting, email, queue, escalation, incident]
    command: "./ops/plugins/communications/bin/communications-alerts-queue-escalate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.alerts.runtime.status:
    description: "Read-only communications queue + escalation health rollup for watcher/status embedding (pending count, SLO status, escalation state, delivery summary)."
    tags: [communications, alerting, email, queue, escalation, observability, watcher]
    command: "./ops/plugins/communications/bin/communications-alerts-runtime-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout"]
  communications.alerts.incident.bundle.create:
    description: "One-command incident triage bundle for the communications alert intent pipeline (queue, SLO, runtime, escalations, delivery log)."
    tags: [communications, alerting, email, queue, incident, bundle, observability]
    command: "./ops/plugins/communications/bin/communications-alerts-incident-bundle-create"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: communications
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/communications/
    outputs: ["stdout", "mailroom/outbox/alerts/communications/incidents/*"]
  # ─────────────────────────────────────────────────────────────────────────
  # MCP DOMAIN DENY POLICY (GAP-OP-095 P5)
  # ─────────────────────────────────────────────────────────────────────────
  # Domains with MCP servers registered but mutating tools blocked (P2).
  # Explicit deny entries document WHY no spine capabilities exist yet.
  # When ready, replace deny entry with real capabilities.
  # ─────────────────────────────────────────────────────────────────────────

  # home-assistant: ha_call_service remains blocked in MCP P2
  # Scoped capabilities now exist: ha.service.call, ha.scene.activate,
  #   ha.light.toggle, ha.lock.control, ha.automation.trigger, ha.script.run,
  #   ha.backup.create (GAP-OP-339, GAP-OP-372–374). MCP pass-through
  #   still blocked — agents must use scoped caps via ops cap run.
  # Policy doc: docs/governance/HASS_MCP_INTEGRATION.md (GAP-OP-376)

  # mint-os: 5 tools blocked (send_order_email, post_production_update,
  #   update_order_customer, ss_place_order, sanmar_place_order)
  # Deny reason: mint-os is deferred from spine governance scope.
  #   E-commerce operations remain manual until operator decision.

  # firefly: config-only MCP (read-only). No mutating tools to govern.
  # paperless: config-only MCP (read-only). No mutating tools to govern.
  # immich: config-only MCP (read-only). No mutating tools to govern.

  # ─────────────────────────────────────────────────────────────────────────
  # MICROSOFT GRAPH (custom non-delete mutation suite)
  # ─────────────────────────────────────────────────────────────────────────
  graph.mail.search:
    description: "Search mailbox messages via Microsoft Graph (/me/messages)."
    tags: [graph, mail]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec mail_search"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.mail.get:
    description: "Get a mailbox message by id via Microsoft Graph."
    tags: [graph, mail]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec mail_get"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.mail.send:
    description: "Send an email through Microsoft Graph sendMail endpoint."
    tags: [graph, mail]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec mail_send"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.mail.draft.create:
    description: "Create an email draft via Microsoft Graph."
    tags: [graph, mail]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec draft_create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.mail.draft.update:
    description: "Update an existing email draft via Microsoft Graph."
    tags: [graph, mail]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec draft_update"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.calendar.list:
    description: "List calendar events via Microsoft Graph."
    tags: [graph, calendar]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec calendar_list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.calendar.get:
    description: "Get a calendar event by id via Microsoft Graph."
    tags: [graph, calendar]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec calendar_get"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.calendar.create:
    description: "Create a calendar event via Microsoft Graph."
    tags: [graph, calendar]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec calendar_create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.calendar.update:
    description: "Update a calendar event via Microsoft Graph."
    tags: [graph, calendar]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec calendar_update"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  graph.calendar.rsvp:
    description: "Respond to a calendar event invite via Microsoft Graph (accept/tentative/decline)."
    tags: [graph, calendar]
    command: "./ops/plugins/ms-graph/bin/graph-cap-exec calendar_rsvp"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: domain_external
    domain: ms-graph
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/ms-graph/tools/ms_graph_tools.py
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
  # ─────────────────────────────────────────────────────────────────────────
  # SHARE PUBLISH (curated one-way share channel)
  # ─────────────────────────────────────────────────────────────────────────
  share.publish.preflight:
    description: "Read-only pre-flight checks for share publish (clean tree, bindings, remote)"
    tags: [share, governance]
    command: "./ops/plugins/share/bin/share-publish-preflight"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  share.publish.preview:
    description: "Read-only preview of publishable files (allowlist scan + denylist content check)"
    tags: [share, governance]
    command: "./ops/plugins/share/bin/share-publish-preview"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  share.publish.apply:
    description: "Push curated content to share channel (dry-run by default; use --execute to push)"
    tags: [share, governance]
    command: "./ops/plugins/share/bin/share-publish-apply"
    cwd: "$SPINE_CODE"
    safety: destructive
    approval: manual
    lifecycle: ready
    requires:
      - share.publish.preflight
      - share.publish.preview
    outputs: ["stdout"]
    domain: none
    plane: fabric
  share.publish.status:
    description: "Single-command readiness report for share publish (aggregates preflight + preview)"
    tags: [share, governance]
    command: "./ops/plugins/share/bin/share-publish-status"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # FUTURE: MUTATING (require manual approval)
  # ─────────────────────────────────────────────────────────────────────────
  secrets.exec:
    description: "Run a command with secrets injected (Infisical). Requires secrets.binding + secrets.auth.status OK."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-exec"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: operator
    lifecycle: ready
    outputs: ["stdout", "stderr"]
    domain: secrets
    plane: fabric
  secrets.set.interactive:
    description: "Interactive secret setter (read -s, no values printed). Uses infisical-agent.sh."
    tags: [secrets]
    command: "./ops/plugins/secrets/bin/secrets-set-interactive"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: secrets
    plane: fabric
  # git.commit:
  #   description: "Create a git commit"
  #   command: "git commit -m"
  #   safety: mutating
  #   approval: manual
  #   args:
  #     - name: message
  #       required: true
  #   outputs: ["stdout"]

  # ─────────────────────────────────────────────────────────────────────────
  # CLOUDFLARE (read-only status checks)
  # ─────────────────────────────────────────────────────────────────────────
  cloudflare.status:
    description: "Read-only Cloudflare status (zones + DNS record counts; no values)."
    tags: [cloudflare]
    command: "./ops/plugins/cloudflare/bin/cloudflare-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: network
    plane: fabric
  cloudflare.dns.status:
    description: "DNS record counts per bound zone (read-only)."
    tags: [cloudflare]
    command: "./ops/plugins/cloudflare/bin/cloudflare-dns-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: network
    plane: fabric
  cloudflare.tunnel.status:
    description: "Tunnel inventory + creation timestamps for bound tunnels."
    tags: [cloudflare]
    command: "./ops/plugins/cloudflare/bin/cloudflare-tunnel-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: network
    plane: fabric
  cloudflare.inventory.sync:
    description: "Verify cloudflare.inventory metadata matches live zones/tunnels."
    tags: [cloudflare]
    command: "./ops/plugins/cloudflare/bin/cloudflare-inventory-sync"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: network
    plane: fabric
  cloudflare.tunnel.ingress.status:
    description: "Export Cloudflare tunnel ingress rules (hostname -> service)."
    tags: [cloudflare]
    command: "./ops/plugins/cloudflare/bin/cloudflare-tunnel-ingress-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: network
    plane: fabric
  cloudflare.domain_routing.diff:
    description: "Diff Cloudflare tunnel ingress hostnames vs DOMAIN_ROUTING_REGISTRY (routing_layer=cloudflare_tunnel)."
    tags: [cloudflare]
    command: "./ops/plugins/cloudflare/bin/cloudflare-domain-routing-diff"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: network
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # GITHUB (read-only repo health)
  # ─────────────────────────────────────────────────────────────────────────
  github.status:
    description: "Read-only GitHub repo health (branch, HEAD, clean, tags)."
    tags: [github]
    command: "./ops/plugins/github/bin/github-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: none
    plane: fabric
  github.queue.status:
    description: "GitHub queue counts (open PRs + open issues). Read-only, counts only."
    tags: [github]
    command: "./ops/plugins/github/bin/github-queue-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: none
    plane: fabric
  github.actions.status:
    description: "GitHub Actions workflow run counts + latest conclusion. Read-only, no names/URLs."
    tags: [github]
    command: "./ops/plugins/github/bin/github-actions-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
    domain: none
    plane: fabric
  github.labels.status:
    description: "GitHub label parity (declared vs live). Read-only, counts + delta."
    tags: [github]
    command: "./ops/plugins/github/bin/github-labels-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # SSH (read-only connectivity checks)
  # ─────────────────────────────────────────────────────────────────────────
  ssh.target.status:
    description: "Connectivity status for declared SSH targets (read-only, no prompts, no known_hosts writes)."
    tags: [ssh]
    command: "./ops/plugins/ssh/bin/ssh-target-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  nodes.status:
    description: "Node/VM reachability across Tier 1-3 estate (alias for ssh.target.status)."
    tags: [host, ssh]
    command: "./ops/plugins/ssh/bin/ssh-target-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # NETWORK (LAN-only device status, cutover preflight)
  # default classification: plane=domain_external, domain=network
  # ─────────────────────────────────────────────────────────────────────────
  network.lan.device.status:
    description: "Ping check for LAN-only devices via probe_via host (no credentials, read-only)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-lan-device-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.lan.host.identify:
    description: "Read-only: identify LAN host(s) via probe_via (ping + neigh + best-effort TCP/HTTP banner)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-lan-host-identify"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.shop.audit.status:
    description: "Composite audit: shop network SSOT parity, duplicate IPs, and binding coverage (local files only)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-shop-audit-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
    outputs: ["stdout"]
  network.ap.facts.capture:
    description: "Read-only: capture WiFi AP facts via SSH (TP-Link EAP225 via pve jump host). Creds from env or Infisical."
    command: "./ops/plugins/network/bin/network-ap-facts-capture"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: manual
    lifecycle: ready
    tags: ["wifi", "network", "shop", "lan-only"]
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.oob.guard.status:
    description: "Read-only guard: verify shop LAN (iDRAC/switch/NVR) is reachable without relying on pve (subnet router safety gate)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-oob-guard-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.shop.audit.canonical:
    description: "Canonical shop audit: SSOT parity + live truth (pve) + doc IP trace. Requires pve SSH."
    tags: [network]
    command: "./ops/plugins/network/bin/network-shop-audit-canonical"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.unifi.clients.snapshot:
    description: "Read-only: snapshot UniFi client list (MAC/IP/name) via UDR6 API through pve."
    tags: [network]
    command: "./ops/plugins/network/bin/network-unifi-clients-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.home.unifi.clients.snapshot:
    description: "Read-only: snapshot home UniFi client list (MAC/IP/name) via UDR7 API through proxmox-home."
    tags: [network, home]
    command: "./ops/plugins/network/bin/network-home-unifi-clients-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.home.dhcp.audit:
    description: "Read-only: audit home UniFi DHCP reservations against ops/bindings/home.device.registry.yaml."
    tags: [network, home, audit]
    command: "./ops/plugins/network/bin/network-home-dhcp-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.home.wifi.create:
    description: "Mutating: create a new WLAN on home UDR7 via UniFi API through proxmox-home."
    tags: [network, home]
    command: "./ops/plugins/network/bin/network-home-wifi-create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.home.dhcp.reservation.create:
    description: "Mutating: create a DHCP reservation on home UDR7 via UniFi API through proxmox-home."
    tags: [network, home]
    command: "./ops/plugins/network/bin/network-home-dhcp-reservation-create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.home.dhcp.dns.set:
    description: "Mutating/manual: set home UDR7 DHCP DNS server(s) for LAN clients via UniFi API through proxmox-home."
    tags: [network, home, dns, dhcp]
    command: "./ops/plugins/network/bin/network-home-dhcp-dns-set"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: primary_dns
        required: true
      - name: secondary_dns
        required: false
        default: ""
      - name: site
        required: false
        default: "default"
      - name: execute
        required: false
        default: "false"
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.shop.pihole.normalize:
    description: "Mutating/manual: normalize shop Pi-hole compose/runtime on infra-core from staged authority (compose sync + DNS policy convergence)."
    tags: [network, shop, dns, pihole]
    command: "./ops/plugins/network/bin/network-shop-pihole-normalize"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    args:
      - name: upstream_primary
        required: false
        default: "1.1.1.1"
      - name: upstream_secondary
        required: false
        default: "1.0.0.1"
      - name: execute
        required: false
        default: "false"
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.pihole.blocklist.sync:
    description: "Mutating/manual: sync Pi-hole adlists between shop (infra-core) and home (pihole-home) via v6 API. Bidirectional parity by default."
    tags: [network, dns, pihole]
    command: "./ops/plugins/network/bin/network-pihole-blocklist-sync"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    args:
      - name: direction
        required: false
        default: "bidirectional"
      - name: execute
        required: false
        default: "false"
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.nvr.reip.canonical:
    description: "Mutating: re-IP Hikvision NVR to canonical .216 via ISAPI (digest auth through pve)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-nvr-reip-canonical"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.cutover.preflight:
    description: "Composite pre-cutover verification (template, sequencing, companion changepack checks)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-cutover-preflight"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    requires:
      - spine.verify
      - ssh.target.status
      - network.shop.audit.status
      - network.shop.audit.canonical
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.pve.post_cutover.harden:
    description: "Mutating: post-cutover hardening on pve (tailscale accept-routes off, DNS upstream fix, prune stale NFS exports)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-pve-post-cutover-harden"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    requires:
      - ssh.target.status
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.md1400.pm8072.stage:
    description: "Mutating: stage persistent pm80xx binding for PM8072 (MD1400 path) on pve (fixes incorrect options pm80xx new_id=...)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-md1400-pm8072-stage"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    requires:
      - ssh.target.status
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  network.md1400.bind_test:
    description: "Mutating: hot-bind PM8072 via sysfs new_id on pve with before/after evidence capture (lspci/dmesg/lsblk)."
    tags: [network]
    command: "./ops/plugins/network/bin/network-md1400-bind-test"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - ssh.target.status
    outputs: ["stdout"]
    plane: domain_external
    domain: network
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/network/
  # ─────────────────────────────────────────────────────────────────────────
  # PROXMOX MAINTENANCE (receipt-backed; guarded)
  # ─────────────────────────────────────────────────────────────────────────
  infra.proxmox.maintenance.precheck:
    description: "Read-only: capture guest state + MD1400/PM8072 evidence on a Proxmox host."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-proxmox-maintenance"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: infra
    requires:
      - ssh.target.status
    outputs: ["stdout"]
  infra.proxmox.maintenance.shutdown:
    description: "Mutating: guarded shutdown of all running guests on a Proxmox host (optional host poweroff)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-proxmox-maintenance"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: infra
    requires:
      - ssh.target.status
      - network.oob.guard.status
    outputs: ["stdout"]
  infra.proxmox.maintenance.startup:
    description: "Mutating: start key guests on a Proxmox host, then print postcheck commands."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-proxmox-maintenance"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: infra
    requires:
      - ssh.target.status
    outputs: ["stdout"]
  infra.post_power.recovery.status:
    description: "Read-only: check all hosts/stacks and report what needs recovery after a power cycle."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-post-power-recovery --mode status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: infra
    requires:
      - ssh.target.status
    outputs: ["stdout"]
  infra.post_power.recovery:
    description: "Mutating: orchestrated post-power-cycle recovery — brings all stacks up in dependency order and verifies health."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-post-power-recovery --mode recover"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: infra
    requires:
      - ssh.target.status
    outputs: ["stdout"]
  infra.maintenance.window:
    description: "Composite maintenance window orchestrator — chains precheck, shutdown, startup, recovery, verify across shop/home/both Proxmox sites."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-maintenance-window"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: infra
    requires:
      - ssh.target.status
    outputs: ["stdout"]
  # ─────────────────────────────────────────────────────────────────────────
  # DOCKER (read-only compose status)
  # ─────────────────────────────────────────────────────────────────────────
  docker.compose.status:
    description: "Read-only docker compose status per stack (no restarts, no deploys)."
    tags: [docker]
    command: "./ops/plugins/docker/bin/docker-compose-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  docker.compose.logs:
    description: "Read-only: docker compose logs for a declared stack (WARNING: may include secrets)."
    tags: [docker]
    command: "./ops/plugins/docker/bin/docker-compose-logs"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  docker.compose.up:
    description: "Mutating: docker compose up -d for a declared stack."
    tags: [docker]
    command: "./ops/plugins/docker/bin/docker-compose-up"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  docker.compose.down:
    description: "Mutating: docker compose down for a declared stack."
    tags: [docker]
    command: "./ops/plugins/docker/bin/docker-compose-down"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  docker.compose.pull:
    description: "Mutating: docker compose pull for a declared stack."
    tags: [docker]
    command: "./ops/plugins/docker/bin/docker-compose-pull"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # BACKUP (read-only inventory status)
  # ─────────────────────────────────────────────────────────────────────────

  # ─────────────────────────────────────────────────────────────────────────
  # SERVICES (read-only HTTP health probes)
  # ─────────────────────────────────────────────────────────────────────────
  services.health.status:
    description: "Read-only HTTP health probe for declared service endpoints (no auth, no verbose)."
    tags: [services]
    command: "./ops/plugins/services/bin/services-health-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # MEDIA (read-only metrics)
  # default classification: plane=domain_external, domain=media
  # ─────────────────────────────────────────────────────────────────────────
  media.metrics.today:
    description: "Read-only: count imported movies today from Radarr history (bounded titles sample)."
    tags: [media]
    command: "./ops/plugins/media/bin/media-metrics-today"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
      - secrets.projects.status
    outputs: ["stdout"]
  media.health.check:
    description: "Aggregate health check across media-stack VMs (209/210) — probes health endpoints for all active services."
    tags: [media, health]
    command: "./ops/plugins/media/bin/media-health-check"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/tools/src/
  media.stack.restart:
    description: "Restart docker compose stacks on media VMs (download-stack, streaming-stack). Dry-run by default."
    tags: [media, docker]
    command: "./ops/plugins/media/bin/media-stack-restart"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/tools/src/
  media.backup.create:
    description: "Create config volume snapshots for media services on both VMs. Retention: 7 days."
    tags: [media, backup]
    command: "./ops/plugins/media/bin/media-backup-create"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/tools/src/
  media.service.status:
    description: "Get container status for media services — maps container names to service status from binding."
    tags: [media, docker, status]
    command: "./ops/plugins/media/bin/media-service-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/tools/src/
  media.nfs.verify:
    description: "Verify NFS mount health for media VMs — checks RW/RO modes and free space."
    tags: [media, nfs, storage]
    command: "./ops/plugins/media/bin/media-nfs-verify"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/tools/src/
  media.status:
    description: "Unified media stack status dashboard — VM status, service counts, NFS health, storage."
    tags: [media, status, dashboard]
    command: "./ops/plugins/media/bin/media-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: media
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/media/tools/src/
  backup.status:
    description: "Read-only backup inventory status (file_glob only, freshness + reason codes)."
    tags: [backup]
    command: "./ops/plugins/backup/bin/backup-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    # NOTE: No requires - script handles SSH errors per-target with reason codes.
    # Run ssh.target.status separately if you need pre-flight SSH connectivity check.
    outputs: ["stdout"]
    plane: domain_external
    domain: backup
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/backup/
  backup.vzdump.status:
    description: "Read-only: show vzdump job config and latest vzdump artifacts on pve."
    tags: [backup]
    command: "./ops/plugins/backup/bin/backup-vzdump-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: backup
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/backup/
  backup.vzdump.vmid.set:
    description: "Mutating: update vmid list for vzdump job in /etc/pve/jobs.cfg (dry-run by default)."
    tags: [backup]
    command: "./ops/plugins/backup/bin/backup-vzdump-vmid-set"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: backup
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/backup/
  backup.vzdump.run:
    description: "Mutating: trigger vzdump run on pve for selected VMIDs (dry-run by default)."
    tags: [backup]
    command: "./ops/plugins/backup/bin/backup-vzdump-run"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: backup
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/backup/
  backup.vzdump.prune:
    description: "Mutating: prune vzdump backups on pve storage (dry-run by default; use --execute)."
    tags: [backup]
    command: "./ops/plugins/backup/bin/backup-vzdump-prune"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: backup
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/backup/
  backup.calendar.generate:
    description: "Generate ICS calendar from backup schedule binding (iPhone-subscribeable)."
    tags: [backup]
    command: "./ops/plugins/backup/bin/backup-calendar-generate"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: backup
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/backup/
  # ─────────────────────────────────────────────────────────────────────────
  # HOST (read-only home/config/entrypoint drift audit)
  # ─────────────────────────────────────────────────────────────────────────
  host.drift.audit:
    description: "Audit host-level drift across active configs, launchd entrypoints, and home output sinks."
    tags: [host]
    command: "./ops/plugins/host/bin/host-drift-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.claude.entrypoint.status:
    description: "Check Claude entrypoint compliance (shim, path case, forbidden headings)."
    tags: [host]
    command: "./ops/plugins/host/bin/host-claude-entrypoint-lock"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.claude.entrypoint.canonicalize:
    description: "Canonicalize Claude home files: rewrite CLAUDE.md to shim, fix path case."
    tags: [host]
    command: "./ops/plugins/host/bin/host-claude-entrypoint-lock --execute"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.hidden.inventory.status:
    description: "Hidden-root inventory: classify all dot-entries under $HOME as managed/volatile/excluded/forbidden/unmanaged."
    tags: [host]
    command: "./ops/plugins/host/bin/host-hidden-root-inventory"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.macbook.drift.check:
    description: "Read-only: enforce MacBook drift invariants (Claude entrypoint + workbench verifier)."
    tags: [host]
    command: "./ops/plugins/host/bin/host-macbook-drift-check"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.macbook.managed_configs.apply:
    description: "Mutating: enforce managed config symlinks and canonicalize Claude entrypoint, then verify."
    tags: [host]
    command: "./ops/plugins/host/bin/host-macbook-managed-configs-apply"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.macbook.bootstrap:
    description: "Mutating: bootstrap fresh Mac to spine-ready state (CLI tools, configs, symlinks, entrypoints). Idempotent, phased."
    tags: [host]
    command: "./ops/plugins/host/bin/host-macbook-bootstrap"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.launchagents.sync:
    description: "Mutating: sync spine-managed launchd templates into ~/Library/LaunchAgents and reload labels to eliminate scheduler wiring drift."
    tags: [host, launchd, scheduler]
    command: "./ops/plugins/host/bin/host-launchagents-sync"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.streamdeck.status:
    description: "Check Stream Deck HA controller LaunchAgent status (loaded, PID, log paths)."
    tags: [host]
    command: "./ops/plugins/host/bin/host-streamdeck-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.streamdeck.reload:
    description: "Mutating: reload Stream Deck HA controller LaunchAgent (bootout + bootstrap)."
    tags: [host]
    command: "./ops/plugins/host/bin/host-streamdeck-reload"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  host.streamdeck.snapshot:
    description: "Snapshot Stream Deck HA controller config to tracked workbench location"
    tags: [host, streamdeck, config]
    command: "./ops/plugins/host/bin/host-streamdeck-snapshot"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # DOCS (workbench infrastructure extraction tracking)
  # ─────────────────────────────────────────────────────────────────────────
  docs.status:
    description: "Verify workbench infrastructure docs extraction integrity (file counts per dir)."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.impact.status:
    description: "Validate impact-scoped docs contract (domain runbook + notes dir + index per domain)."
    tags: [docs, impact]
    command: "./ops/plugins/docs/bin/docs-impact-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.impact.note:
    description: "Create an impact-scoped receipt note in the target domain docs and cross-link indexes."
    tags: [docs, impact]
    command: "./ops/plugins/docs/bin/docs-impact-note"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    args:
      - name: domain
        required: true
      - name: receipt_run_key
        required: true
      - name: summary
        required: false
        default: ""
    outputs: ["stdout"]
    domain: none
    plane: fabric
  infra.extraction.status:
    description: "Track infrastructure extraction coverage into workbench (23 asset groups, % complete)."
    tags: [infra]
    command: "./ops/plugins/docs/bin/infra-extraction-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  docs.lint:
    description: "Lint spine docs hierarchy: folder placement, metadata headers, README registration, legacy isolation."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-lint"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.index.verify:
    description: "Verify bidirectional parity between governance docs on disk and _index.yaml registry."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-index-verify"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.freshness.audit:
    description: "Audit freshness of authoritative governance docs (age since last_verified)."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-freshness-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.legacy.audit:
    description: "Detect legacy references (deprecated paths/names) in governance and core docs."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-legacy-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.brain.freshness:
    description: "Audit freshness of docs/brain session context files (age since last_verified)."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-brain-freshness"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.orphan.detect:
    description: "Detect .md files in core/ and governance/ unreachable from docs/README.md."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-orphan-detect"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.frontmatter.lint:
    description: "Validate YAML frontmatter structure and required fields in governance docs."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-frontmatter-lint"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.sprawl.detect:
    description: "Report governance doc sprawl metrics: counts by directory and status, threshold warnings."
    tags: [docs]
    command: "./ops/plugins/docs/bin/docs-sprawl-detect"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  docs.jd.status:
    description: "Verify Johnny Decimal documentation coverage: no duplicate IDs, all in-scope docs mapped."
    tags: [docs, johnny-decimal]
    command: "./ops/plugins/docs/bin/docs-jd-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # OBSERVABILITY (Prometheus, Grafana, Loki, Uptime Kuma — VM 205)
  # ─────────────────────────────────────────────────────────────────────────
  observability.stack.status:
    description: "Unified health check for all 5 observability services on VM 205 (Prometheus, Grafana, Loki, Uptime Kuma, Node Exporter)."
    tags: [observability, health]
    command: "./ops/plugins/observability/bin/observability-stack-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: observability
    plane: fabric
  prometheus.targets.status:
    description: "Read-only Prometheus scrape target health — shows UP/DOWN status for each job."
    tags: [observability, prometheus]
    command: "./ops/plugins/observability/bin/prometheus-targets-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: observability
    plane: fabric
  uptime.kuma.monitors.sync:
    description: "Sync Uptime Kuma monitors from services.health.yaml. Dry-run by default, --execute to create."
    tags: [observability, uptime-kuma]
    command: "./ops/plugins/observability/bin/uptime-kuma-monitors-sync"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    domain: observability
    plane: fabric
  nas.health.status:
    description: "Health check for Synology DS918+ NAS — RAID, volumes, disk SMART, temps, NFS exports."
    tags: [observability, nas, storage]
    command: "./ops/plugins/observability/bin/nas-health-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: observability
    plane: fabric
  gitea.status:
    description: "Gitea instance health and summary — version, repos, users, runners."
    tags: [observability, gitea, dev-tools]
    command: "./ops/plugins/observability/bin/gitea-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    domain: observability
    plane: fabric
  immich.status:
    description: "Immich photo server health — version, assets, disk usage, users."
    tags: [observability, immich]
    command: "./ops/plugins/observability/bin/immich-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: immich
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/immich/
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
  immich.ingest.watch:
    description: "Monitor-only yearly ingest watchdog for Immich (heartbeat, queue progression, error-rate) with guided fixes."
    tags: [observability, immich, ingest]
    command: "./ops/plugins/observability/bin/immich-ingest-watch"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: immich
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/immich/tools/immich_ingest_watchdog.py
    notes: "Runtime source is contract-driven via ops/bindings/immich.ingest.watch.contract.yaml (remote SSH mode)."
    outputs: ["stdout"]
  immich.reconcile.scan:
    description: "Scan Immich for duplicate assets — SHA checksum groups + pHash perceptual groups + EXIF metadata."
    tags: [immich, reconcile]
    command: "./ops/plugins/immich/bin/immich-reconcile-scan"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: immich
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
  immich.reconcile.plan:
    description: "Score EXIF richness and apply keeper decision order to produce deterministic keep/drop plan."
    tags: [immich, reconcile]
    command: "./ops/plugins/immich/bin/immich-reconcile-plan"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: immich
    outputs: ["stdout"]
  immich.reconcile.review:
    description: "Human-readable summary of keep/drop plan with confidence breakdown and actionable next steps."
    tags: [immich, reconcile]
    command: "./ops/plugins/immich/bin/immich-reconcile-review"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: immich
    outputs: ["stdout"]
  immich.reconcile.apply:
    description: "Execute keep/drop plan — trash dropped assets via Immich API, write rollback manifest."
    tags: [immich, reconcile]
    command: "./ops/plugins/immich/bin/immich-reconcile-apply"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: immich
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
  immich.reconcile.rollback:
    description: "Reverse a prior apply batch — restore trashed assets using rollback manifest."
    tags: [immich, reconcile]
    command: "./ops/plugins/immich/bin/immich-reconcile-rollback"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: immich
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
  finance.stack.status:
    description: "Finance services health on VM 211 — Firefly III, Paperless-ngx, Ghostfolio, Mail Archiver."
    tags: [observability, finance]
    command: "./ops/plugins/observability/bin/finance-stack-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: domain_external
    domain: finance
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: agents/finance/
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
  finance.ronny.action.queue:
    description: "Generate deterministic Ronny finance action queue for monthly/quarterly/annual handoff cadence."
    tags: [finance, operations, compliance, queue]
    command: "./ops/plugins/secrets/bin/secrets-exec -- ./ops/plugins/observability/bin/finance-ronny-action-queue"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: finance
    implementation_repo: /Users/ronnyworks/code/agentic-spine
    implementation_path: ops/plugins/observability/
    outputs: ["stdout", "mailroom/outbox/finance/ronny-action-queue-latest.json"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    args:
      - name: cadence
        required: false
        default: monthly
      - name: period_start
        required: false
      - name: period_end
        required: false
  idrac.health.status:
    description: "Dell iDRAC health via PVE jump host — Redfish API with IPMI fallback."
    tags: [observability, idrac, hardware]
    command: "./ops/plugins/observability/bin/idrac-health-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    domain: observability
    plane: fabric
  switch.health.status:
    description: "Dell N2024P managed switch health via PVE jump host — SSH probe with ping fallback."
    tags: [observability, switch, network]
    command: "./ops/plugins/observability/bin/switch-health-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    domain: network
    plane: fabric
  mcp.inventory.status:
    description: "Validate workbench MCP inventory vs MCPJungle configs (read-only)."
    tags: [mcp]
    command: "./ops/plugins/mcp/bin/mcp-inventory-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mcp.runtime.status:
    description: "Validate MCP runtime registrations across Codex, Claude Desktop, and OpenCode against mcp.runtime.contract."
    tags: [mcp]
    command: "./ops/plugins/mcp/bin/mcp-runtime-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  mcp.health.probe:
    description: "Probe all registered MCP servers for reachability across governed surfaces."
    tags: [mcp, health]
    command: "./ops/plugins/mcp/bin/mcp-health-probe"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.mcp.serve:
    description: "Unified MCP gateway server (stdio) for governed capability execution and discovery."
    tags: [mcp, gateway, aof]
    command: "python3 ./ops/plugins/mcp-gateway/bin/spine-mcp-serve"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # INFRA RELOCATION (read-only VM/service move governance)
  # ─────────────────────────────────────────────────────────────────────────
  infra.placement.policy:
    description: "Canonical placement policy check (site/hypervisor/vmid/service target enforcement)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-placement-policy-check --check all"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.hypervisor.identity:
    description: "Verify proxmox host identity uniqueness (id/hostname/machine-id) to prevent wrong-host execution."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-hypervisor-identity-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.docker_host.status:
    description: "Read-only docker-host governance status: SSH runtime facts + host-scoped health probe parity."
    tags: [infra, docker-host]
    command: "./ops/plugins/infra/bin/infra-docker-host-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.hypervisor.hostname.set:
    description: "Set canonical hostname for a proxmox host-id (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-hypervisor-hostname-set"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - infra.placement.policy
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.timezone.set:
    description: "Set timezone + enable NTP on infrastructure hosts (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-timezone-set"
    cwd: "$SPINE_REPO"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.relocation.preflight:
    description: "Pre-flight check: host reachability + health baseline for relocation manifest."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-relocation-preflight"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.relocation.parity:
    description: "Verify cross-SSOT parity + canonical placement policy for relocation manifest."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-relocation-parity"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.relocation.impact:
    description: "Print required docs/bindings/gates delta matrix for current relocation."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-relocation-impact"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.relocation.rollback.plan:
    description: "Generate deterministic rollback checklist and commands for current relocation."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-relocation-rollback"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.vm.provision:
    description: "Provision Proxmox VM from relocation target/profile (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-vm-provision"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.preflight
      - infra.relocation.parity
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.vm.bootstrap:
    description: "Bootstrap a provisioned VM to spine-ready profile baseline (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-vm-bootstrap"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.preflight
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.relocation.state.transition:
    description: "Controlled relocation state transition + vm_targets status/IP update (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-relocation-state-transition"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.parity
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.relocation.service.transition:
    description: "Controlled service status update within relocation manifest (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-relocation-service-transition"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.parity
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.relocation.promote:
    description: "Promotion gate runner: validates promotion gates (tunnel, health, rollback; optional soak window), then promotes service from cutover to migrated with full gate verification (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-relocation-promote"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - infra.placement.policy
      - infra.hypervisor.identity
      - infra.relocation.parity
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  infra.proxmox.node_path.migrate:
    description: "Fix Proxmox node-name mismatch by migrating /etc/pve/nodes/<from> -> <to> on a hypervisor (dry-run by default, --execute to mutate)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-proxmox-node-path-migrate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    plane: fabric
    domain: infra
    requires:
      - infra.hypervisor.identity
    outputs: ["stdout"]
  infra.vm.ready.status:
    description: "Read-only readiness report for relocation VM target (running + ssh + tailscale + profile checks)."
    tags: [infra]
    command: "./ops/plugins/infra/bin/infra-vm-ready-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: infra
    plane: fabric
  # ─────────────────────────────────────────────────────────────
  # BUDGET (read-only token budget diagnostics)
  # ─────────────────────────────────────────────────────────────
  budget.check:
    description: "Check token budget against a receipt (read-only diagnostic)."
    tags: [budget]
    command: "./ops/plugins/budget/bin/budget"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # MAKER (digital-to-physical toolkit)
  # ─────────────────────────────────────────────────────────────────────────
  maker.tools.status:
    description: "Read-only maker tools inventory probe (installed/missing/hardware status)."
    tags: [maker]
    command: "./ops/plugins/maker/bin/maker-tools-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  maker.qr.generate:
    description: "Generate QR code (PNG/SVG/terminal) to mailroom/outbox/maker/."
    tags: [maker]
    command: "./ops/plugins/maker/bin/maker-qr-generate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - maker.tools.status
    outputs: ["stdout"]
    domain: none
    plane: fabric
  maker.label.print:
    description: "Print label to Brother QL thermal printer (requires hardware)."
    tags: [maker]
    command: "./ops/plugins/maker/bin/maker-label-print"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    requires:
      - maker.tools.status
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # AUDIT
  # ─────────────────────────────────────────────────────────────────────────
  audit.export.governance_iac:
    description: "Export repo tree + governance/IaC significant file contents for spine + workbench (redacted)"
    tags: [audit]
    command: "./ops/plugins/audit/bin/audit-export"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.audit.triage:
    description: "Triage certification audit findings against tracked gaps and loops"
    tags: [spine]
    command: "./ops/plugins/audit/bin/audit-triage"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  agent.session.closeout:
    description: "Cross-ref recent sessions against open loops; report actionable/stale/blocked status"
    command: "./ops/plugins/audit/bin/agent-session-closeout"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    tags: ["governance", "loops", "audit"]
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.release.zip:
    description: "Build a sharable zip artifact of the spine repo at HEAD (mailroom/outbox)."
    command: "./ops/plugins/release/bin/spine-release-zip"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    tags: ["release"]
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # HOME INFRASTRUCTURE (read-only status checks)
  # ─────────────────────────────────────────────────────────────────────────
  home.backup.status:
    description: "Check backup artifact freshness on proxmox-home NAS storage (VMs 100-102, LXCs 103/105)."
    tags: [backup, home]
    command: "./ops/plugins/home/bin/home-backup-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: home
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/home/
  home.vm.status:
    description: "Check VM/LXC running state on proxmox-home (qm list + pct list via SSH)."
    tags: [home, proxmox]
    command: "./ops/plugins/home/bin/home-vm-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: home
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/home/
  home.health.check:
    description: "HTTP health probe for home services (HA :8123, Vaultwarden :8080 via Tailscale)."
    tags: [home, health]
    command: "./ops/plugins/home/bin/home-health-check"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    plane: domain_external
    domain: home
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/home/
  home.health.alert:
    description: "Run home health probes and send HA persistent notification on failure"
    tags: [home, health, alerting]
    command: "./ops/plugins/home/bin/home-health-alert"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    touches_api: true
    requires:
      - secrets.binding
      - secrets.auth.status
    outputs: ["stdout"]
    plane: domain_external
    domain: home
    implementation_repo: /Users/ronnyworks/code/workbench
    implementation_path: docs/infrastructure/domains/home/
  # ─────────────────────────────────────────────────────────────────────────
  # PROPOSALS (mailroom-gated writes)
  # ─────────────────────────────────────────────────────────────────────────
  proposals.submit:
    description: "Create a new change proposal in mailroom/outbox/proposals/"
    command: "./ops/plugins/proposals/bin/proposals-submit"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    tags: ["proposals", "mailroom"]
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  proposals.list:
    description: "List all pending change proposals"
    command: "./ops/plugins/proposals/bin/proposals-list"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    tags: ["proposals", "mailroom"]
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  proposals.apply:
    description: "Apply a change proposal to the repo (creates commit)"
    command: "./ops/plugins/proposals/bin/proposals-apply"
    cwd: "$SPINE_CODE"
    safety: destructive
    approval: manual
    lifecycle: ready
    tags: ["proposals", "mailroom"]
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  proposals.status:
    description: "Proposal queue health summary with SLA breach detection"
    command: "./ops/plugins/proposals/bin/proposals-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    tags: ["proposals", "mailroom"]
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  proposals.supersede:
    description: "Mark a proposal as superseded with reason"
    command: "./ops/plugins/proposals/bin/proposals-supersede"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    tags: ["proposals", "mailroom"]
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  proposals.archive:
    description: "Archive old applied/superseded proposals to .archived/"
    command: "./ops/plugins/proposals/bin/proposals-archive"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    tags: ["proposals", "mailroom"]
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  proposals.reconcile:
    description: "Check proposal manifests against lifecycle contract"
    command: "./ops/plugins/proposals/bin/proposals-reconcile"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    tags: ["proposals", "mailroom"]
    outputs: ["stdout"]
    domain: loop_gap
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # AGENT ROUTING (domain agent discovery)
  # ─────────────────────────────────────────────────────────────────────────
  agent.health.check-all:
    description: "Probe configured agent endpoints and return aggregate health for strict task-claim preflight."
    tags: [agent, routing, health]
    command: "./ops/plugins/agent/bin/agent-health-check-all"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  agent.info:
    description: "Show machine-queryable registry details for an agent ID (mcp_tools, capabilities, write_scope, gates, endpoints)."
    tags: [agent, routing, registry]
    command: "./ops/plugins/agent/bin/agent-info"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  agent.tools:
    description: "Show tool/capability surface for an agent ID from agents.registry.yaml."
    tags: [agent, routing, registry]
    command: "./ops/plugins/agent/bin/agent-tools"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  agent.route:
    description: "Route a domain keyword to the correct agent (deterministic lookup from agents.registry.yaml)"
    tags: [agent, routing]
    command: "./ops/plugins/agent/bin/agent-route"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # DYNAMIC CONTEXT DELIVERY
  # ─────────────────────────────────────────────────────────────────────────
  spine.context:
    description: "Dynamic governance context delivery — serves governance brief + live spine state + agent summary. Replaces static embed injection in session hooks."
    tags: [context, governance, session]
    command: "./ops/plugins/context/bin/spine-context"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # WORKTREE SESSION ISOLATION
  # ─────────────────────────────────────────────────────────────────────────
  worktree.session.status:
    description: "Read-only: report current branch/worktree identity and enforceable D140 session isolation checks."
    tags: [worktree, session, governance]
    command: "./ops/plugins/ops/bin/worktree-session-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    plane: fabric
    domain: none
    outputs: ["stdout"]
  # ─────────────────────────────────────────────────────────────────────────
  # AOF KERNEL ABSTRACTION (environment contracts + bootstrap)
  # ─────────────────────────────────────────────────────────────────────────
  aof.bootstrap:
    description: "Seed environment + identity contracts from AOF profile templates (mutating)"
    tags: [aof, bootstrap, contracts]
    command: "./ops/plugins/aof/bin/bootstrap-spine.sh"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.validate:
    description: "Validate .environment.yaml/.identity.yaml contract structure"
    tags: [aof, validation, contracts]
    command: "./ops/plugins/aof/bin/validate-environment.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.contract.status:
    description: "Show AOF contract acknowledgement status for current workspace"
    tags: [aof, contracts, status]
    command: "./ops/plugins/aof/bin/contract-read-check.sh --status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.contract.acknowledge:
    description: "Create daily AOF contract acknowledgment marker for current workspace"
    tags: [aof, contracts, acknowledge]
    command: "./ops/plugins/aof/bin/contract-read-check.sh --ack"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.status:
    description: "AOF health summary: contract state, gates, caps, policy, gaps"
    tags: [aof, status, operator]
    command: "./ops/plugins/aof/bin/aof-status.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.version:
    description: "AOF version and contract info: commit, schema, presets, gate version"
    tags: [aof, version, operator]
    command: "./ops/plugins/aof/bin/aof-version.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.policy.show:
    description: "Show current policy preset with all 11 knob values and discovery chain"
    tags: [aof, policy, operator]
    command: "./ops/plugins/aof/bin/aof-policy-show.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.policy.autotune:
    description: "Weekly gate/check policy autotune advisor — analyzes governance load and recommends knob adjustments"
    tags: [aof, policy, operator, autotune]
    command: "./ops/plugins/aof/bin/aof-policy-autotune.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.tenant.show:
    description: "Show tenant profile summary (identity, secrets, policy, runtime, surfaces)"
    tags: [aof, tenant, operator]
    command: "./ops/plugins/aof/bin/aof-tenant-show.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  aof.verify:
    description: "Run AOF product gates D91-D97 focused verification"
    tags: [aof, verify, operator, gates]
    command: "./ops/plugins/aof/bin/aof-verify.sh"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # TENANT MANAGEMENT (AOF product)
  # ─────────────────────────────────────────────────────────────────────────
  tenant.profile.validate:
    description: "Validate a tenant profile YAML against the AOF tenant schema"
    tags: [tenant, validation, aof]
    command: "./ops/plugins/tenant/bin/tenant-profile-validate"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  tenant.provision.dry-run:
    description: "Print deterministic provisioning plan from a tenant profile (no mutation)"
    tags: [tenant, provisioning, aof]
    command: "./ops/plugins/tenant/bin/tenant-provision-dry-run"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  tenant.storage.audit:
    description: "Verify runtime storage paths comply with tenant storage contract boundaries"
    tags: [tenant, storage, audit, aof]
    command: "./ops/plugins/tenant/bin/tenant-storage-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  policy.runtime.audit:
    description: "Report policy knob enforcement wiring status against runtime contract"
    tags: [policy, enforcement, audit, aof]
    command: "./ops/plugins/policy/bin/policy-runtime-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  version.compat.verify:
    description: "Verify version compatibility matrix consistency and source file validity"
    tags: [version, compatibility, verify, aof]
    command: "./ops/plugins/version/bin/version-compat-verify"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  evidence.export.plan:
    description: "Dry-run plan for evidence export and retention (no mutations)"
    tags: [evidence, retention, export, aof]
    command: "./ops/plugins/evidence/bin/evidence-export-plan"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: aof
    plane: fabric
  receipts.index.build:
    description: "Build or refresh receipts intelligence index (incremental by default)."
    tags: [receipts, evidence, aof]
    command: "./ops/plugins/evidence/bin/receipts-index-build"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "ops/plugins/evidence/state/receipt-index.yaml"]
    domain: none
    plane: fabric
  receipts.summary:
    description: "Receipts summary for a configurable time window (total/pass/fail/top capabilities)."
    tags: [receipts, evidence, aof]
    command: "./ops/plugins/evidence/bin/receipts-summary"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  receipts.trends:
    description: "Daily receipts trend report with failure-rate rollup."
    tags: [receipts, evidence, aof]
    command: "./ops/plugins/evidence/bin/receipts-trends"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  receipts.search:
    description: "Search receipts by status/capability/time window."
    tags: [receipts, evidence, aof]
    command: "./ops/plugins/evidence/bin/receipts-search"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  receipts.rotate:
    description: "Archive receipt sessions older than retention policy (dry-run by default; --execute to mutate)."
    tags: [receipts, evidence, retention, aof]
    command: "./ops/plugins/evidence/bin/receipts-rotate"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: manual
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.graph.show:
    description: "Render canonical spine execution graph views (mermaid/json/yaml)."
    tags: [spine, evidence, graph, observability]
    command: "./ops/plugins/evidence/bin/spine-graph-show"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.timeline.query:
    description: "Query normalized timeline events from receipts index + runtime/repo state surfaces."
    tags: [spine, evidence, timeline, observability]
    command: "./ops/plugins/evidence/bin/spine-timeline-query"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  spine.timeline.report:
    description: "Write timeline audit reports to runtime outbox audits. Mutating; writer-lane only in multi-terminal mode (proposal/apply flow)."
    tags: [spine, evidence, timeline, observability, audits]
    command: "./ops/plugins/evidence/bin/spine-timeline-report"
    cwd: "$SPINE_CODE"
    safety: mutating
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "mailroom/outbox/audits/*"]
    domain: none
    plane: fabric
  surface.mobile.dashboard.status:
    description: "Mobile/customer read-only dashboard summary as JSON envelope from spine control tick."
    tags: [surface, readonly, mobile, aof]
    command: "./ops/plugins/evidence/bin/spine-control tick --json"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  surface.readonly.audit:
    description: "Verify surface readonly contract compliance and capability coverage"
    tags: [surface, readonly, audit, aof]
    command: "./ops/plugins/surface/bin/surface-readonly-audit"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: none
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # HA IDENTITY + MUTATION CONTRACT
  # ─────────────────────────────────────────────────────────────────────────
  ha.identity.mutation.contract.status:
    description: "Validate HA identity/mutation contract integrity: file exists, required sections, SSOT surfaces, cross-references"
    tags: [ha, identity, mutation, contract, status, home]
    command: "./ops/plugins/home/bin/ha-identity-mutation-contract-status"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout"]
    domain: home-assistant
    plane: fabric
  # ─────────────────────────────────────────────────────────────────────────
  # SLO MONITORING
  # ─────────────────────────────────────────────────────────────────────────
  slo.evidence.daily:
    description: "Collect daily SLO evidence (stability snapshot + verify pack) and write dated audit file"
    tags: [slo, monitoring, evidence, daily]
    command: "./ops/plugins/slo/bin/slo-evidence-daily"
    cwd: "$SPINE_CODE"
    safety: read-only
    approval: auto
    lifecycle: ready
    outputs: ["stdout", "file"]
    produces_files:
      - "docs/governance/_audits/slo-evidence-*.md"
    domain: observability
    plane: fabric
# ═══════════════════════════════════════════════════════════════════════════
# Safety Levels
# ═══════════════════════════════════════════════════════════════════════════
#
# read-only:   Cannot modify state. Safe to run autonomously.
# mutating:    Modifies state but is recoverable. Requires receipt.
# destructive: Cannot be undone. Requires manual approval + confirmation.
#
# ═══════════════════════════════════════════════════════════════════════════
