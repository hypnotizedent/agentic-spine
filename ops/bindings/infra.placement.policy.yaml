version: 1
updated: "2026-02-07"
owner: "@ronny"

# Canonical placement policy for infrastructure hosts, VMIDs, and service targets.
# This binding prevents "wrong Proxmox target" drift by making placement explicit.

sites:
  shop:
    proxmox_hosts: ["pve"]
    vmid_min: 200
    vmid_max: 299
  home:
    proxmox_hosts: ["proxmox-home"]
    vmid_min: 100
    vmid_max: 199
  mobile:
    proxmox_hosts: []

hosts:
  pve:
    site: shop
    kind: proxmox
    machine_id: "0c6d2574dd0a48f6ba0486467c3111a9"
  proxmox-home:
    site: home
    kind: proxmox
    machine_id: "e7cabb72eac944c1b216d751691094a5"
  infra-core:
    site: shop
    kind: vm
  observability:
    site: shop
    kind: vm
  dev-tools:
    site: shop
    kind: vm
  docker-host:
    site: shop
    kind: vm
  automation-stack:
    site: shop
    kind: vm
  media-stack:
    site: shop
    kind: vm
  macbook:
    site: mobile
    kind: workstation
  nas:
    site: home
    kind: storage
  vault:
    site: home
    kind: vm

vm_target_requirements:
  infra-core:
    required_site: shop
    required_proxmox_host: pve
  observability:
    required_site: shop
    required_proxmox_host: pve
  dev-tools:
    required_site: shop
    required_proxmox_host: pve

service_placement:
  cloudflared:
    primary_site: shop
    dr_sites: ["shop", "home"]
  pihole:
    primary_site: shop
    dr_sites: ["shop", "home"]
  infisical:
    primary_site: shop
    dr_sites: ["shop", "home"]
  vaultwarden:
    primary_site: shop
    dr_sites: ["home"]
  prometheus:
    primary_site: shop
    dr_sites: ["home"]
  grafana:
    primary_site: shop
    dr_sites: ["home"]
  loki:
    primary_site: shop
    dr_sites: ["home"]
  uptime-kuma:
    primary_site: shop
    dr_sites: ["home"]
  gitea:
    primary_site: shop
    dr_sites: ["home"]

guards:
  enforce_vmid_ranges: true
  require_explicit_vm_target_requirements: true
  require_service_policy_for_manifest_services: true
  enforce_service_primary_site: true
  enforce_vm_site_matches_hypervisor_site: true
