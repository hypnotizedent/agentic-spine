# Status: authoritative
# Last verified: 2026-03-01

version: 1
updated_at: "2026-03-01"
owner: "@ronny"

# Calendar timezone for scheduled tasks. Must be an IANA TZ (for iPhone).
timezone: "America/New_York"

# Stable anchor date for DTSTART on recurring events (keeps ICS deterministic).
dtstart_date: "2026-02-10"

# Human label for calendar clients.
calendar_name: "Spine Backups"

events:
  # Proxmox vzdump schedule from receipt:
  # - receipts/sessions/RCAP-20260210-092928__backup.vzdump.status__Rtqd959679/receipt.md
  - id: "pve-vzdump-daily"
    summary: "Proxmox vzdump (pve) daily"
    freq: "DAILY"
    byhour: 2
    byminute: 0
    duration_minutes: 180
    description: "pve daily vzdump window at 02:00 local; storage tank-backups. Canonical VM target source: ops/bindings/backup.inventory.yaml (runtime verify: backup.vzdump.status)."

  # Home vzdump schedules (enabled 2026-02-11)
  - id: "home-vzdump-p0-daily"
    summary: "Home vzdump P0 (HA) daily"
    freq: "DAILY"
    byhour: 3
    byminute: 0
    duration_minutes: 30
    description: "proxmox-home P0 daily vzdump window at 03:00 local; storage synology-backups. Canonical VM target source: ops/bindings/backup.inventory.yaml (runtime verify: backup.vzdump.status)."

  - id: "home-vzdump-p2-weekly"
    summary: "Home vzdump P2 (pihole) weekly"
    freq: "WEEKLY"
    byhour: 4
    byminute: 0
    duration_minutes: 120
    description: "proxmox-home P2 weekly vzdump window (Sun 04:00 local); storage synology-backups. Canonical VM target source: ops/bindings/backup.inventory.yaml (runtime verify: backup.vzdump.status)."

  # App-level backups (authoritative docs):
  - id: "vaultwarden-backup"
    summary: "Vaultwarden app backup (infra-core -> NAS)"
    freq: "DAILY"
    byhour: 2
    byminute: 45
    duration_minutes: 15
    description: "Cron on infra-core runs daily at 02:45; tar.gz + rsync to /volume1/backups/apps/vaultwarden/."
    source: "docs/governance/VAULTWARDEN_BACKUP_RESTORE.md"

  - id: "infisical-backup"
    summary: "Infisical DB backup (infra-core -> NAS)"
    freq: "DAILY"
    byhour: 2
    byminute: 50
    duration_minutes: 15
    description: "Cron on infra-core runs daily at 02:50; pg_dump + rsync to /volume1/backups/apps/infisical/."
    source: "docs/governance/INFISICAL_BACKUP_RESTORE.md"

  - id: "gitea-backup"
    summary: "Gitea backup (dev-tools -> NAS)"
    freq: "DAILY"
    byhour: 2
    byminute: 55
    duration_minutes: 20
    description: "Cron on dev-tools runs daily at 02:55; gitea dump + pg_dump + rsync to /volume1/backups/apps/gitea/."
    source: "docs/governance/GITEA_BACKUP_RESTORE.md"

  - id: "finance-stack-backup"
    summary: "Finance stack app backups (VM 211 -> NAS)"
    freq: "DAILY"
    byhour: 6
    byminute: 20
    duration_minutes: 45
    description: "Cron on finance-stack runs daily at 06:20; firefly + ghostfolio + paperless DB dumps and paperless document export are rsynced to NAS."
    source: "docs/governance/FINANCE_STACK_BACKUP_RESTORE.md"

  - id: "mail-archiver-backup"
    summary: "Mail-archiver app backups (VM 214 communications-stack)"
    freq: "DAILY"
    byhour: 2
    byminute: 20
    duration_minutes: 15
    description: "pg_dump + uploads tar on communications-stack VM 214. Schedule: 02:20 (pg_dump), 02:35 (uploads). Retention: 30d postgres, 14d uploads."
    source: "ops/bindings/backup.schedule.yaml"

  - id: "media-config-backup"
    summary: "Media config-state backup (download + streaming)"
    freq: "DAILY"
    byhour: 3
    byminute: 45
    duration_minutes: 30
    description: "Create config-state archives for media stacks from /mnt/docker/volumes + /opt/appdata. Payload media paths are excluded."
    source: "ops/bindings/backup.schedule.yaml"

  - id: "backup-monitor-hourly"
    summary: "Backup monitor + alert dispatch check"
    freq: "HOURLY"
    byminute: 15
    duration_minutes: 5
    description: "Runs backup.monitor for freshness degradation detection and governed alert intent dispatch."
    source: "ops/bindings/backup.schedule.yaml"

  - id: "media-config-restore-drill"
    summary: "Media config restore drill (dry-run)"
    freq: "MONTHLY"
    byhour: 4
    byminute: 30
    duration_minutes: 20
    description: "Dry-run restore drill for media config-state class using governed media.backup.restore flow."
    source: "ops/bindings/backup.schedule.yaml"

  - id: "tier1-small-state-restore-drill"
    summary: "Tier1 small-state restore drill (dry-run)"
    freq: "MONTHLY"
    byhour: 5
    byminute: 0
    duration_minutes: 20
    description: "Quarterly dry-run restore drill for tier1 small-state assets (Infisical anchor)."
    source: "ops/bindings/backup.schedule.yaml"

  # Offsite sync (binding note):
  - id: "vzdump-offsite-sync"
    summary: "Offsite sync: critical vzdump -> NAS"
    freq: "DAILY"
    byhour: 9
    byminute: 0
    duration_minutes: 60
    description: "pve:/usr/local/bin/vzdump-offsite-sync.sh (cron 09:00 local). Syncs critical VM backups to NAS over Tailscale."
    source: "ops/bindings/backup.inventory.yaml"
