# Worktree Session Isolation Contract
# Status: authoritative
# Last verified: 2026-02-18
# Scope: session-entry hook + ops preflight + D140 drift gate

version: "1.0"
updated: "2026-02-18"
owner: "@ronny"
scope: worktree-session-isolation

policy:
  enabled: true
  main_branch: "main"
  managed_worktree_prefix: "/Users/ronnyworks/code/agentic-spine-.worktrees/"
  require_non_main_in_managed_worktree: false
  require_explicit_identity_on_non_main: false
  identity_env_var: "OPS_WORKTREE_IDENTITY"
  bypass_env_var: "OPS_WORKTREE_ISOLATION_BYPASS"
  bypass_allowed_value: "1"
  identity_patterns:
    - "^LOOP-[A-Z0-9-]+$"
    - "^CP-[A-Z0-9-]+$"
  allow_detached_head: false

messages:
  remediation: "Run ./bin/ops start loop <LOOP_ID> to create an isolated worktree, then export OPS_WORKTREE_IDENTITY=<LOOP_ID> before operating on a non-main branch."
  bypass_warning: "Emergency bypass only: export OPS_WORKTREE_ISOLATION_BYPASS=1"
