# Status: authoritative
# Last verified: 2026-02-25

version: 1
updated_at: "2026-02-25"
owner: "@ronny"
scope: communications-alerts-queue-slo

# SLO thresholds for alerting email intent queue health.
# Evaluated by communications.alerts.queue.slo.status capability.

slo:
  warn_age_seconds: 3600
  incident_age_seconds: 14400
  max_pending_warn: 50
  max_pending_incident: 200
  dead_letter_warn: 1
  dead_letter_incident: 10

dispatcher:
  enabled: true
  poll_interval_seconds: 60
  batch_limit: 10
  pid_file: "$SPINE_OUTBOX/communications/.alerts-dispatcher.pid"
  heartbeat_file: "$SPINE_OUTBOX/communications/alerts-dispatcher-heartbeat.json"
  log_file: "$SPINE_OUTBOX/communications/alerts-dispatcher.log"

retry_policy:
  enabled: true
  max_attempts: 5
  base_delay_seconds: 60
  max_delay_seconds: 3600
  backoff_multiplier: 2
  dead_letter_dir: "$SPINE_OUTBOX/alerts/email-intents-dead-letter"

recommended_actions:
  dispatcher_start_command: "echo \"yes\" | ./bin/ops cap run communications.alerts.dispatcher.start"
  flush_command: "echo \"yes\" | ./bin/ops cap run communications.alerts.flush --limit 10"
  replay_dead_letter_command: "echo \"yes\" | ./bin/ops cap run communications.alerts.deadletter.replay --limit 10"
  queue_status_command: "./bin/ops cap run communications.alerts.queue.status"
