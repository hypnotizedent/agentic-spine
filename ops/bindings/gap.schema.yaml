# Gap Entry Schema
#
# Defines required and optional fields for entries in operational.gaps.yaml.
# Referenced by: docs/governance/GAP_LIFECYCLE.md
#
# Status: authoritative
# Last verified: 2026-02-13

schema_version: "1.0"

required_fields:
  - name: id
    type: string
    pattern: "GAP-OP-\\d+"
    description: "Unique gap identifier"

  - name: discovered_by
    type: string
    description: "Source that discovered the gap (audit name, agent, terminal-c)"

  - name: discovered_at
    type: string
    format: "YYYY-MM-DD"
    description: "Date the gap was discovered"

  - name: type
    type: enum
    values:
      - stale-ssot
      - missing-entry
      - agent-behavior
      - unclear-doc
      - duplicate-truth
      - runtime-bug
    description: "Classification of the gap"

  - name: description
    type: string
    multiline: true
    description: "Detailed description of the gap"

  - name: severity
    type: enum
    values: [low, medium, high, critical]
    description: "Impact severity"

  - name: status
    type: enum
    values: [open, fixed, closed]
    description: "Current lifecycle status"

optional_fields:
  - name: doc
    type: string
    description: "Path to affected document or file"

  - name: fixed_in
    type: string
    description: "Reference to fix (loop ID, commit, etc.) â€” set when status=fixed"

  - name: parent_loop
    type: string
    pattern: "LOOP-.*"
    description: "Orchestration linkage to parent loop"

  - name: notes
    type: string
    multiline: true
    description: "Additional context or resolution notes"

  - name: regression_lock_id
    type: string
    description: "Required non-legacy lock reference when severity is high|critical and status is fixed|closed"

validation:
  - rule: "status in [fixed, closed] and severity in [high, critical] requires regression_lock_id"
  - rule: "regression_lock_id cannot use LEGACY-NO-REGRESSION-LOCK-* for high|critical fixed/closed gaps"
