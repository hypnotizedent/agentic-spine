# Version Compatibility Matrix
# Status: authoritative
# Last verified: 2026-02-18
# Scope: aof-version-compatibility
#
# Declares compatibility between capabilities, gates, and bindings.
# Referenced by: D95 gate, version.compat.verify capability
# Referenced by: AOF_VERSION_COMPATIBILITY.md

version: 1
updated: 2026-02-28
owner: "@ronny"

# Compatibility model
# Each entry declares a component, its current version, and its dependencies.
# A dependency specifies the minimum compatible version.

components:
  drift-gate-runtime:
    type: runtime
    version: "2.8"
    source: "surfaces/verify/drift-gate.sh"
    depends_on:
      - component: gate-registry
        min_version: "1"
      - component: policy-presets
        min_version: "1"
      - component: resolve-policy
        min_version: "1"

  gate-registry:
    type: binding
    version: "1"
    source: "ops/bindings/gate.registry.yaml"
    depends_on: []

  policy-presets:
    type: binding
    version: "1"
    source: "ops/bindings/policy.presets.yaml"
    depends_on: []

  resolve-policy:
    type: library
    version: "1"
    source: "ops/lib/resolve-policy.sh"
    depends_on:
      - component: policy-presets
        min_version: "1"

  cap-runner:
    type: runtime
    version: "1"
    source: "ops/commands/cap.sh"
    depends_on:
      - component: capabilities-registry
        min_version: "1"
      - component: resolve-policy
        min_version: "1"

  capabilities-registry:
    type: binding
    version: "1"
    source: "ops/capabilities.yaml"
    depends_on:
      - component: capability-map
        min_version: "1"

  capability-map:
    type: binding
    version: "1"
    source: "ops/bindings/capability_map.yaml"
    depends_on: []

  tenant-profile-schema:
    type: binding
    version: "1"
    source: "ops/bindings/tenant.profile.schema.yaml"
    depends_on:
      - component: policy-presets
        min_version: "1"

  plugin-manifest:
    type: binding
    version: "1"
    source: "ops/plugins/MANIFEST.yaml"
    depends_on:
      - component: capabilities-registry
        min_version: "1"

  mcp-gateway:
    type: runtime
    version: "1"
    source: "ops/plugins/mcp-gateway/bin/spine-mcp-serve"
    depends_on:
      - component: capabilities-registry
        min_version: "1"
      - component: cap-runner
        min_version: "1"

  mcp-runtime-contract:
    type: binding
    version: "2"
    source: "ops/bindings/mcp.runtime.contract.yaml"
    depends_on:
      - component: mcp-gateway
        min_version: "1"

  entry-surface-contract:
    type: binding
    version: "2"
    source: "ops/bindings/entry.surface.contract.yaml"
    depends_on: []

  agent-registry:
    type: binding
    version: "2"
    source: "ops/bindings/agents.registry.yaml"
    depends_on:
      - component: capabilities-registry
        min_version: "1"

enforcement:
  gate: D95
  capability: version.compat.verify
  checks:
    - "Matrix binding exists with version field"
    - "Every component references a valid source file"
    - "Dependency graph has no missing components"
    - "No circular dependencies"
