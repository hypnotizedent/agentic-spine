# Status: authoritative
# Last verified: 2026-02-17
# Purpose: Canonical runway for secret placement and consumer onboarding.

version: 1
updated: "2026-02-17"
owner: "@ronny"

defaults:
  environment: prod
  strict_unreachable_targets: true
  fail_on_ambiguous_keys: true
  strict_unregistered_secret_keys: true

# Active projects allowed for governed writes/reads in normalization checks.
active_projects:
  - infrastructure
  - n8n
  - media-stack
  - immich
  - home-assistant
  - mint-os-api
  - ai-services

# Stack-level fallback when a secret-like key has no explicit policy route.
stack_defaults:
  finance:
    project: infrastructure
    path: /spine/services/finance
    domain: finance
  automation:
    project: n8n
    path: /
    domain: n8n
  mcpjungle:
    project: infrastructure
    path: /spine/services/mcpjungle
    domain: core
  download-stack:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
    domain: media
  streaming-stack:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
    domain: media
  immich:
    project: immich
    path: /
    domain: immich
  mint-apps:
    project: mint-os-api
    path: /
    domain: mint
  mint-data:
    project: mint-os-api
    path: /
    domain: mint
  mint-os:
    project: mint-os-api
    path: /
    domain: mint

# Domain-level defaults for non-compose surfaces.
domain_defaults:
  home-assistant:
    project: home-assistant
    path: /
  microsoft:
    project: infrastructure
    path: /spine/platform/security
  n8n-agent:
    project: infrastructure
    path: /spine/services/n8n
  communications:
    project: infrastructure
    path: /spine/services/communications

# Stack+key overrides for compose env aliases that do not match canonical
# Infisical key names.
stack_key_overrides:
  cloudflared:
    TUNNEL_TOKEN:
      project: infrastructure
      path: /spine/network/edge
      canonical_key: CLOUDFLARE_TUNNEL_TOKEN
  vaultwarden:
    ADMIN_TOKEN:
      project: infrastructure
      path: /spine/vm-infra/vaultwarden
      canonical_key: VAULTWARDEN_ADMIN_TOKEN
  caddy-auth:
    AUTHENTIK_POSTGRESQL__PASSWORD:
      project: infrastructure
      path: /spine/vm-infra/caddy-auth
      canonical_key: AUTHENTIK_DB_PASSWORD
    POSTGRES_PASSWORD:
      project: infrastructure
      path: /spine/vm-infra/caddy-auth
      canonical_key: AUTHENTIK_DB_PASSWORD
  download-stack:
    OPENVPN_USER:
      project: infrastructure
      path: /spine/vm-infra/media-stack/download
      canonical_key: PRIVADO_VPN_USER
    OPENVPN_PASSWORD:
      project: infrastructure
      path: /spine/vm-infra/media-stack/download
      canonical_key: PRIVADO_VPN_PASS
    APIKEY:
      project: infrastructure
      path: /spine/vm-infra/media-stack/download
      note: "context-dependent: resolved per-service to RADARR_API_KEY, SONARR_API_KEY, or LIDARR_API_KEY"
  streaming-stack:
    SPOTIPY_CLIENT_ID:
      project: infrastructure
      path: /spine/vm-infra/media-stack/streaming
      canonical_key: SPOTIFY_CLIENT_ID
    SPOTIPY_CLIENT_SECRET:
      project: infrastructure
      path: /spine/vm-infra/media-stack/streaming
      canonical_key: SPOTIFY_CLIENT_SECRET
    SUBSONIC_API_USER:
      project: infrastructure
      path: /spine/vm-infra/media-stack/streaming
      canonical_key: NAVIDROME_USERNAME
    SUBSONIC_API_PASS:
      project: infrastructure
      path: /spine/vm-infra/media-stack/streaming
      canonical_key: NAVIDROME_PASSWORD
  secrets:
    AUTH_SECRET:
      project: infrastructure
      path: /spine/platform/security
      canonical_key: INFISICAL_AUTH_SECRET
    ENCRYPTION_KEY:
      project: infrastructure
      path: /spine/platform/security
      canonical_key: INFISICAL_ENCRYPTION_KEY
    DB_CONNECTION_URI:
      project: infrastructure
      path: /spine/platform/security
    POSTGRES_PASSWORD:
      project: infrastructure
      path: /spine/platform/security
      canonical_key: INFISICAL_POSTGRES_PASSWORD

# Explicit key routes (overrides inferred/project-unique fallback).
key_overrides:
  FIREFLY_ACCESS_TOKEN:
    project: infrastructure
    path: /spine/services/finance
  PAPERLESS_API_TOKEN:
    project: infrastructure
    path: /spine/services/paperless
  N8N_API_KEY:
    project: infrastructure
    path: /spine/services/n8n
  N8N_ENCRYPTION_KEY:
    project: n8n
    path: /
  HA_API_TOKEN:
    project: home-assistant
    path: /
  AZURE_CLIENT_ID:
    project: infrastructure
    path: /spine/platform/security
  AZURE_CLIENT_SECRET:
    project: infrastructure
    path: /spine/platform/security
  AZURE_TENANT_ID:
    project: infrastructure
    path: /spine/platform/security
  RESEND_API_KEY:
    project: infrastructure
    path: /spine/services/communications
  FROM_EMAIL:
    project: infrastructure
    path: /spine/services/communications
  ADMIN_EMAIL:
    project: infrastructure
    path: /spine/services/communications
  TWILIO_ACCOUNT_SID:
    project: infrastructure
    path: /spine/services/communications
  TWILIO_AUTH_TOKEN:
    project: infrastructure
    path: /spine/services/communications
  TWILIO_PHONE_NUMBER:
    project: infrastructure
    path: /spine/services/communications
  IMMICH_API_KEY:
    project: immich
    path: /
  RADARR_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  SONARR_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  LIDARR_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  # Media — download-stack keys (canonical: infrastructure + /spine/vm-infra/media-stack/download)
  PRIVADO_VPN_USER:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  PRIVADO_VPN_PASS:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  HUNTARR_USER:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  HUNTARR_PASSWORD:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  AUTOPULSE_PASSWORD:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  REAL_DEBRID_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  # Media — streaming-stack keys (canonical: infrastructure + /spine/vm-infra/media-stack/streaming)
  SPOTIFY_CLIENT_ID:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
  SPOTIFY_CLIENT_SECRET:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
  NAVIDROME_USERNAME:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
  NAVIDROME_PASSWORD:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
  LASTFM_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
  LASTFM_SECRET:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
  JELLYFIN_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/streaming
  # Media — indexing/request keys (legacy media-stack project until migration — GAP-OP-904)
  PROWLARR_API_KEY:
    project: media-stack
    path: /
  JELLYFIN_API_TOKEN:
    project: media-stack
    path: /
  JELLYSEERR_API_KEY:
    project: media-stack
    path: /
  SABNZBD_API_KEY:
    project: media-stack
    path: /
  JELLYFIN_USER_ID:
    project: media-stack
    path: /
  # Mint — core application keys (mint-os-api project, root path)
  APP_KEYS:
    project: mint-os-api
    path: /
  AUTH_SECRET:
    project: mint-os-api
    path: /
  DB_PASSWORD:
    project: mint-os-api
    path: /
  STRIPE_SECRET_KEY:
    project: mint-os-api
    path: /
  # Mint module — shipping (GAP-OP-575)
  SHIPPING_API_KEY:
    project: infrastructure
    path: /spine/services/shipping
  SHIPPING_DATABASE_URL:
    project: infrastructure
    path: /spine/services/shipping
  # Mint module — pricing (GAP-OP-575)
  PRICING_API_KEY:
    project: infrastructure
    path: /spine/services/pricing
  PRICING_DATABASE_URL:
    project: infrastructure
    path: /spine/services/pricing
  # Mint module — suppliers (GAP-OP-575)
  SUPPLIERS_API_KEY:
    project: infrastructure
    path: /spine/services/suppliers
  SUPPLIERS_DATABASE_URL:
    project: infrastructure
    path: /spine/services/suppliers
  # Mint module — payment
  PAYMENT_API_KEY:
    project: infrastructure
    path: /spine/services/payment
  PAYMENT_DATABASE_URL:
    project: infrastructure
    path: /spine/services/payment

# Domain-level critical key presence checks (prevents hidden drift outside compose).
required_domain_keys:
  finance:
    project: infrastructure
    keys:
      - FIREFLY_ACCESS_TOKEN
      - PAPERLESS_API_TOKEN
  media:
    project: media-stack
    keys:
      - RADARR_API_KEY
      - SONARR_API_KEY
      - LIDARR_API_KEY
      - PROWLARR_API_KEY
      - JELLYFIN_API_TOKEN
      - JELLYSEERR_API_KEY
  n8n:
    project: n8n
    keys:
      - N8N_API_KEY
      - N8N_ENCRYPTION_KEY
  immich:
    project: immich
    keys:
      - IMMICH_API_KEY
  microsoft:
    project: infrastructure
    keys:
      - AZURE_CLIENT_ID
      - AZURE_CLIENT_SECRET
      - AZURE_TENANT_ID
  home-assistant:
    project: home-assistant
    keys:
      - HA_API_TOKEN
  mint:
    project: mint-os-api
    keys:
      - APP_KEYS
      - AUTH_SECRET
      - DB_PASSWORD
      - STRIPE_SECRET_KEY

# Deferred domain checks (not enforced by secrets.runway.status while migration is in progress).
# Mint module lanes are being replaced by fresh-slate services and should not hard-fail infra-core audits.
deferred_domain_keys:
  mint-shipping:
    project: infrastructure
    keys:
      - SHIPPING_API_KEY
      - SHIPPING_DATABASE_URL
  mint-pricing:
    project: infrastructure
    keys:
      - PRICING_API_KEY
      - PRICING_DATABASE_URL
  mint-suppliers:
    project: infrastructure
    keys:
      - SUPPLIERS_API_KEY
      - SUPPLIERS_DATABASE_URL
  mint-payment:
    project: infrastructure
    keys:
      - PAYMENT_API_KEY
      - PAYMENT_DATABASE_URL
