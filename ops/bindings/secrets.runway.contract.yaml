# Status: authoritative
# Last verified: 2026-02-17
# Purpose: Canonical runway for secret placement and consumer onboarding.

version: 1
updated: "2026-02-17"
owner: "@ronny"

defaults:
  environment: prod
  strict_unreachable_targets: true
  fail_on_ambiguous_keys: true
  strict_unregistered_secret_keys: false

# Active projects allowed for governed writes/reads in normalization checks.
active_projects:
  - infrastructure
  - n8n
  - media-stack
  - immich
  - home-assistant
  - mint-os-api
  - ai-services

# Stack-level fallback when a secret-like key has no explicit policy route.
stack_defaults:
  finance:
    project: infrastructure
    path: /spine/services/finance
    domain: finance
  automation:
    project: n8n
    path: /
    domain: n8n
  mcpjungle:
    project: infrastructure
    path: /spine/services/mcpjungle
    domain: core
  download-stack:
    project: media-stack
    path: /
    domain: media
  streaming-stack:
    project: media-stack
    path: /
    domain: media
  immich:
    project: immich
    path: /
    domain: immich
  mint-apps:
    project: mint-os-api
    path: /
    domain: mint
  mint-data:
    project: mint-os-api
    path: /
    domain: mint
  mint-os:
    project: mint-os-api
    path: /
    domain: mint

# Domain-level defaults for non-compose surfaces.
domain_defaults:
  home-assistant:
    project: home-assistant
    path: /
  ms-graph:
    project: infrastructure
    path: /spine/platform/security
  n8n-agent:
    project: infrastructure
    path: /spine/services/n8n

# Explicit key routes (overrides inferred/project-unique fallback).
key_overrides:
  FIREFLY_PAT:
    project: infrastructure
    path: /spine/services/finance
  PAPERLESS_API_TOKEN:
    project: infrastructure
    path: /spine/services/paperless
  N8N_API_KEY:
    project: infrastructure
    path: /spine/services/n8n
  N8N_ENCRYPTION_KEY:
    project: n8n
    path: /
  HA_API_TOKEN:
    project: home-assistant
    path: /
  AZURE_CLIENT_ID:
    project: infrastructure
    path: /spine/platform/security
  AZURE_CLIENT_SECRET:
    project: infrastructure
    path: /spine/platform/security
  AZURE_TENANT_ID:
    project: infrastructure
    path: /spine/platform/security
  IMMICH_API_KEY:
    project: immich
    path: /
  RADARR_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  SONARR_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  LIDARR_API_KEY:
    project: infrastructure
    path: /spine/vm-infra/media-stack/download
  # Media — streaming/indexing (media-stack project, root path)
  PROWLARR_API_KEY:
    project: media-stack
    path: /
  JELLYFIN_API_TOKEN:
    project: media-stack
    path: /
  JELLYSEERR_API_KEY:
    project: media-stack
    path: /
  # Media — canonicalized from legacy Infisical names (GAP-OP-579)
  SABNZBD_API_KEY:
    project: media-stack
    path: /
  NAVIDROME_USERNAME:
    project: media-stack
    path: /
  JELLYFIN_USER_ID:
    project: media-stack
    path: /
  # Mint — core application keys (mint-os-api project, root path)
  APP_KEYS:
    project: mint-os-api
    path: /
  AUTH_SECRET:
    project: mint-os-api
    path: /
  DB_PASSWORD:
    project: mint-os-api
    path: /
  STRIPE_SECRET_KEY:
    project: mint-os-api
    path: /
  # Mint module — shipping (GAP-OP-575)
  SHIPPING_API_KEY:
    project: infrastructure
    path: /spine/services/shipping
  SHIPPING_DATABASE_URL:
    project: infrastructure
    path: /spine/services/shipping
  # Mint module — pricing (GAP-OP-575)
  PRICING_API_KEY:
    project: infrastructure
    path: /spine/services/pricing
  PRICING_DATABASE_URL:
    project: infrastructure
    path: /spine/services/pricing
  # Mint module — suppliers (GAP-OP-575)
  SUPPLIERS_API_KEY:
    project: infrastructure
    path: /spine/services/suppliers
  SUPPLIERS_DATABASE_URL:
    project: infrastructure
    path: /spine/services/suppliers

# Domain-level critical key presence checks (prevents hidden drift outside compose).
required_domain_keys:
  finance:
    project: infrastructure
    keys:
      - FIREFLY_PAT
      - PAPERLESS_API_TOKEN
  media:
    project: media-stack
    keys:
      - RADARR_API_KEY
      - SONARR_API_KEY
      - LIDARR_API_KEY
      - PROWLARR_API_KEY
      - JELLYFIN_API_TOKEN
      - JELLYSEERR_API_KEY
  n8n:
    project: n8n
    keys:
      - N8N_API_KEY
      - N8N_ENCRYPTION_KEY
  immich:
    project: immich
    keys:
      - IMMICH_API_KEY
  ms-graph:
    project: infrastructure
    keys:
      - AZURE_CLIENT_ID
      - AZURE_CLIENT_SECRET
      - AZURE_TENANT_ID
  home-assistant:
    project: home-assistant
    keys:
      - HA_API_TOKEN
  mint:
    project: mint-os-api
    keys:
      - APP_KEYS
      - AUTH_SECRET
      - DB_PASSWORD
      - STRIPE_SECRET_KEY
  mint-shipping:
    project: infrastructure
    keys:
      - SHIPPING_API_KEY
      - SHIPPING_DATABASE_URL
  mint-pricing:
    project: infrastructure
    keys:
      - PRICING_API_KEY
      - PRICING_DATABASE_URL
  mint-suppliers:
    project: infrastructure
    keys:
      - SUPPLIERS_API_KEY
      - SUPPLIERS_DATABASE_URL
