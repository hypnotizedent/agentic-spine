# Services Health Binding
# Non-secret. Spine-native. Read-only HTTP probes.
# Status: authoritative
# Last verified: 2026-02-21
#
# Source SSOT: docs/governance/SERVICE_REGISTRY.yaml
# Each endpoint is a known service health URL (no auth required).
#
# Coverage policy:
#   Services with HTTP endpoints get probes here. Internal-only containers
#   (no published ports), portless sidecars, and TCP-only services (postgres,
#   redis) rely on Docker HEALTHCHECK + vzdump VM-level coverage. These are
#   not accidental omissions — they are policy exclusions.

version: 1

defaults:
  connect_timeout_sec: 5
  max_time_sec: 10

endpoints:
  - id: mint-os-api
    host: docker-host
    url: "http://100.92.156.118:3335/health"
    expect: 200
    enabled: false
    description: "Legacy docker-host service (Mint OS Dashboard API) — decommissioned; disable probe."

  - id: minio
    host: docker-host
    url: "http://100.92.156.118:9000/minio/health/live"
    expect: 200
    enabled: false
    description: "Legacy docker-host minio — superseded by mint-modules-minio on mint-data VM 212. Disabled 2026-02-21 (GAP-OP-799)."

  - id: files-api
    host: docker-host
    url: "http://100.92.156.118:3500/health"
    expect: 200
    enabled: false
    description: "Legacy docker-host files-api — superseded by files-api-v2 on mint-apps VM 213. Disabled 2026-02-21 (GAP-OP-799)."

  - id: quote-page
    host: docker-host
    url: "http://100.92.156.118:3341/health"
    expect: 200
    enabled: false
    description: "Legacy docker-host quote-page — superseded by quote-page-v2 on mint-apps VM 213. Disabled 2026-02-21 (GAP-OP-799)."

  - id: dashy
    host: observability
    url: "http://100.120.163.70:4000/"
    expect: 200
    enabled: true
    description: "Dashy homelab dashboard on observability VM 205. Migrated from docker-host (LOOP-OBSERVABILITY-DOMAIN-ENRICHMENT-20260226)."

  - id: payment-v2
    host: mint-apps
    url: "http://100.79.183.14:4000/health"
    expect: 200
    enabled: true
    description: "Mint payment module on VM 213 (fresh-slate extraction target)."

  # Finance probes on docker-host REMOVED — services migrated to finance-stack VM 211.
  # Live probes: firefly-iii-vm211, paperless-ngx-vm211, ghostfolio-vm211 (below).
  # mail-archiver health probe now at mail-archiver-vm214 (communications-stack).

  - id: caddy
    host: infra-core
    url: "http://100.92.91.128:80/"
    expect: 200
    enabled: true
    description: "Caddy reverse proxy. SPOF for all infra-core traffic. Returns 200 when healthy."

  - id: cloudflared
    host: infra-core
    url: "http://100.92.91.128:60123/metrics"
    expect: 200
    enabled: true
    description: "Cloudflared metrics endpoint for ingress connector liveness (network_mode: host, --metrics=0.0.0.0:60123)."

  - id: infisical
    host: infra-core
    url: "http://100.92.91.128:8088/api/status"
    expect: 200
    description: "Infisical internal health (no auth)"

  - id: vaultwarden
    host: infra-core
    url: "http://100.92.91.128:8081/alive"
    expect: 200
    description: "Vaultwarden liveness"

  - id: authentik
    host: infra-core
    url: "http://100.92.91.128:9000/if/flow/initial-setup/"
    expect: 200
    description: "Authentik initial setup / health-like endpoint"

  - id: pihole
    host: infra-core
    url: "http://100.92.91.128:8053/admin/"
    expect: 302
    description: "Pi-hole admin UI (no auth required for login page)"

  - id: n8n
    host: automation-stack
    url: "http://100.98.70.70:5678/healthz"
    expect: 200
    description: "n8n workflow automation"

  - id: open-webui
    host: automation-stack
    url: "http://100.98.70.70:3000/"
    expect: 200
    description: "Open WebUI chat interface (automation-stack)"

  - id: ollama
    host: automation-stack
    url: "http://100.98.70.70:11434/api/tags"
    expect: 200
    description: "Ollama API (automation-stack)"

  - id: mcpjungle
    host: automation-stack
    url: "http://100.98.70.70:8080/health"
    expect: 200
    description: "MCPJungle gateway/runtime"

  - id: prometheus
    host: observability
    url: "http://100.120.163.70:9090/-/healthy"
    expect: 200
    description: "Prometheus metrics"

  - id: grafana
    host: observability
    url: "http://100.120.163.70:3000/api/health"
    expect: 200
    description: "Grafana dashboards"

  - id: loki
    host: observability
    url: "http://100.120.163.70:3100/ready"
    expect: 200
    description: "Loki log aggregation"

  - id: uptime-kuma
    host: observability
    url: "http://100.120.163.70:3001"
    expect: 302
    description: "Uptime Kuma monitoring"

  - id: node-exporter
    host: observability
    url: "http://100.120.163.70:9100/metrics"
    expect: 200
    description: "Node exporter host metrics"

  - id: gitea
    host: dev-tools
    url: "http://100.90.167.39:3000/api/healthz"
    expect: 200
    description: "Gitea Git forge"

  - id: qdrant
    host: ai-consolidation
    url: "http://100.71.17.29:6333/healthz"
    expect: 200
    description: "Qdrant vector DB (VM 207)"

  - id: anythingllm
    host: ai-consolidation
    url: "http://100.71.17.29:3002/api/ping"
    expect: 200
    description: "AnythingLLM RAG interface (VM 207)"

  # ─── Immich (VM 203) ─────────────────────────────────────────────────
  - id: immich-server
    host: immich
    url: "http://100.114.101.50:2283/api/server/ping"
    expect: 200
    enabled: true
    description: "Alias endpoint for SERVICE_REGISTRY parity (immich-server canonical service id)."

  - id: immich
    host: immich
    url: "http://100.114.101.50:2283/api/server/ping"
    expect: 200
    enabled: true
    description: "Immich photo management (VM 203). Re-enabled 2026-02-11 after GAP-OP-094 fix."

  # ─── Download Stack (VM 209) ───────────────────────────────────────
  - id: radarr
    host: download-stack
    url: "http://192.168.1.209:7878/ping"
    expect: 200
    description: "Radarr movie management"

  - id: sonarr
    host: download-stack
    url: "http://192.168.1.209:8989/ping"
    expect: 200
    description: "Sonarr TV management"

  - id: prowlarr
    host: download-stack
    url: "http://192.168.1.209:9696/ping"
    expect: 200
    description: "Prowlarr indexer manager"

  - id: lidarr
    host: download-stack
    url: "http://192.168.1.209:8686/ping"
    expect: 200
    description: "Lidarr music management"

  - id: sabnzbd
    host: download-stack
    url: "http://192.168.1.209:8080/api?mode=version&output=json"
    expect: 200
    description: "SABnzbd Usenet downloader API (lightweight version endpoint; web UI root takes ~9s, exceeds probe timeout)"

  - id: tdarr
    host: download-stack
    url: "http://192.168.1.209:8265/"
    expect: 200
    enabled: false
    description: "Tdarr transcode automation web UI (intentionally stopped during soak; disable probe until re-enabled)"

  - id: flaresolverr
    host: download-stack
    url: "http://192.168.1.209:8191/health"
    expect: 200
    description: "FlareSolverr challenge solver"

  - id: slskd
    host: download-stack
    url: "http://192.168.1.209:5030/metrics"
    expect: 200
    enabled: false
    description: "Localhost-bound by design; Docker health is authoritative signal. Disable external probe until probe_via:ssh feature exists."

  - id: download-node-exporter
    host: download-stack
    url: "http://192.168.1.209:9100/metrics"
    expect: 200
    description: "Node exporter on download-stack"

  # ─── Streaming Stack (VM 210) ────────────────────────────────────
  - id: jellyfin
    host: streaming-stack
    url: "http://192.168.1.210:8096/health"
    expect: 200
    description: "Jellyfin video streaming"

  - id: navidrome
    host: streaming-stack
    url: "http://192.168.1.210:4533/ping"
    expect: 200
    description: "Navidrome music streaming"

  - id: jellyseerr
    host: streaming-stack
    url: "http://192.168.1.210:5055"
    expect: 307
    description: "Jellyseerr request management (307 redirect to login is healthy)"

  - id: bazarr
    host: streaming-stack
    url: "http://192.168.1.210:6767/ping"
    expect: 200
    description: "Bazarr subtitle management"

  - id: homarr
    host: streaming-stack
    url: "http://192.168.1.210:7575/"
    expect: 307
    description: "Homarr dashboard (307 redirect to login is healthy)"

  - id: spotisub
    host: streaming-stack
    url: "http://192.168.1.210:8766/"
    expect: 302
    description: "Spotisub Spotify-to-Subsonic sync (302 redirect to login is healthy)"

  - id: streaming-node-exporter
    host: streaming-stack
    url: "http://192.168.1.210:9100/metrics"
    expect: 200
    description: "Node exporter on streaming-stack"

  # ─── Finance Stack (VM 211 — LIVE, cutover P4 complete) ─────────────────
  - id: firefly-iii-vm211
    host: finance-stack
    url: "http://100.76.153.100:8080/api/v1/about"
    expect: 302
    enabled: true
    description: "Firefly III on finance-stack VM 211. Live — cutover P4 (LOOP-FINANCE-VM-SEPARATION-20260211)."

  - id: paperless-ngx-vm211
    host: finance-stack
    url: "http://100.76.153.100:8000/api/"
    expect: 302
    enabled: true
    description: "Paperless-ngx on finance-stack VM 211. Live — cutover P4 (LOOP-FINANCE-VM-SEPARATION-20260211)."

  - id: ghostfolio-vm211
    host: finance-stack
    url: "http://100.76.153.100:3333/"
    expect: 301
    enabled: true
    description: "Ghostfolio on finance-stack VM 211. Live — cutover P4 (LOOP-FINANCE-VM-SEPARATION-20260211)."

  - id: mail-archiver-vm214
    host: communications-stack
    url: "http://100.115.16.37:5100/"
    expect: 302
    enabled: true
    description: "Mail Archiver on communications-stack VM 214. Migrated from VM 211 (LOOP-MAIL-ARCHIVER-COMMS-MIGRATION-20260225)."

  # ─── Mint Fresh-Slate: Data Plane (VM 212) ────────────────────────────
  - id: mint-modules-minio
    host: mint-data
    url: "http://100.106.72.25:9000/minio/health/live"
    expect: 200
    enabled: true
    description: "MinIO on mint-data VM 212 (fresh-slate)"

  # ─── Mint Fresh-Slate: App Plane (VM 213) ─────────────────────────────
  - id: files-api-v2
    host: mint-apps
    url: "http://100.79.183.14:3500/health"
    expect: 200
    enabled: true
    description: "Artwork files-api on mint-apps VM 213 (fresh-slate)"

  - id: quote-page-v2
    host: mint-apps
    url: "http://100.79.183.14:3341/health"
    expect: 200
    enabled: true
    description: "Quote page on mint-apps VM 213 (fresh-slate)"

  - id: order-intake-v2
    host: mint-apps
    url: "http://100.79.183.14:3400/health"
    expect: 200
    enabled: true
    description: "Order intake on mint-apps VM 213 (fresh-slate)"

  - id: finance-adapter
    host: mint-apps
    url: "http://100.79.183.14:3600/health"
    expect: 200
    enabled: true
    description: "Finance adapter on mint-apps VM 213 (fresh-slate)"

  - id: pricing-v2
    host: mint-apps
    url: "http://100.79.183.14:3700/health"
    expect: 200
    enabled: true
    description: "Pricing module on mint-apps VM 213 (fresh-slate)"

  - id: suppliers-v2
    host: mint-apps
    url: "http://100.79.183.14:3800/health"
    expect: 200
    enabled: true
    description: "Suppliers module on mint-apps VM 213 (fresh-slate)"

  - id: shipping-v2
    host: mint-apps
    url: "http://100.79.183.14:3900/health"
    expect: 200
    enabled: true
    description: "Shipping module on mint-apps VM 213 (fresh-slate)"

  # ─── Communications Stack (VM 214) ──────────────────────────────────────
  - id: stalwart-mail
    host: communications-stack
    url: "http://100.115.16.37:8080/"
    expect: 200
    enabled: true
    description: "Stalwart mail server management API (VM 214). IMAPS 993, SMTPS 465, STARTTLS 587. TLS via Let's Encrypt DNS-01 (Cloudflare)."

  # ─── Home Site (proxmox-home — Beelink SER7) ───────────────────────────
  - id: home-assistant
    host: ha
    url: "http://100.67.120.1:8123/api/"
    expect: "401,403"
    enabled: true
    description: "Home Assistant (home VM 100). API unauthenticated response can be 401 or 403 depending route/context; either confirms service is reachable."

  - id: vaultwarden-home
    host: vaultwarden-home
    url: "http://100.93.142.63:8080/"
    expect: 200
    enabled: false  # decommissioned 2026-02-16
    description: "DECOMMISSIONED. Vaultwarden (home VM 102). Superseded by infra-core."

  - id: pihole-home
    host: pihole-home
    url: "http://100.105.148.96/admin/"
    expect: 302
    enabled: true
    description: "Pi-hole DNS (home LXC 105). Reactivated 2026-02-21 for home-local DNS filtering."

  # VM 101 (immich-home): stopped — no probe until started.
  # LXC 103 (download-home): stopped — no probe until started.
