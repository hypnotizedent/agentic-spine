# Seeded from workbench SSOT: ~/code/workbench/infra/data/backup_inventory.json
# NOTE: enabled=false by default; flip true intentionally per target.
# Classifications: critical (26h), important (48h), rebuildable (168h)
version: 1

defaults:
  timezone: "America/New_York"
  ssh_timeout_sec: 6
  stale_after_hours: 26

targets:
  # =============================================================================
  # VM BACKUPS - PRIMARY (pve R730xd) - daily vzdump, 26h threshold
  # =============================================================================
  - name: vm-200-docker-host-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-200-*.vma.zst"
    stale_after_hours: 26
    classification: critical

  - name: vm-202-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-202-*.vma.zst"
    stale_after_hours: 26
    classification: critical

  - name: vm-204-infra-core-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-204-*.vma.zst"
    stale_after_hours: 26
    classification: critical

  - name: vm-205-observability-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-205-*.vma.zst"
    stale_after_hours: 26
    classification: important

  - name: vm-206-dev-tools-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-206-*.vma.zst"
    stale_after_hours: 26
    classification: important

  - name: vm-203-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-203-*.vma.zst"
    stale_after_hours: 26
    classification: important

  - name: vm-209-download-stack-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-209-*.vma.zst"
    stale_after_hours: 26
    classification: important

  - name: vm-210-streaming-stack-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-210-*.vma.zst"
    stale_after_hours: 26
    classification: important

  - name: vm-207-ai-consolidation-primary
    enabled: true
    kind: file_glob
    host: pve
    base_path: "/tank/backups/vzdump/dump"
    glob: "vzdump-qemu-207-*.vma.zst"
    stale_after_hours: 26
    classification: critical

  # =============================================================================
  # VM BACKUPS - OFFSITE (NAS at house, Tailscale) - daily rsync after vzdump
  # Shop upload ~10-20 Mbps — only critical small VMs synced (not VM 200 @ 186GB)
  # Sync script: /usr/local/bin/vzdump-offsite-sync.sh on pve (cron 09:00)
  # =============================================================================
  - name: vm-offsite-critical
    enabled: true
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/proxmox/vzdump/critical"
    glob: "vzdump-qemu-*.vma.zst"
    stale_after_hours: 48
    classification: important
    notes: "Covers VMs 204-210. VM 200 excluded (186GB, bandwidth prohibitive)."

  # NOTE: VM 200 offsite disabled — 186GB backup exceeds shop upload capacity (~10-20 Mbps)
  - name: vm-200-docker-host-offsite
    enabled: false
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/proxmox/vzdump"
    glob: "vzdump-qemu-200-*.vma.zst"
    stale_after_hours: 192
    classification: critical
    notes: "Disabled: 186GB backup cannot fit in nightly offsite window at 10-20 Mbps."

  # =============================================================================
  # HOME VM BACKUPS - PRIMARY (proxmox-home) - vzdump to NAS NFS
  # Storage: synology-backups (NFS 10.0.0.150:/volume1/backups/proxmox_backups)
  # Retention: keep-last=3 (P0/P1), keep-last=2 (P2)
  # Enabled: 2026-02-11 (LOOP-HOME-BACKUP-INFRASTRUCTURE-ENABLE-20260209)
  # =============================================================================
  - name: home-vm-100-ha-primary
    enabled: false
    kind: file_glob
    host: proxmox-home
    base_path: "/mnt/pve/synology-backups/dump"
    glob: "vzdump-qemu-100-*.vma.zst"
    stale_after_hours: 26
    classification: critical
    notes: "P0 tier. Daily 03:00. Flip enabled after first scheduled run confirms artifact."

  - name: home-vm-102-vaultwarden-primary
    enabled: true
    kind: file_glob
    host: proxmox-home
    base_path: "/mnt/pve/synology-backups/dump"
    glob: "vzdump-qemu-102-*.vma.zst"
    stale_after_hours: 26
    classification: critical
    notes: "P0 tier. Daily 03:00. Validated 2026-02-11 (3.87GB artifact confirmed on NAS)."

  - name: home-lxc-103-download-primary
    enabled: false
    kind: file_glob
    host: proxmox-home
    base_path: "/mnt/pve/synology-backups/dump"
    glob: "vzdump-lxc-103-*.tar.zst"
    stale_after_hours: 26
    classification: important
    notes: "P1 tier. Daily 03:15. LXC currently stopped. Flip enabled after first run."

  - name: home-vm-101-immich-primary
    enabled: false
    kind: file_glob
    host: proxmox-home
    base_path: "/mnt/pve/synology-backups/dump"
    glob: "vzdump-qemu-101-*.vma.zst"
    stale_after_hours: 168
    classification: important
    notes: "P2 tier. Weekly Sun 04:00. VM stopped; disk image backup only."

  - name: home-lxc-105-pihole-primary
    enabled: false
    kind: file_glob
    host: proxmox-home
    base_path: "/mnt/pve/synology-backups/dump"
    glob: "vzdump-lxc-105-*.tar.zst"
    stale_after_hours: 168
    classification: rebuildable
    notes: "P2 tier. Weekly Sun 04:00. LXC stopped; rebuildable from config."

  # =============================================================================
  # APP-LEVEL BACKUPS (NAS at house, Tailscale)
  # =============================================================================
  - name: app-infisical
    enabled: true
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/infisical"
    glob: "*.sql.gz"
    stale_after_hours: 26
    classification: critical
    notes: "pg_dump from infra-core (cron 02:50 daily), rsync to NAS."

  - name: app-mint-postgres
    enabled: false
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/mint-postgres"
    glob: "*.sql.gz"
    stale_after_hours: 26
    classification: critical
    notes: "Legacy — evaluate if VM 200 still runs postgres worth backing up."

  - name: app-gitea
    enabled: true
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/gitea"
    glob: "*.sql.gz"
    stale_after_hours: 26
    classification: critical
    notes: "gitea dump + pg_dump from dev-tools VM 206 (cron 02:55 daily), rsync to NAS."

  - name: app-vaultwarden
    enabled: true
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/vaultwarden"
    glob: "*.tar.gz"
    stale_after_hours: 26
    classification: critical

  - name: app-home-assistant
    enabled: true
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/home-assistant"
    glob: "*.tar"
    stale_after_hours: 48
    classification: important

  - name: app-firefly
    enabled: false
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/finance"
    glob: "*.sql.gz"
    stale_after_hours: 48
    classification: important
    notes: "Disabled: /volume1/backups/apps/finance/ does not exist on NAS. GAP-OP-098."

  - name: app-minio
    enabled: false
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/minio"
    glob: "*.tar.gz"
    stale_after_hours: 48
    classification: important

  - name: device-ronny-macbook
    enabled: false
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/devices/ronny-macbook"
    glob: "*"
    stale_after_hours: 26
    classification: critical

  - name: asset-dns-domain
    enabled: false
    kind: file_glob
    host: nas
    base_path: "/volume1/backups/apps/cloudflare"
    glob: "*"
    stale_after_hours: 26
    classification: critical
