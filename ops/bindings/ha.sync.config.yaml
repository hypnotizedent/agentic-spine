# HA Sync Agent Configuration
# Maps HA WebSocket events to snapshot capabilities
# Status: authoritative

schema_version: '1.0'
last_verified: '2026-02-15'

websocket:
  url_pattern: 'ws://{ha_host}:{ha_port}/api/websocket'
  reconnect_delay_seconds: 5
  max_reconnect_attempts: 10
  auth_timeout_seconds: 10

event_mappings:
  automation_reloaded:
    snapshot: ha.automations.snapshot
    description: 'Automation config reloaded'
    commit_prefix: 'sync(ha): automations refreshed'
    
  automation_triggered:
    snapshot: null
    description: 'Automation triggered (no snapshot)'
    
  script_reloaded:
    snapshot: ha.scripts.snapshot
    description: 'Script config reloaded'
    commit_prefix: 'sync(ha): scripts refreshed'
    
  scene_reloaded:
    snapshot: ha.scenes.snapshot
    description: 'Scene config reloaded'
    commit_prefix: 'sync(ha): scenes refreshed'
    
  device_registry_updated:
    snapshot: ha.device.map.build
    description: 'Device registry updated'
    commit_prefix: 'sync(ha): device map refreshed'
    
  entity_registry_updated:
    snapshot: ha.entity.state.baseline
    description: 'Entity registry updated'
    commit_prefix: 'sync(ha): entity baseline refreshed'
    
  config_entry_changed:
    snapshot: ha.integrations.snapshot
    description: 'Integration config changed'
    commit_prefix: 'sync(ha): integrations refreshed'
    
  homeassistant_started:
    snapshot: ha.ssot.baseline.build
    description: 'HA restarted - full baseline refresh'
    commit_prefix: 'sync(ha): full baseline refreshed on HA restart'
    
  hassio_addon_installed:
    snapshot: ha.addons.snapshot
    description: 'Add-on installed'
    commit_prefix: 'sync(ha): addons refreshed'
    
  hassio_addon_removed:
    snapshot: ha.addons.snapshot
    description: 'Add-on removed'
    commit_prefix: 'sync(ha): addons refreshed'
    
  hassio_addon_updated:
    snapshot: ha.addons.snapshot
    description: 'Add-on updated'
    commit_prefix: 'sync(ha): addons refreshed'

debounce:
  delay_seconds: 2
  max_queue_size: 10

git:
  auto_commit: true
  auto_push: true
  check_diff: true

drift:
  detect_entity_drift: true
  entity_ignore_patterns:
    - 'sensor.*_last_*'
    - 'update.*'
  max_unexpected_unavailable: 5
