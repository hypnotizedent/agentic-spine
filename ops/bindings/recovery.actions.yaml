version: 1
updated_at: "2026-03-01"
owner: "@ronny"
scope: recovery-actions

defaults:
  max_attempts: 2
  cooldown_seconds: 1800
  escalate_after_failures: 2

actions:
  - id: recover-finance-stack
    trigger:
      gate_ids: [D23]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: finance-stack
      stack: finance
      services: []
    safety:
      max_attempts: 2
      cooldown_seconds: 1800
      escalate_after_failures: 2

  - id: recover-communications-stack
    trigger:
      gate_ids: [D209]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: communications-stack
      stack: communications-stack
      services: []
    safety:
      max_attempts: 2
      cooldown_seconds: 1800
      escalate_after_failures: 2

  - id: recover-communications-mail-archiver
    trigger:
      gate_ids: [D233]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: communications-stack
      stack: communications-stack
      services: [mail-archiver]
    safety:
      max_attempts: 2
      cooldown_seconds: 1800
      escalate_after_failures: 2

  - id: recover-media-download-stack
    trigger:
      gate_ids: [D223, D230, D231, D232]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: download-stack
      stack: download-stack
      services: []
    safety:
      max_attempts: 2
      cooldown_seconds: 1800
      escalate_after_failures: 2

  - id: recover-media-streaming-stack
    trigger:
      gate_ids: [D228, D229]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: streaming-stack
      stack: streaming-stack
      services: []
    safety:
      max_attempts: 2
      cooldown_seconds: 1800
      escalate_after_failures: 2

  - id: recover-mint-data-stack
    trigger:
      gate_ids: [D236]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: mint-data
      stack: mint-data
      services: []
    safety:
      max_attempts: 2
      cooldown_seconds: 1800
      escalate_after_failures: 2

  - id: recover-mint-apps-stack
    trigger:
      gate_ids: [D238]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: mint-apps
      stack: mint-apps
      services: []
    safety:
      max_attempts: 2
      cooldown_seconds: 1800
      escalate_after_failures: 2

  - id: recover-uptime-kuma
    trigger:
      gate_ids: [D302]
      failure_class: deterministic
    recovery:
      type: docker_compose_restart
      target: observability
      stack: uptime-kuma
      services: []
      probe_url: http://100.120.163.70:3001
    safety:
      max_attempts: 2
      cooldown_seconds: 1200
      escalate_after_failures: 2

  - id: recover-launchd-scheduler-health
    trigger:
      gate_ids: [D299]
      failure_class: freshness
    recovery:
      type: launchd_restart
      label: com.ronny.launchd-health-check
    safety:
      max_attempts: 2
      cooldown_seconds: 900
      escalate_after_failures: 2

  - id: recover-freshness-reconcile
    trigger:
      gate_ids: []
      failure_class: freshness
    recovery:
      type: capability_retry
      capability: verify.freshness.reconcile
      max_attempts: 2
      backoff_seconds: [60, 300]
    safety:
      max_attempts: 2
      cooldown_seconds: 900
      escalate_after_failures: 2
