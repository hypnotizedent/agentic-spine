# Immich Ingest Watch Contract
# Status: authoritative
# Last verified: 2026-02-16

version: 1
updated_at: "2026-02-16"
owner: "@ronny"
scope: immich-ingest-maintenance

runtime:
  mode: remote_ssh
  ssh_target_id: immich
  remote_state_root: /home/ronny/immich-ingest
  ssh:
    connect_timeout_sec: 10
    strict_host_key_checking: false
    user_known_hosts_file: /dev/null
    batch_mode: true
  paths:
    queue_file: queue/years.csv
    state_file: state/current.json
    heartbeat_file: state/heartbeat
    worker_log_file: logs/worker.log
    pid_file: state/worker.pid

incident_thresholds:
  stale_heartbeat_minutes: 20
  error_window_lines: 300

policy:
  guided_only: true
  auto_restart_worker: false
  auto_mutation: false

guided_recovery:
  status_command: "~/immich-ingest/bin/status.sh"
  stop_command: "~/immich-ingest/bin/stop.sh"
  start_command: "~/immich-ingest/bin/start.sh"
