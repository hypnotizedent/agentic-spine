# Wave Closeout Finalization Contract
# Status: authoritative
# Last verified: 2026-02-27
# Scope: closeout receipt finalization and crumb prevention

version: "1.0"
updated: "2026-02-27"
owner: "@ronny"
scope: wave-closeout-finalization

closeout:
  require_run_keys: true
  run_key_regex: "CAP-[0-9]{8}-[0-9]{6}__[A-Za-z0-9._-]+__R[A-Za-z0-9]+"
  min_run_keys_per_receipt: 1
  require_clean_worktree_for_cleanup_delete: true
  require_receipt_gate_pass_for_cleanup_delete: true
  expected_receipt_patterns:
    - "docs/planning/W*_RECEIPT*.md"
    - "docs/planning/W*MASTER_RECEIPT*.md"

receipt_crumb_detection:
  block_untracked: true
  untracked_receipt_regex: "(^|/)docs/planning/W[^/]*RECEIPT[^/]*\\.md$"

planning_budget:
  enabled: true
  max_active_docs: 50

finalize:
  default_remotes:
    - origin
    - github
    - share
  require_branch_tracking: true
  require_clean_index_before_stage: true
  gate_script: "surfaces/verify/d274-receipt-closeout-completeness-lock.sh"
