status: authoritative
owner: "@ronny"
last_verified: 2026-02-23
scope: infra-maintenance-transaction
phase_order:
  - precheck
  - shutdown
  - startup
  - recovery
  - verify
sites:
  - id: shop
    host_id: pve
    requires_oob_guard: true
  - id: home
    host_id: proxmox-home
    requires_oob_guard: false
oob_policy:
  shop:
    requires_guard_pass_or_onsite_ack: true
  home:
    requires_guard_pass_or_onsite_ack: false
    note: home maintenance does not require shop OOB subnet-router parity.
  ack_token: I_AM_ONSITE_AND_ACCEPT_TEMP_OOB_LOSS
checkpoint_path: mailroom/state/maintenance-windows/<window_id>.yaml
required_postchecks:
  - ssh.target.status
  - docker.compose.status
  - services.health.status
  - verify.core.run
verify_policy:
  dry_run:
    docker_timeout_sec: 90
    docker_attempts: 3
    docker_backoff_sec: 5
    services_timeout_sec: 45
    services_attempts: 2
    services_backoff_sec: 3
    verify_core_timeout_sec: 120
    strict_exit: false
  execute:
    docker_timeout_sec: 120
    docker_attempts: 3
    docker_backoff_sec: 10
    services_timeout_sec: 60
    services_attempts: 3
    services_backoff_sec: 5
    verify_core_timeout_sec: 180
    strict_exit: true
    startup_grace_sec: 60
