# Secrets Inventory - SSOT parity binding
# Seeded from: ~/code/workbench/infra/data/secrets_inventory.json
# Status: authoritative
# Last verified: 2026-02-13
# Purpose: Machine-readable project catalog for spine verification
# NOTE: IDs and names are NOT secrets. No values stored here.

version: 1

source:
  repo: workbench
  path: infra/data/secrets_inventory.json
  commit: 86acf02886380da7c27755b7e3ac0cd0be1b978e
  last_synced: "2026-02-08"

infisical:
  api_url: "https://secrets.ronny.works"
  host: "infra-core"
  environment: "prod"

# Project catalog - project_health is informational (risk flag), not assertion
projects:
  - name: infrastructure
    id: "01ddd93a-e0f8-4c7c-ad9f-903d76ef94d9"
    project_health: active
    description: "Spine-bound. Cloudflare, GitHub, Azure, NAS, system infrastructure"

  - name: mint-os-api
    id: "6c67b03e-ed17-4154-9a94-59837738e432"
    project_health: overloaded
    description: "Dashboard API, vendors, payments. Proposed rename to 'mint-os'"

  - name: mint-os-vault
    id: "66d149d6-f610-4ec3-a400-3ff42ea1aa75"
    project_health: overlaps
    rbac: viewer
    description: "DEPRECATED: Overlaps with mint-os-api; consolidation candidate. Spine identity RBAC-locked to viewer."

  # mint-os-portal deleted 2026-02-12 (was 758e5db3-8d00-4ccf-8d91-aeaad0d6ed37, 0 keys)

  - name: n8n
    id: "4b9dfc6d-13e8-43c8-bd84-9beb64eb8e16"
    project_health: clean
    description: "Automation workflows"

  - name: finance-stack
    id: "4c34714d-6d85-4aa6-b8df-5a9505f3bcef"
    project_health: deprecated
    rbac: viewer
    description: "DEPRECATED: All finance keys live in infrastructure project under /spine/services/finance, /spine/services/mail-archiver, /spine/services/paperless. Spine identity RBAC-locked to viewer. UI description update pending (manual admin action)."

  - name: media-stack
    id: "3807f1c4-e354-4aaf-a16f-8567d7f78a7e"
    project_health: clean
    description: "Jellyfin, *arr apps, media management"

  - name: immich
    id: "4bf7f25e-596b-4293-9d2a-c2c7c2d0df42"
    project_health: clean_but_duped
    description: "Keys duplicated in infrastructure; remove dupes from infra"

  - name: home-assistant
    id: "5df75515-7259-4c14-98b8-5adda379aade"
    project_health: clean
    description: "Smart home control"

  - name: ai-services
    id: "2a2e4c56-6f75-460e-8db2-c426ceb4bddf"
    project_health: clean
    description: "AI API keys (ANTHROPIC, OPENAI). Created 2026-01-28 per proposed restructure"

# ─────────────────────────────────────────────────────────────
# Local Workstation Secrets (not in Infisical)
# ─────────────────────────────────────────────────────────────
local_secrets:
  - name: opencode-auth
    location: "~/.local/share/opencode/auth.json"
    provider: zai
    env_var: "ZAI_API_KEY"
    description: "OpenCode authentication for ZAI glm-5 model. Stored locally, referenced via {env:ZAI_API_KEY} in opencode.json"

  - name: opencode-config
    location: "~/.config/opencode/"
    symlink_source: "~/code/workbench/dotfiles/opencode/"
    files:
      - "opencode.json"
      - "oh-my-opencode.json"
    description: "OpenCode configuration symlinked from workbench dotfiles"

# ─────────────────────────────────────────────────────────────
# AI Coding Tools Configuration
# ─────────────────────────────────────────────────────────────
ai_tools:
  - name: opencode
    version: "1.1.65"
    plugins:
      - name: oh-my-opencode
        version: "3.5.3"
        enabled: true
      - name: opencode-wakatime
        enabled: true
      - name: opencode-pty
        enabled: true
      - name: "@f97/opencode-morph-fast-apply"
        version: "1.1.0"
        enabled: true
        description: "Requires MORPH_API_KEY for morph_edit tool activation"
    mcps:
      - name: playwright
        type: local
        enabled: true
      - name: context7
        type: remote
        enabled: false
        via: oh-my-opencode
        description: "Disabled to suppress unsupported prompts/list popup noise in OpenCode 1.1.x"
      - name: grep_app
        type: remote
        enabled: false
        via: oh-my-opencode
        description: "Disabled to suppress unsupported prompts/list popup noise in OpenCode 1.1.x"
    command_surface:
      - "gsd-* (Get Shit Done pack)"
      - "ralph-loop"
      - "ralphloop"
      - "ulw"
    model: "openai/glm-5"
    provider: "zai"
    description: "Primary AI coding tool. Uses ZAI API with glm-5 model and governed command shims."

  - name: get-shit-done
    version: "1.18.0"
    location: "~/.config/opencode/get-shit-done/"
    enabled: true
    description: "Spec-driven development workflow for OpenCode"

# Known issues from SSOT - informational flags, not runtime assertions
known_issues:
  - id: spof-infisical-single-instance
    severity: high
    description: "Infisical runs as a single instance on infra-core (VM 204); outage blocks secrets gating"

  - id: no-offline-bootstrap
    severity: critical
    description: "No offline backup of bootstrap credentials exists"

  - id: infisical-backup-untested
    severity: high
    description: "Weekly GPG backup exists but restore procedure never tested"

  - id: immich-keys-duplicated
    severity: medium
    description: "IMMICH_* keys exist in both 'immich' and 'infrastructure' projects"

  - id: mint-os-api-overloaded
    severity: medium
    description: "mint-os-api has 55 keys spanning multiple concerns"

  - id: infrastructure-overloaded
    severity: medium
    description: "infrastructure has 48 keys including AI keys and duplicates"
