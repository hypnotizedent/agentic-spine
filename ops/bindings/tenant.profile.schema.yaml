# Tenant Profile Schema
# Status: authoritative
# Last verified: 2026-02-15
# Scope: aof-tenant-profile
#
# Defines the structure of a tenant profile for AOF deployments.
# Validated by: tenant.profile.validate capability
# Referenced by: AOF_PRODUCT_CONTRACT.md

version: 1
updated: 2026-02-28
owner: "@ronny"

schema:
  identity:
    required: true
    fields:
      tenant_id:
        type: string
        required: true
        description: "Unique tenant identifier (kebab-case)"
        pattern: "^[a-z][a-z0-9-]{2,63}$"
      owner:
        type: string
        required: true
        description: "Primary operator handle (e.g. @ronny)"
      display_name:
        type: string
        required: false
        description: "Human-readable tenant name"
      created_at:
        type: string
        required: true
        description: "ISO 8601 creation timestamp"
        format: date

  secrets:
    required: true
    fields:
      provider:
        type: string
        required: true
        description: "Secrets management provider"
        enum: [infisical, vault, env-file, none]
      api_url:
        type: string
        required: false
        description: "Secrets provider API endpoint"
      project_id:
        type: string
        required: false
        description: "Project/workspace identifier in secrets provider"
      environment:
        type: string
        required: true
        description: "Target environment (prod, staging, dev)"
        enum: [prod, staging, dev]

  policy:
    required: true
    fields:
      preset:
        type: string
        required: true
        description: "Named policy preset from policy.presets.yaml"
        enum: [strict, balanced, permissive]
      overrides:
        type: map
        required: false
        description: "Per-knob overrides on top of the preset"

  runtime:
    required: true
    fields:
      spine_root:
        type: string
        required: true
        description: "Absolute path to agentic-spine repo on disk"
      workbench_root:
        type: string
        required: false
        description: "Absolute path to workbench repo (if applicable)"
      git_remote_primary:
        type: string
        required: true
        description: "Primary git remote name (e.g. origin)"
      git_remote_mirror:
        type: string
        required: false
        description: "Mirror git remote name (e.g. github)"
      timezone:
        type: string
        required: true
        description: "IANA timezone for scheduling and display (e.g. America/New_York). Machine timestamps stay UTC."
      timezone_label:
        type: string
        required: false
        description: "Short human-readable label for the timezone (e.g. ET, PT, CET)"

  surfaces:
    required: true
    fields:
      agents:
        type: list
        required: true
        description: "List of agent surface types enabled"
        items:
          enum: [claude-code, claude-desktop, codex, opencode]
      slash_commands:
        type: boolean
        required: true
        description: "Whether slash commands are synced to agent surfaces"
      mcp_servers:
        type: list
        required: false
        description: "List of MCP server configurations"
        items:
          fields:
            name:
              type: string
            endpoint:
              type: string

  evidence:
    required: true
    fields:
      receipts_enabled:
        type: boolean
        required: true
        description: "Whether capability receipts are generated"
      ledger_path:
        type: string
        required: true
        description: "Path to capability execution ledger"
      session_closeout_sla_hours:
        type: integer
        required: true
        description: "Maximum hours between session closeouts (D61)"
        default: 48

# Validation rules (enforced by tenant.profile.validate)
validation:
  - rule: "identity.tenant_id must be unique across all known deployments"
  - rule: "secrets.provider != none requires secrets.api_url"
  - rule: "policy.preset must exist in policy.presets.yaml"
  - rule: "runtime.spine_root must be an absolute path"
  - rule: "surfaces.agents must contain at least one entry"
  - rule: "evidence.receipts_enabled should be true for production"
