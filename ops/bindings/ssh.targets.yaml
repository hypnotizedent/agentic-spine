# SSH Targets Binding (SSOT)
# Non-secret. Spine-native. No monolith runtime dependency.
#
# Source: Discovered from ~/Code/workbench/dotfiles/ssh/config.d/tailscale.conf
# Most hosts are Tailscale IPs (100.x.x.x). During VM provisioning/bootstrap, a
# target may temporarily use a LAN DHCP address until Tailscale is connected.

ssh:
  defaults:
    user: "root"
    port: 22
    connect_timeout_sec: 5
    batch_mode: true
    # Avoid HOME drift (no known_hosts writes):
    strict_host_key_checking: "no"
    user_known_hosts_file: "/dev/null"

  targets:
    - id: "docker-host"
      host: "100.92.156.118"
      user: "docker-host"
      notes: "mint-os-prod / docker workloads"
      tags: ["docker", "production", "core"]

    - id: "pve"
      host: "100.96.211.33"
      user: "root"
      notes: "Proxmox VE - shop location"
      tags: ["proxmox", "hypervisor", "core"]

    - id: "proxmox-home"
      host: "100.103.99.62"
      user: "root"
      notes: "Proxmox Host (Home) - Beelink Mini"
      tags: ["proxmox", "backup", "home"]

    - id: "nas"
      host: "100.102.199.111"
      user: "ronadmin"
      notes: "Synology NAS 918+"
      tags: ["storage", "backup", "core"]

    - id: "vault"
      host: "100.93.142.63"
      user: "root"
      notes: "Vaultwarden rollback source (home VM 102) — not infra-core"
      tags: ["security", "home", "rollback"]

    - id: "automation-stack"
      host: "100.98.70.70"
      user: "automation"
      notes: "n8n, Ollama, Open WebUI"
      tags: ["automation", "ai"]

    - id: "ha"
      host: "100.67.120.1"
      user: "hassio"
      notes: "Home Assistant"
      tags: ["home-automation", "iot"]

    - id: "pihole-home"
      host: "100.105.148.96"
      user: "root"
      connect_timeout_sec: 20
      optional: true
      notes: "Pi-hole DNS (home) - slow WAN link"
      tags: ["dns", "network", "home"]

    - id: "infra-core"
      host: "100.92.91.128"
      user: "ubuntu"
      notes: "Core infra VM (relocation target, VM 204)"
      tags: ["infrastructure", "core", "shop", "secrets", "security"]

    - id: "observability"
      host: "100.120.163.70"
      user: "ubuntu"
      notes: "Observability VM (Prometheus, Grafana, Loki, Uptime Kuma) - VM 205"
      tags: ["observability", "monitoring", "shop"]

    - id: "dev-tools"
      host: "100.90.167.39"
      user: "ubuntu"
      notes: "Dev tools VM (Gitea, PostgreSQL, Gitea Actions runner) - VM 206"
      tags: ["development", "ci", "shop"]

    - id: "media-stack"
      host: "100.117.1.53"
      user: "media"
      notes: "Media stack VM (Jellyfin, *arr, Tdarr) - shop (pve) (sudo -n for root ops)"
      tags: ["media", "docker", "shop"]

    - id: "download-stack"
      host: "100.107.36.76"
      user: "ubuntu"
      notes: "Download stack VM (SABnzbd, *arr, Tdarr) - VM 209"
      tags: ["media", "docker", "shop"]

    - id: "streaming-stack"
      host: "100.123.207.64"
      user: "ubuntu"
      notes: "Streaming stack VM (Jellyfin, Navidrome, Jellyseerr) - VM 210"
      tags: ["media", "docker", "shop"]
 
    - id: "ai-consolidation"
      host: "100.71.17.29"
      user: "ubuntu"
      notes: "AI consolidation VM (Qdrant, AnythingLLM) - VM 207. Open WebUI stays on VM 202 (P4 decision)."
      tags: ["ai", "docker", "shop"]
 
    - id: "download-home"
      host: "100.125.138.110"
      user: "root"
      optional: true
      notes: "*arr apps (home)"
      tags: ["media", "home"]

    # ─── LAN-only devices (no Tailscale, checked via probe_via host) ───

    - id: "switch-shop"
      host: "192.168.1.2"
      user: "admin"
      access_method: lan_only
      probe_via: pve
      notes: "Dell N2024P managed switch — shop 9U rack. Re-IP deferred from UDR6 cutover."
      tags: ["network", "shop", "lan-only"]

    - id: "idrac-shop"
      host: "192.168.1.250"
      user: "root"
      access_method: lan_only
      probe_via: pve
      notes: "Dell R730XD iDRAC — shop. Re-IP via IPMI attempted, ARP failed, needs BMC cold reset."
      tags: ["management", "shop", "lan-only"]

    - id: "nvr-shop"
      host: "192.168.1.216"
      user: "admin"
      access_method: lan_only
      probe_via: pve
      notes: "Hikvision NVR — shop. Re-IP via ISAPI from pve. Credentials in Infisical /spine/shop/nvr/."
      tags: ["cameras", "shop", "lan-only"]

    - id: "ap-shop"
      host: "192.168.1.185"
      user: "production"
      access_method: lan_only
      probe_via: pve
      notes: "TP-Link EAP225 WiFi AP — shop. SSH creds in Infisical /spine/shop/wifi/."
      tags: ["wifi", "network", "shop", "lan-only"]

    - id: "udr-shop"
      host: "192.168.1.1"
      user: "root"
      access_method: lan_only
      probe_via: pve
      notes: "UDR6 shop gateway/router (UniFi console). LAN-only probe via pve."
      tags: ["router", "network", "shop", "lan-only"]
