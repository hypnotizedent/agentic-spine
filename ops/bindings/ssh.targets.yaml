# SSH Targets Binding (SSOT)
# Non-secret. Spine-native. No monolith runtime dependency.
# Status: authoritative
# Last verified: 2026-02-13
#
# Source: Discovered from ~/code/workbench/dotfiles/ssh/config.d/tailscale.conf
# Most hosts are Tailscale IPs (100.x.x.x). During VM provisioning/bootstrap, a
# target may temporarily use a LAN DHCP address until Tailscale is connected.

ssh:
  defaults:
    user: "root"
    port: 22
    connect_timeout_sec: 5
    batch_mode: true
    # Avoid HOME drift (no known_hosts writes):
    strict_host_key_checking: "no"
    user_known_hosts_file: "/dev/null"

  targets:
    - id: "docker-host"
      host: "100.92.156.118"
      user: "docker-host"
      description: "mint-os-prod / docker workloads (canonical host user for compose runtime paths)"
      tags: ["docker", "production", "core"]

    - id: "pve"
      host: "100.96.211.33"
      user: "root"
      description: "Proxmox VE - shop location"
      tags: ["proxmox", "hypervisor", "core"]

    - id: "proxmox-home"
      host: "100.103.99.62"
      user: "root"
      description: "Proxmox Host (Home) - Beelink Mini"
      tags: ["proxmox", "backup", "home"]

    - id: "udr-home"
      host: "10.0.0.1"
      user: "root"
      access_method: lan_only
      probe_via: proxmox-home
      description: "UDR7 home gateway/router (UniFi console). LAN-only probe via proxmox-home."
      tags: ["router", "network", "home", "lan-only"]

    - id: "nas"
      host: "100.102.199.111"
      user: "ronadmin"
      description: "Synology NAS 918+"
      tags: ["storage", "backup", "core"]

    # vault (VM 102): decommissioned 2026-02-16. Superseded by infra-core.

    - id: "automation-stack"
      host: "100.98.70.70"
      user: "automation"
      description: "n8n, Ollama, Open WebUI (VM 202). Canonical compose owner user."
      tags: ["automation", "ai", "shop"]

    - id: "ha"
      host: "10.0.0.100"
      user: "hassio"
      description: "Home Assistant"
      tags: ["home-automation", "iot"]

    - id: "pihole-home"
      host: "100.105.148.96"
      user: "root"
      connect_timeout_sec: 20
      optional: true
      description: "Pi-hole DNS (home LXC 105) reactivated 2026-02-21 for home-local DNS filtering."
      tags: ["dns", "network", "home"]

    - id: "infra-core"
      host: "100.92.91.128"
      user: "ubuntu"
      description: "Core infra VM (relocation target, VM 204)"
      tags: ["infrastructure", "core", "shop", "secrets", "security"]

    - id: "observability"
      host: "100.120.163.70"
      user: "ubuntu"
      description: "Observability VM (Prometheus, Grafana, Loki, Uptime Kuma) - VM 205"
      tags: ["observability", "monitoring", "shop"]

    - id: "dev-tools"
      host: "100.90.167.39"
      user: "ubuntu"
      description: "Dev tools VM (Gitea, PostgreSQL, Gitea Actions runner) - VM 206"
      tags: ["development", "ci", "shop"]

    # media-stack (VM 201) DECOMMISSIONED 2026-02-10 — split into download-stack (209) + streaming-stack (210)

    - id: "download-stack"
      host: "100.107.36.76"
      user: "ubuntu"
      description: "Download stack VM (SABnzbd, *arr, Tdarr) - VM 209"
      tags: ["media", "docker", "shop"]

    - id: "streaming-stack"
      host: "100.123.207.64"
      user: "ubuntu"
      description: "Streaming stack VM (Jellyfin, Navidrome, Jellyseerr) - VM 210"
      tags: ["media", "docker", "shop"]

    - id: "ai-consolidation"
      host: "100.71.17.29"
      user: "ubuntu"
      description: "AI consolidation VM (Qdrant, AnythingLLM) - VM 207. Open WebUI stays on VM 202 (P4 decision)."
      tags: ["ai", "docker", "shop"]

    - id: "immich"
      host: "100.114.101.50"
      user: "ronny"
      description: "Immich photo management (VM 203). Cloud-init user is ronny."
      tags: ["photos", "docker", "shop"]

    - id: "finance-stack"
      host: "100.76.153.100"
      user: "ubuntu"
      description: "Finance VM (Firefly III, Paperless-ngx, Ghostfolio) - VM 211. Migrated from docker-host (LOOP-FINANCE-VM-SEPARATION-20260211)."
      tags: ["finance", "docker", "shop"]

    - id: "mint-data"
      host: "100.106.72.25"
      user: "ubuntu"
      description: "Mint fresh-slate data plane VM 212 (PostgreSQL + MinIO + Redis)"
      tags: ["mint", "data", "docker", "shop"]

    - id: "mint-apps"
      host: "100.79.183.14"
      user: "ubuntu"
      description: "Mint fresh-slate app plane VM 213 (artwork, quote-page, order-intake)"
      tags: ["mint", "apps", "docker", "shop"]

    - id: "communications-stack"
      host: "100.115.16.37"
      user: "ubuntu"
      description: "Communications stack VM 214 (Stalwart mail server). DHCP LAN IP 192.168.1.26."
      tags: ["communications", "email", "docker", "shop"]

    - id: "communications-stack-lan"
      host: "192.168.1.26"
      user: "ubuntu"
      access_method: lan_only
      description: "Communications stack VM 214 LAN endpoint for non-interactive machine polling."
      tags: ["communications", "email", "docker", "shop", "lan-only"]

    # LXC 103 (download-home) soft-decommissioned 2026-02-21.

    # ─── LAN-only devices (no Tailscale, checked via probe_via host) ───

    - id: "switch-shop"
      host: "192.168.1.2"
      mac: "f8:b1:56:73:a0:d0"
      user: "admin"
      access_method: lan_only
      probe_via: pve
      description: "Dell N2024P managed switch — shop 9U rack. Re-IP deferred from UDR6 cutover."
      tags: ["network", "shop", "lan-only"]

    - id: "idrac-shop"
      host: "192.168.1.250"
      mac: "44:a8:42:26:c3:11"
      user: "root"
      access_method: lan_only
      probe_via: pve
      description: "Dell R730XD iDRAC — shop. Re-IP via IPMI attempted, ARP failed, needs BMC cold reset."
      tags: ["management", "shop", "lan-only"]

    - id: "nvr-shop"
      host: "192.168.1.216"
      mac: "24:0f:9b:30:f1:e7"
      user: "admin"
      access_method: lan_only
      probe_via: pve
      description: "Hikvision NVR — shop. Re-IP via ISAPI from pve. Credentials in Infisical /spine/shop/nvr/."
      tags: ["cameras", "shop", "lan-only"]

    - id: "ap-shop"
      host: "192.168.1.185"
      mac: "54:af:97:2f:c6:6e"
      user: "Production"
      access_method: lan_only
      probe_via: pve
      ssh_extra_opts: "-o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa"
      description: "TP-Link EAP225 WiFi AP — shop. Dropbear SSH (ssh-rsa only). Creds in Infisical /spine/shop/wifi/."
      tags: ["wifi", "network", "shop", "lan-only"]

    - id: "udr-shop"
      host: "192.168.1.1"
      mac: "9c:05:d6:be:5b:4c"
      user: "root"
      access_method: lan_only
      probe_via: pve
      description: "UDR6 shop gateway/router (UniFi console). LAN-only probe via pve."
      tags: ["router", "network", "shop", "lan-only"]
