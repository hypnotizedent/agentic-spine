services:
  qdrant:
    image: qdrant/qdrant:v1.16.3
    restart: unless-stopped
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ./qdrant_storage:/qdrant/storage
    healthcheck:
      test: ["CMD-SHELL", "wget --spider -q http://localhost:6333/healthz || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

  anythingllm:
    image: mintplexlabs/anythingllm:latest
    restart: unless-stopped
    depends_on:
      - qdrant
    ports:
      - "3002:3001"
    volumes:
      - ./anythingllm_storage:/app/server/storage
    environment:
      ANYTHING_LLM_RUNTIME: docker
      STORAGE_DIR: /app/server/storage
      DATABASE_URL: sqlite:////app/server/storage/anythingllm.db
      VECTOR_DB: qdrant
      QDRANT_ENDPOINT: http://qdrant:6333
      EMBEDDING_ENGINE: ollama
      EMBEDDING_MODEL_PREF: mxbai-embed-large:latest
      OLLAMA_BASE_PATH: http://100.98.70.70:11434
      EMBEDDING_BASE_PATH: http://100.98.70.70:11434
      SIG_KEY: ${SIG_KEY}
      SIG_SALT: ${SIG_SALT}
