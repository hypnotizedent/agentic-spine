#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../../.." && pwd)"
STATUS_SCRIPT="$ROOT/ops/plugins/host/bin/launchd-scheduler-health-status"
OUT_REL="${1:-mailroom/outbox/operations/launchd-schedule-calendar.md}"

if [[ ! -x "$STATUS_SCRIPT" ]]; then
  echo "FAIL: missing scheduler status script: $STATUS_SCRIPT" >&2
  exit 1
fi

"$STATUS_SCRIPT" --calendar-markdown "$OUT_REL" --json | jq -r '.calendar_markdown // ""'
