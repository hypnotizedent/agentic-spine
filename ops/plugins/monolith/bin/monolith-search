#!/usr/bin/env bash
set -euo pipefail

# monolith.search wrapper:
# - `rg` returns 1 when there are no matches, which is not an error for exploration.
# - Treat exit 1 as success so receipts don't show false failures.

if [[ $# -lt 1 ]]; then
  echo "Usage: monolith-search <pattern> [path...]" >&2
  exit 2
fi

pattern="$1"
shift

if [[ $# -eq 0 ]]; then
  set +e
  rg "$pattern" .
  rc=$?
  set -e
else
  set +e
  rg "$pattern" "$@"
  rc=$?
  set -e
fi

case "$rc" in
  0) exit 0 ;;
  1) exit 0 ;; # no matches
  *) exit "$rc" ;;
esac

