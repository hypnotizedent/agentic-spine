#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SPINE_ROOT="${SPINE_ROOT:-$(cd "$SCRIPT_DIR/../../../.." && pwd)}"
SCRIPT_NAME="$(basename "$0")"
PROJECT_ROOT="${MEDIA_PLUGIN_PROJECT_ROOT:-/Users/ronnyworks/code/workbench/agents/media/tools/src/spine-plugin-media/bin}"
PROJECT_SCRIPT="$PROJECT_ROOT/$SCRIPT_NAME"
LEGACY_SCRIPT="$SCRIPT_DIR/${SCRIPT_NAME}.legacy"
USE_PROJECT="${MEDIA_PLUGIN_USE_PROJECT_BACKUPS:-0}"

if [[ "$USE_PROJECT" == "1" && -x "$PROJECT_SCRIPT" ]]; then
  exec env SPINE_ROOT="$SPINE_ROOT" "$PROJECT_SCRIPT" "$@"
fi

exec "$LEGACY_SCRIPT" "$@"
