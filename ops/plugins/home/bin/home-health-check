#!/usr/bin/env bash
set -euo pipefail

# home-health-check: HTTP health probes for home services

echo "=== Home Services Health Check ==="
echo ""

check_service() {
    local name="$1" url="$2" expect="$3"
    local http_code
    http_code=$(curl -s -o /dev/null -w "%{http_code}" -m 5 "$url" 2>/dev/null || echo "000")
    if [[ "$http_code" == "$expect" ]]; then
        echo "  $name: OK (HTTP $http_code)"
    else
        echo "  $name: FAIL (HTTP $http_code, expected $expect)"
    fi
}

check_service "Home Assistant" "http://100.67.120.1:8123/api/" "401"
check_service "Vaultwarden"   "http://100.93.142.63:8080/"     "200"

echo ""
echo "--- Stopped services (skipped) ---"
echo "  Pi-hole (LXC 105): stopped"
echo "  Immich-home (VM 101): stopped"
echo "  download-home (LXC 103): stopped"

echo ""
echo "=== Done ==="
