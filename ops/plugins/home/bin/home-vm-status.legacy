#!/usr/bin/env bash
set -euo pipefail

# home-vm-status: Check VM/LXC running state on proxmox-home

PROXMOX_HOME_HOST="100.103.99.62"
PROXMOX_HOME_USER="root"

echo "=== Proxmox Home VM/LXC Status ==="
echo "Host: $PROXMOX_HOME_HOST"
echo ""

if ! ssh -o ConnectTimeout=5 -o BatchMode=yes -o StrictHostKeyChecking=no \
    "${PROXMOX_HOME_USER}@${PROXMOX_HOME_HOST}" "exit 0" 2>/dev/null; then
    echo "ERROR: Cannot reach proxmox-home via SSH"
    exit 1
fi

echo "--- VMs ---"
ssh -o BatchMode=yes -o StrictHostKeyChecking=no \
    "${PROXMOX_HOME_USER}@${PROXMOX_HOME_HOST}" \
    "qm list" 2>/dev/null || echo "ERROR: qm list failed"

echo ""
echo "--- LXC Containers ---"
ssh -o BatchMode=yes -o StrictHostKeyChecking=no \
    "${PROXMOX_HOME_USER}@${PROXMOX_HOME_HOST}" \
    "pct list" 2>/dev/null || echo "ERROR: pct list failed"

echo ""
echo "=== Done ==="
