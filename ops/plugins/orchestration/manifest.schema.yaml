# Orchestration Manifest Schema (informational contract)
# Path contract: mailroom/state/orchestration/<loop-id>/manifest.yaml
# Version: 1

schema_version: 1
required:
  - loop_id
  - repo
  - base_sha
  - apply_owner
  - lanes
  - allow
  - forbid
  - checks
  - sequence
properties:
  loop_id:
    type: string
    pattern: '^LOOP-[A-Za-z0-9._-]+$'
  repo:
    type: string
    description: absolute or repo-relative path to git checkout
  related_repos:
    type: seq[string]
    description: optional additional repo checkouts participating in the same loop
  base_sha:
    type: string
    description: commit SHA that all lane handoff commits must descend from
  apply_owner:
    type: string
    description: actor allowed to run orchestration.integrate --apply
  status:
    type: string
    enum: [open, closed]
  lanes:
    type: map
    additional_properties:
      type: map
      fields:
        id: string
        worker: string
        branch: string
        status: string
        depends_on: seq[string]
        agent: string
        route_target: string
        produces: seq[string]
        consumes: seq[string]
        allow: seq[string]
        forbid: seq[string]
        checks: seq[string]
  allow:
    type: map
    additional_properties: seq[string]
  forbid:
    type: seq[string]
  checks:
    type: map
    additional_properties: seq[string]
  sequence:
    type: seq[string]
  created_at:
    type: string
    format: date-time
  updated_at:
    type: string
    format: date-time
