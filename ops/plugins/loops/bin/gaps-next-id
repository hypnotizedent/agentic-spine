#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../../.." && pwd)"
source "$ROOT/ops/lib/git-lock.sh"
source "$ROOT/ops/plugins/loops/lib/gap-claims.sh"
source "$ROOT/ops/plugins/lifecycle/lib/next-gap-id.sh"

acquire_git_lock gaps || exit 1
trap 'release_git_lock' EXIT INT TERM

NEXT_ID="$(next_gap_id)"
echo "gaps.next_id"
echo "next_id: $NEXT_ID"
