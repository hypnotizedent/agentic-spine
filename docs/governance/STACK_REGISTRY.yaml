# STACK_REGISTRY.yaml
# Status: authoritative
# Last verified: 2026-02-08
# Updated: 2026-02-08
#
# Purpose:
#   Machine-readable SSOT for "what stacks exist" and "which compose files are authoritative entrypoints".
#
# Notes:
#   - Docs-only. Does not change runtime.
#   - This registry should match the compose inventory excluding .archive/ and .worktrees/.
#   - deploy_method values are descriptive; they do not imply automation.
#   - Compose files live in workbench; this registry lives in spine.
#
# External ownership:
#   Canonical registry lives in spine; config files live in workbench.

source_repo: workbench
source_root: "~/code/workbench"

version: 1

exclusions:
  - .archive/**
  - .worktrees/**

stack_roots:
  - infrastructure/**
  - finance/**
  - media-stack/**
  - modules/**

stacks:
  - stack_id: mint-os
    name: Mint OS (docker-host)
    repo: workbench
    path: infrastructure/docker-host/mint-os
    compose_files:
      - docker-host:~/stacks/mint-os/docker-compose.yml
    deploy_method: ci_docker_host_runner
    deploy_notes:
      runner: docker-host
      default_stack_dir: ~/stacks/mint-os
      pattern: docker compose restart <service>
    status: active
    owner: "@ronny"
    notes: >
      Single compose file on docker-host. MinIO is inline (not separate file).
      minio joins storage-network + mint-os-network. Volume: /mnt/docker/mint-os-data/minio.
      Fixed 2026-02-10 (LOOP-MINIO-VOLUME-PATH-DIVERGENCE-20260210).

  - stack_id: finance
    name: Finance
    repo: workbench
    path: finance
    compose_files:
      - finance/docker-compose.yml
      - finance/mail-archiver/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: media-stack
    name: Media Stack (Legacy Monolith)
    repo: workbench
    path: media-stack
    compose_files:
      - media-stack/docker-compose.yml
    deploy_method: manual_or_host
    status: decommissioned
    owner: "@ronny"
    notes: >
      DECOMMISSIONED 2026-02-10. VM 201 destroyed (qm destroy --purge),
      ZFS dataset tank/docker/media-stack removed (24.1G reclaimed).
      Split into download-stack (VM 209) and streaming-stack (VM 210)
      per LOOP-MEDIA-STACK-SPLIT-20260208.

  - stack_id: download-stack
    name: Download Stack
    path: proxmox:vm-209
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Download services (SABnzbd, *arr, Tdarr, CrowdSec) on VM 209.
      Compose at /opt/stacks/download-stack on host.
      Migrated from media-stack (LOOP-MEDIA-STACK-SPLIT-20260208).

  - stack_id: streaming-stack
    name: Streaming Stack
    path: proxmox:vm-210
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Streaming services (Jellyfin, Navidrome, Jellyseerr, Bazarr) on VM 210.
      Compose at /opt/stacks/streaming-stack on host.
      Migrated from media-stack (LOOP-MEDIA-STACK-SPLIT-20260208).

  - stack_id: cloudflare-tunnel
    name: Cloudflare Tunnel
    repo: workbench
    path: infrastructure/cloudflare/tunnel
    compose_files:
      - infrastructure/cloudflare/tunnel/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: dashy
    name: Dashy
    repo: workbench
    path: infrastructure/dashy
    compose_files:
      - infrastructure/dashy/docker-compose.yml
    deploy_method: manual_or_host
    status: inactive
    owner: "@ronny"
    notes: ""

  - stack_id: mcpjungle
    name: MCP Jungle
    repo: workbench
    path: infrastructure/mcpjungle
    compose_files:
      - infrastructure/mcpjungle/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: n8n
    name: n8n
    repo: workbench
    path: infrastructure/n8n
    compose_files:
      - infrastructure/n8n/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: pihole
    name: Pi-hole
    repo: workbench
    path: infrastructure/pihole
    compose_files:
      - infrastructure/pihole/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: secrets
    name: Secrets (Infisical)
    repo: workbench
    path: infrastructure/secrets
    compose_files:
      - infrastructure/secrets/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: storage
    name: Storage (MinIO standalone)
    repo: workbench
    path: infra/compose/storage
    compose_files:
      - infra/compose/storage/docker-compose.yml
    deploy_method: manual_or_host
    status: reference-only
    owner: "@ronny"
    notes: >
      Workbench reference compose for standalone MinIO architecture.
      NOT deployed — live MinIO is still inline in mint-os compose on docker-host.
      Volume path: /mnt/docker/storage/minio (symlink to /mnt/docker/mint-os-data/minio).
      See LOOP-MINIO-VOLUME-PATH-DIVERGENCE-20260210.

  - stack_id: templates
    name: Templates (non-deploy)
    repo: workbench
    path: infrastructure/templates
    compose_files:
      - infrastructure/templates/docker-compose.template.yml
    deploy_method: none_template_only
    status: template
    owner: "@ronny"
    notes: >
      Template compose file(s) used for reference. Not intended for deployment.

  - stack_id: artwork-module
    name: Artwork Module (files-api)
    source: mint-modules/artwork
    compose_files:
      - docker-host:~/artwork-module/docker-compose.yml
    deploy_method: manual_compose
    status: active
    owner: "@ronny"
    notes: >
      Standalone artwork/files API. Seeds intake, asset management, presigned URLs.
      Source code at ~/code/mint-modules/artwork/, deployed to docker-host:~/artwork-module/.
      No mint-os monolith dependency — connects to shared MinIO and postgres via Docker networks.

  - stack_id: quote-page
    name: Quote Page (customer intake)
    source: mint-modules/quote-page
    compose_files:
      - docker-host:~/quote-page/docker-compose.yml
    deploy_method: manual_compose
    status: active
    owner: "@ronny"
    notes: >
      Standalone quote intake form at customer.mintprints.co. Posts to files-api seeds API,
      uploads to MinIO. Source code at ~/code/mint-modules/quote-page/, deployed to
      docker-host:~/quote-page/. Replaced stale mint-os-customer (Jan 2025 build).

  - stack_id: automation-stack
    name: Automation Stack
    path: proxmox:vm-202
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Proxmox VM 202 running n8n, Ollama, and Open WebUI. Not compose-managed via this repo;
      managed directly on VM. Included for inventory completeness.

  - stack_id: prometheus
    name: Prometheus
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Metrics collection and alerting on observability VM 205.
      Compose at /opt/stacks/prometheus on host.

  - stack_id: grafana
    name: Grafana
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Monitoring dashboards and visualization on observability VM 205.
      Compose at /opt/stacks/grafana on host.

  - stack_id: loki
    name: Loki
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Log aggregation on observability VM 205.
      Compose at /opt/stacks/loki on host.

  - stack_id: uptime-kuma
    name: Uptime Kuma
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Uptime monitoring on observability VM 205.
      Compose at /opt/stacks/uptime-kuma on host.

  - stack_id: node-exporter
    name: Node Exporter
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Host metrics exporter for Prometheus on observability VM 205.
      Compose at /opt/stacks/node-exporter on host.

  - stack_id: caddy-auth
    name: Caddy + Authentik
    path: proxmox:vm-204
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Reverse proxy (Caddy, host network :80) + SSO (Authentik :9000/:9443) on infra-core VM 204.
      Compose at /opt/stacks/caddy-auth on host. Includes authentik-server, authentik-worker,
      authentik-postgres, authentik-redis. Caddy fronts pihole, vaultwarden, infisical with
      Authentik forward auth.

  - stack_id: vaultwarden
    name: Vaultwarden
    path: proxmox:vm-204
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Password vault on infra-core VM 204. Port 8081->80.
      Compose at /opt/stacks/vaultwarden on host.
      Migrated from proxmox-home VM 102 (LOOP-INFRA-VM-RESTRUCTURE-20260206).

  - stack_id: gitea
    name: Gitea
    path: proxmox:vm-206
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Git forge + PostgreSQL on dev-tools VM 206.
      Compose at /opt/stacks/gitea on host.

  - stack_id: ai-consolidation
    name: AI Consolidation
    path: proxmox:vm-207
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Qdrant vector DB + AnythingLLM RAG on ai-consolidation VM 207.
      Compose at /opt/stacks/ai-consolidation on host.
      Migrated off MacBook (LOOP-AI-CONSOLIDATION-20260208).
