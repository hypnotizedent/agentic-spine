# STACK_REGISTRY.yaml
# Status: authoritative
# Last verified: 2026-02-11
# Updated: 2026-02-11
#
# Purpose:
#   Machine-readable SSOT for "what stacks exist" and "which compose files are authoritative entrypoints".
#
# Notes:
#   - Docs-only. Does not change runtime.
#   - This registry should match the compose inventory excluding .archive/ and .worktrees/.
#   - deploy_method values are descriptive; they do not imply automation.
#   - Compose files live in workbench; this registry lives in spine.
#
# External ownership:
#   Canonical registry lives in spine; config files live in workbench.

source_repo: workbench
source_root: "~/code/workbench"

version: 1

exclusions:
  - .archive/**
  - .worktrees/**

stack_roots:
  - infra/**
  - finance/**
  - media-stack/**
  - modules/**

stacks:
  - stack_id: mint-os
    name: Mint OS (docker-host)
    repo: workbench
    path: infra/compose/mint-os
    compose_files:
      - docker-host:~/stacks/mint-os/docker-compose.yml
    deploy_method: ci_docker_host_runner
    deploy_notes:
      runner: docker-host
      default_stack_dir: ~/stacks/mint-os
      pattern: docker compose restart <service>
    status: active
    owner: "@ronny"
    notes: >
      Single compose file on docker-host. MinIO is inline (not separate file).
      minio joins storage-network + mint-os-network. Volume: /mnt/docker/mint-os-data/minio.
      Fixed 2026-02-10 (LOOP-MINIO-VOLUME-PATH-DIVERGENCE-20260210).

  - stack_id: finance
    name: Finance
    repo: workbench
    path: finance
    compose_files:
      - finance/docker-compose.yml
    deploy_method: manual_vm
    deploy_target: proxmox:vm-211
    status: active
    owner: "@ronny"
    notes: >
      Live on finance-stack VM 211 (LOOP-FINANCE-VM-SEPARATION-20260211).
      Services: Firefly III, Paperless-ngx, Ghostfolio, Mail Archiver (isolated DB),
      PostgreSQL 16, Redis 7. Compose at /opt/stacks/finance on host.
      Legacy docker-host finance/mail-archiver stopped and decommissioned.

  - stack_id: media-stack
    name: Media Stack (Legacy Monolith)
    repo: workbench
    path: media-stack
    compose_files:
      - media-stack/docker-compose.yml
    deploy_method: manual_or_host
    status: decommissioned
    owner: "@ronny"
    notes: >
      DECOMMISSIONED 2026-02-10. VM 201 destroyed (qm destroy --purge),
      ZFS dataset tank/docker/media-stack removed (24.1G reclaimed).
      Split into download-stack (VM 209) and streaming-stack (VM 210)
      per LOOP-MEDIA-STACK-SPLIT-20260208.

  - stack_id: download-stack
    name: Download Stack
    path: proxmox:vm-209
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Download services (SABnzbd, *arr, Tdarr, CrowdSec) on VM 209.
      Compose at /opt/stacks/download-stack on host.
      Migrated from media-stack (LOOP-MEDIA-STACK-SPLIT-20260208).

  - stack_id: streaming-stack
    name: Streaming Stack
    path: proxmox:vm-210
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Streaming services (Jellyfin, Navidrome, Jellyseerr, Bazarr) on VM 210.
      Compose at /opt/stacks/streaming-stack on host.
      Migrated from media-stack (LOOP-MEDIA-STACK-SPLIT-20260208).

  - stack_id: immich
    name: Immich
    path: proxmox:vm-203
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Photo management (4 containers: server, ML, PostgreSQL, Redis) on VM 203.
      Compose at ~/immich/docker-compose.yml on host (user: ubuntu).
      135K+ assets, 3TB library, 4 users. Classified as Stack per
      LOOP-IMMICH-LEGACY-EXTRACTION-20260211 (upgraded from Utility).

  - stack_id: cloudflare-tunnel
    name: Cloudflare Tunnel
    repo: workbench
    path: infra/cloudflare/tunnel
    compose_files:
      - infra/cloudflare/tunnel/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: dashy
    name: Dashy
    repo: workbench
    path: infra/compose/dashy
    compose_files:
      - infra/compose/dashy/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: "Visual runtime map of spine services. Deployed to docker-host ~/stacks/dashy/. CF tunnel: dash.ronny.works."

  - stack_id: mcpjungle
    name: MCP Jungle
    repo: workbench
    path: infra/compose/mcpjungle
    compose_files:
      - infra/compose/mcpjungle/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: n8n
    name: n8n
    repo: workbench
    path: infra/compose/n8n
    compose_files:
      - infra/compose/n8n/docker-compose.yml
    deploy_method: manual_or_host
    status: active
    owner: "@ronny"
    notes: ""

  - stack_id: pihole
    name: Pi-hole
    path: proxmox:vm-204
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      DNS sinkhole on infra-core VM 204. Compose at /opt/stacks/pihole on host.
      Part of caddy-auth stack (Caddy fronts pihole with Authentik forward auth).

  - stack_id: secrets
    name: Secrets (Infisical)
    path: proxmox:vm-204
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Infisical secrets manager on infra-core VM 204. Compose at /opt/stacks/secrets on host.
      Part of caddy-auth stack (Caddy fronts infisical with Authentik forward auth).

  - stack_id: storage
    name: Storage (MinIO standalone)
    repo: workbench
    path: infra/compose/storage
    compose_files:
      - infra/compose/storage/docker-compose.yml
    deploy_method: manual_or_host
    status: reference-only
    owner: "@ronny"
    notes: >
      Workbench reference compose for standalone MinIO architecture.
      NOT deployed â€” live MinIO is still inline in mint-os compose on docker-host.
      Volume path: /mnt/docker/storage/minio (symlink to /mnt/docker/mint-os-data/minio).
      See LOOP-MINIO-VOLUME-PATH-DIVERGENCE-20260210.

  - stack_id: templates
    name: Templates (non-deploy)
    repo: workbench
    path: infra/templates
    compose_files:
      - infra/templates/docker-compose.template.yml
    deploy_method: none_template_only
    status: template
    owner: "@ronny"
    notes: >
      Template compose file(s) used for reference. Not intended for deployment.

  - stack_id: artwork-module
    name: Artwork Module (files-api)
    source: mint-modules/artwork
    compose_files:
      - docker-host:~/artwork-module/docker-compose.yml
    deploy_method: manual_compose
    status: active
    owner: "@ronny"
    fresh_slate_target: mint-apps VM (ADR-001)
    notes: >
      Standalone artwork/files API. Seeds intake, asset management, presigned URLs.
      Source code at ~/code/mint-modules/artwork/. Currently deployed to docker-host (interim).
      Fresh-slate target: mint-apps VM with mint-data VM for postgres+minio (ADR-001).

  - stack_id: quote-page
    name: Quote Page (customer intake)
    source: mint-modules/quote-page
    compose_files:
      - docker-host:~/quote-page/docker-compose.yml
    deploy_method: manual_compose
    status: active
    owner: "@ronny"
    fresh_slate_target: mint-apps VM (ADR-001)
    notes: >
      Standalone quote intake form at customer.mintprints.co. Posts to files-api seeds API,
      uploads to MinIO. Source code at ~/code/mint-modules/quote-page/. Currently deployed
      to docker-host (interim). Fresh-slate target: mint-apps VM (ADR-001).

  - stack_id: automation-stack
    name: Automation Stack
    path: proxmox:vm-202
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Proxmox VM 202 running n8n, Ollama, and Open WebUI. Not compose-managed via this repo;
      managed directly on VM. Included for inventory completeness.

  - stack_id: prometheus
    name: Prometheus
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Metrics collection and alerting on observability VM 205.
      Compose at /opt/stacks/prometheus on host.

  - stack_id: grafana
    name: Grafana
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Monitoring dashboards and visualization on observability VM 205.
      Compose at /opt/stacks/grafana on host.

  - stack_id: loki
    name: Loki
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Log aggregation on observability VM 205.
      Compose at /opt/stacks/loki on host.

  - stack_id: uptime-kuma
    name: Uptime Kuma
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Uptime monitoring on observability VM 205.
      Compose at /opt/stacks/uptime-kuma on host.

  - stack_id: node-exporter
    name: Node Exporter
    path: proxmox:vm-205
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Host metrics exporter for Prometheus on observability VM 205.
      Compose at /opt/stacks/node-exporter on host.

  - stack_id: caddy-auth
    name: Caddy + Authentik
    path: proxmox:vm-204
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Reverse proxy (Caddy, host network :80) + SSO (Authentik :9000/:9443) on infra-core VM 204.
      Compose at /opt/stacks/caddy-auth on host. Includes authentik-server, authentik-worker,
      authentik-postgres, authentik-redis. Caddy fronts pihole, vaultwarden, infisical with
      Authentik forward auth.

  - stack_id: vaultwarden
    name: Vaultwarden
    path: proxmox:vm-204
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Password vault on infra-core VM 204. Port 8081->80.
      Compose at /opt/stacks/vaultwarden on host.
      Migrated from proxmox-home VM 102 (LOOP-INFRA-VM-RESTRUCTURE-20260206).

  - stack_id: gitea
    name: Gitea
    path: proxmox:vm-206
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Git forge + PostgreSQL on dev-tools VM 206.
      Compose at /opt/stacks/gitea on host.

  - stack_id: ai-consolidation
    name: AI Consolidation
    path: proxmox:vm-207
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Qdrant vector DB + AnythingLLM RAG on ai-consolidation VM 207.
      Compose at /opt/stacks/ai-consolidation on host.
      Migrated off MacBook (LOOP-AI-CONSOLIDATION-20260208).

  - stack_id: finance
    name: Finance Stack
    path: proxmox:vm-211
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Firefly III + Paperless-ngx + Ghostfolio + Mail Archiver on finance-stack VM 211.
      Compose at /opt/stacks/finance on host.
      Migrated from docker-host (LOOP-FINANCE-VM-SEPARATION-20260211).

  - stack_id: mint-data
    name: Mint Data Plane
    path: proxmox:vm-212
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      PostgreSQL 16 + MinIO + Redis on mint-data VM 212.
      Compose at /opt/stacks/mint-data on host.
      Fresh-slate (LOOP-MINT-FRESH-SLATE-INFRA-BOOTSTRAP-20260212).

  - stack_id: mint-apps
    name: Mint App Plane
    path: proxmox:vm-213
    compose_files: []
    deploy_method: manual_vm
    status: active
    owner: "@ronny"
    notes: >
      Artwork + quote-page + order-intake on mint-apps VM 213.
      Compose at /opt/stacks/mint-apps on host.
      Fresh-slate (LOOP-MINT-FRESH-SLATE-INFRA-BOOTSTRAP-20260212).
