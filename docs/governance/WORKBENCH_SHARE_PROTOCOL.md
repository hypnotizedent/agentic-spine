---
status: authoritative
owner: "@ronny"
last_verified: 2026-02-13
scope: workbench-share-governance
---

# Workbench Share Protocol

> **Purpose:** Define the governance model for publishing curated workbench content
> to a private GitHub share channel while maintaining Gitea as the canonical source.
>
> **Authority:** This document establishes the one-way publish flow and security
> boundaries for the workbench share channel.

---

## 1. Authority Model

### Canonical Source

| Attribute | Value |
|-----------|-------|
| **Canonical Repository** | Gitea (`~/code/agentic-spine`) |
| **Canonical Remote** | Gitea (origin) |
| **Share Channel** | GitHub private repository (mirror-only, curated) |

### Key Principle

**Gitea is the single source of truth.** The GitHub share channel is a downstream,
curated copy for selective sharing. It is NOT:
- A development environment
- A backup mechanism
- A bidirectional sync target
- A replacement for Gitea authority

---

## 2. One-Way Publish Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                     GITEA CANONICAL                              │
│                  ~/code/agentic-spine                           │
│                         │                                        │
│                    ┌────▼────┐                                   │
│                    │ PUBLISH │  ◄── share.publish capability     │
│                    │  GATE   │      (allowlist + denylist scan)  │
│                    └────┬────┘                                   │
│                         │                                        │
│                         ▼                                        │
│              ┌─────────────────────┐                             │
│              │  CURATED PAYLOAD    │                             │
│              │ (filtered, safe)    │                             │
│              └──────────┬──────────┘                             │
│                         │                                        │
└─────────────────────────┼───────────────────────────────────────┘
                          │
                          ▼ (push)
┌─────────────────────────────────────────────────────────────────┐
│                     GITHUB SHARE                                 │
│              (private repository)                                │
│                                                                  │
│   • Read-only for external collaborators                        │
│   • No direct commits accepted                                  │
│   • Changes flow through spine proposals only                   │
└─────────────────────────────────────────────────────────────────┘
```

### Publish Flow Steps (Capability-Driven)

1. **Pre-flight Check** — `./bin/ops cap run share.publish.preflight`
   - Verify clean git state in spine
   - Confirm governance bindings exist (allowlist, denylist, remote)
   - Verify share remote is configured (`git remote add share <url>`)
   - Confirm share capabilities registered

2. **Content Preview** — `./bin/ops cap run share.publish.preview`
   - Apply allowlist: only approved paths may be published
   - Apply denylist: exclude secrets, identity, private infra
   - Scan candidate files against secret/credential/identity patterns
   - Report blocked files and publishable count

3. **Publish Execution** — `./bin/ops cap run share.publish.apply --execute`
   - Default is dry-run (shows what would be pushed)
   - With `--execute`: pushes curated allowlisted payload to share remote
   - Receipt auto-generated by capability system

4. **Post-publish Verification**
   - Confirm GitHub reflects expected state
   - Review receipt in spine ledger

---

## 3. Security Boundaries

### What Can Be Shared

Content suitable for the share channel includes:

| Category | Examples |
|----------|----------|
| **Public patterns** | Reusable scripts, compose templates, configurations |
| **Documentation** | Runbooks, policies, architecture diagrams (sanitized) |
| **Tooling** | Helper scripts, utility functions, makefiles |
| **Templates** | Project scaffolds, boilerplate configurations |

### What Must NEVER Be Shared

| Category | Excluded Content | Reason |
|----------|-----------------|--------|
| **Secrets** | API keys, tokens, passwords, private keys | Security critical |
| **Machine Identity** | Hostnames, local usernames, machine-specific paths | Privacy/OPSEC |
| **Private Infrastructure** | Internal IPs, VLAN configs, private host inventory | Security critical |
| **Local Runtime** | launchd configs, local overlays, user-specific settings | Machine-specific |
| **Credentials** | Database URLs with embedded auth, service tokens | Security critical |

### Deny Patterns (Enforced)

The denylist scanner checks for these patterns:

```yaml
deny_patterns:
  - "ghp_[a-zA-Z0-9]+"           # GitHub personal access tokens
  - "gho_[a-zA-Z0-9]+"           # GitHub OAuth tokens
  - "ghu_[a-zA-Z0-9]+"           # GitHub user tokens
  - "ghs_[a-zA-Z0-9]+"           # GitHub server tokens
  - "ghr_[a-zA-Z0-9]+"           # GitHub refresh tokens
  - "github_pat_[a-zA-Z0-9_-]+"  # GitHub fine-grained tokens
  - "BEGIN.*PRIVATE KEY"         # Private key markers
  - "api[_-]?key\\s*[=:]"        # API key assignments
  - "postgres://.*:.*@"          # PostgreSQL URLs with credentials
  - "mysql://.*:.*@"             # MySQL URLs with credentials
  - "mongodb\\+srv://.*:.*@"     # MongoDB URLs with credentials
  - "password\\s*[=:]"           # Password assignments
  - "secret\\s*[=:]"             # Secret assignments
  - "token\\s*[=:]"              # Token assignments
```

---

## 4. Roles and Responsibilities

### Terminal C (Owner)

| Responsibility | Description |
|----------------|-------------|
| **Maintain allowlist** | Define which paths are safe to share |
| **Maintain denylist** | Define patterns that must never be published |
| **Review publish receipts** | Verify published content matches expectations |
| **Handle escalations** | Respond to security or content concerns |

### Reviewer (External Collaborator)

| Responsibility | Description |
|----------------|-------------|
| **Read-only access** | View shared content, no direct edits |
| **Feedback channel** | Suggest changes via issues/PRs to spine |
| **No merge authority** | All changes flow through spine proposals |

### Approver (Owner Only)

| Responsibility | Description |
|----------------|-------------|
| **Publish approval** | Authorize publish operations |
| **Emergency rollback** | Revert share channel to last known good |
| **Access management** | Grant/revoke collaborator access |

---

## 5. Publish Checklist

Before each publish operation:

- [ ] Spine repo is clean (`git status` shows no uncommitted changes)
- [ ] `spine.verify` passes (all drift gates green)
- [ ] All changes committed to Gitea canonical
- [ ] Allowlist reviewed (no new risky paths added)
- [ ] Denylist scan passes (no blocked patterns found)
- [ ] Receipt generated and reviewed
- [ ] GitHub share remote accessible

After publish:

- [ ] Confirm GitHub reflects expected state
- [ ] Receipt recorded in ledger
- [ ] Verify no sensitive content leaked

---

## 6. Rollback Procedure

If sensitive content is accidentally published:

1. **Immediate**: Rotate any exposed credentials
2. **GitHub**: Force push previous known-good commit
3. **Spine**: Audit what was exposed, update denylist
4. **Receipt**: Document incident in ledger
5. **Review**: Update this protocol with lessons learned

---

## 7. Non-Goals

This protocol explicitly does NOT address:

| Non-Goal | Reason |
|----------|--------|
| **Bidirectional sync** | Gitea is canonical; GitHub is downstream only |
| **Real-time mirroring** | Publish is manual/intentional, not automatic |
| **Full repository mirror** | Share channel is curated, not complete |
| **CI/CD integration** | Publish is governed operation, not automated |
| **Secret management** | Secrets belong in Infisical, not share channel |

---

## 8. Related Documents

| Document | Relationship |
|----------|--------------|
| `share.publish.allowlist.yaml` | Paths allowed for publishing |
| `share.publish.denylist.yaml` | Patterns blocked from publishing |
| `share.publish.remote.yaml` | Remote contract binding (one-way, manual, dry-run default) |
| `GIT_REMOTE_AUTHORITY.md` | Gitea canonical authority model (includes share-channel rule) |
| `SECRETS_POLICY.md` | Secrets management governance |
| `LEGACY_DEPRECATION.md` | External repository reference rules |
| `VERIFY_SURFACE_INDEX.md` | D82 share publish governance lock |

---

## 9. Workbench Path Governance

The canonical workbench path is defined in the binding layer:

    ops/bindings/host.audit.allowlist.yaml → workbench_root

All governance documents, capability definitions, and automation scripts should reference the workbench through this binding rather than hardcoding paths directly. This prevents path drift when infrastructure moves.

**Current binding:** `workbench_root: "/Users/ronnyworks/code/workbench"`

> **Note:** 137 existing docs reference ~/code/workbench directly. These are grandfathered. New docs and updates should use the binding reference or relative paths.

---

## Changelog

| Date | Change |
|------|--------|
| 2026-02-13 | Add workbench path governance section |
| 2026-02-13 | Initial creation of share protocol |
