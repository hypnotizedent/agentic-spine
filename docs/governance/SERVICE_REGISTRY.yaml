# SERVICE_REGISTRY.yaml - Machine-readable infrastructure truth
# Status: authoritative
# Last verified: 2026-02-05
# Updated: 2026-02-07
#
# Host IPs: Canonical source is DEVICE_IDENTITY_SSOT.md
#           This registry defines WHAT services exist and WHERE they run.
#
# External ownership:
#   Canonical registry lives in spine; config files live in workbench.
#   This registry defines WHAT services exist and WHERE they run.
#   Compose files and deployment configs are workbench-owned.

source_repo: workbench
source_root: "~/code/workbench"

services:
  mint-os-api:
    host: docker-host
    port: 3335
    health: /health
    compose: ~/stacks/mint-os/docker-compose.yml
    secrets_project: mint-os-api

  mint-os-postgres:
    host: docker-host
    port: 15432
    container: mint-os-postgres
    compose: ~/stacks/mint-os/docker-compose.yml

  minio:
    host: docker-host
    port: 9000
    console_port: 9001
    health: /minio/health
    compose: ~/stacks/mint-os/docker-compose.yml

  cloudflared:
    host: infra-core
    compose: /opt/stacks/cloudflared/docker-compose.yml
    container: homelab-cloudflared
    notes: "Cloudflare tunnel connector (homelab-tunnel)"

  pihole:
    host: infra-core
    port: 8053
    dns_port: 53
    health: /admin
    compose: /opt/stacks/pihole/docker-compose.yml
    container: pihole
    notes: "Network-wide DNS ad-blocking. Web UI moved to 8053 (Caddy owns 80)."

  infisical:
    host: infra-core
    port: 8088
    health: /api/status
    compose: /opt/stacks/secrets/docker-compose.yml
    container: infisical
    secrets_project: infrastructure
    notes: "Secrets manager (relocated from docker-host)"

  vaultwarden:
    host: infra-core
    port: 8081
    health: /alive
    container: vaultwarden
    notes: "Password manager (relocated from proxmox-home VM 102, soak)"

  caddy:
    host: infra-core
    port: 80
    container: caddy
    compose: /opt/stacks/caddy-auth/docker-compose.yml
    notes: "Reverse proxy (HTTP only â€” CF tunnel handles public TLS)"

  authentik:
    host: infra-core
    port: 9000
    health: /if/flow/initial-setup/
    container: authentik-server
    compose: /opt/stacks/caddy-auth/docker-compose.yml
    secrets_project: infrastructure
    public_url: https://auth.ronny.works
    notes: "SSO/Authentication. Initial setup required at first login."

  anythingllm:
    host: macbook
    port: 3002
    health: /api/health

  qdrant:
    host: macbook
    port: 6333
    health: /health

hosts:
  docker-host:
    tailscale_ip: 100.92.156.118
    ssh: docker-host
    os: unraid

  infra-core:
    tailscale_ip: 100.92.91.128
    ssh: infra-core
    os: ubuntu-24.04
    vmid: 204
    proxmox_host: pve

  proxmox-home:
    tailscale_ip: 100.103.99.62
    ssh: proxmox-home
    os: debian-12
    notes: "Beelink Mini - home hypervisor"

  macbook:
    # IP source: DEVICE_IDENTITY_SSOT.md (canonical for host/IPs)
    tailscale_ip: 100.85.186.7
    ssh: localhost
    os: macos

infisical_projects:
  mint-os-api: 6c67b03e-ed17-4154-9a94-59837738e432
  infrastructure: 01ddd93a-e0f8-4c7c-ad9f-903d76ef94d9
