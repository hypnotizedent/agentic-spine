# SERVICE_REGISTRY.yaml - Machine-readable infrastructure truth
# Status: authoritative
# Last verified: 2026-02-11
# Updated: 2026-02-11
#
# Host IPs: Canonical source is DEVICE_IDENTITY_SSOT.md
#           This registry defines WHAT services exist and WHERE they run.
#
# Scope policy:
#   IN SCOPE:  Shop-hosted services (pve VMs, docker-host). These have
#              health bindings, docker compose targets, and SLA expectations.
#   OUT OF SCOPE: Home-site services (proxmox-home, pihole-home, download-home,
#              hass). These are secondary/personal, Tailscale-only, no SLA.
#              Tracked in ssh.targets.yaml for connectivity checks only.
#   Decision: LOOP-HOME-SERVICE-REGISTRY-SCOPE-DECISION-20260210 (2026-02-10).
#
# External ownership:
#   Canonical registry lives in spine; config files live in workbench.
#   This registry defines WHAT services exist and WHERE they run.
#   Compose files and deployment configs are workbench-owned.
#
# Internal dependency policy:
#   Internal-only containers (no published ports, no user traffic) are implicitly
#   covered by their parent stack entry. Examples: authentik-worker, authentik-postgres,
#   authentik-redis (part of caddy-auth stack), infisical-db, infisical-redis (part of
#   secrets stack). These do NOT need individual SERVICE_REGISTRY entries.
#
# Status values:
#   active      — running, serving traffic
#   deprecated  — marked for decommission, may still be running with dependents
#   parked      — intentionally stopped (operator decision, not a failure)
#   stopped     — crashed or exited unexpectedly, no health monitoring

source_repo: workbench
source_root: "~/code/workbench"

services:
  mint-os-api:
    host: docker-host
    port: 3335
    health: /health
    container: mint-os-dashboard-api
    compose: ~/stacks/mint-os/docker-compose.yml
    secrets_project: mint-os-api
    status: deprecated
    notes: "DEPRECATED — container name is mint-os-dashboard-api. Health probe disabled. Still running (serves traffic on :3335) but pending decommission."

  mint-os-postgres:
    host: docker-host
    port: 15432
    container: mint-os-postgres
    compose: ~/stacks/mint-os/docker-compose.yml
    status: deprecated
    notes: "DEPRECATED — still running with active dependents (files-api, quote-page, MCPJungle postgres MCP). Decommission blocked until dependents migrate."

  # ─── Mint OS Frontends (docker-host) — active, running ──────────────
  mint-os-admin:
    host: docker-host
    port: 3333
    container: mint-os-admin
    compose: ~/stacks/mint-os/docker-compose.frontends.yml
    status: active
    notes: "Mint OS admin frontend."

  mint-os-customer:
    host: docker-host
    port: 3334
    container: mint-os-customer
    compose: ~/stacks/mint-os/docker-compose.frontends.yml
    status: active
    notes: "Mint OS customer frontend."

  mint-os-production:
    host: docker-host
    port: 3336
    container: mint-os-production
    compose: ~/stacks/mint-os/docker-compose.frontends.yml
    status: active
    notes: "Mint OS production frontend."

  mint-os-kanban:
    host: docker-host
    port: 3337
    container: mint-os-kanban
    compose: ~/stacks/mint-os/docker-compose.frontends.yml
    status: active
    notes: "Mint OS kanban board."

  mint-os-job-estimator:
    host: docker-host
    port: 3001
    container: mint-os-job-estimator
    compose: ~/stacks/mint-os/docker-compose.frontends.yml
    status: active
    notes: "Mint OS job estimator service."

  mint-os-redis:
    host: docker-host
    port: 16379
    container: mint-os-redis
    compose: ~/stacks/mint-os/docker-compose.yml
    status: active
    notes: "Redis for mint-os apps."

  minio:
    host: docker-host
    port: 9000
    console_port: 9001
    health: /minio/health/live
    compose: ~/stacks/storage/docker-compose.yml
    volume: /mnt/docker/mint-os-data/minio
    networks: [storage-network, mint-os-network]
    status: active
    notes: >
      8 buckets (86k+ objects). Canonical via storage stack — decoupled from mint-os
      app compose (LOOP-MINT-MINIO-FRESH-SLATE-CUTOVER-20260212). Volume on NFS.
      Consumers: artwork-module (files-api), quote-page, dashboard-api, presigned URLs.

  cloudflared:
    host: infra-core
    compose: /opt/stacks/cloudflared/docker-compose.yml
    container: homelab-cloudflared
    notes: "Cloudflare tunnel connector (homelab-tunnel)"

  pihole:
    host: infra-core
    port: 8053
    dns_port: 53
    health: /admin
    compose: /opt/stacks/pihole/docker-compose.yml
    container: pihole
    notes: "Network-wide DNS ad-blocking. Web UI moved to 8053 (Caddy owns 80)."

  infisical:
    host: infra-core
    port: 8088
    health: /api/status
    compose: /opt/stacks/secrets/docker-compose.yml
    container: infisical
    secrets_project: infrastructure
    notes: "Secrets manager (relocated from docker-host)"

  vaultwarden:
    host: infra-core
    port: 8081
    health: /alive
    compose: /opt/stacks/vaultwarden/docker-compose.yml
    container: vaultwarden
    notes: "Password manager (relocated from proxmox-home VM 102, soak)"

  caddy:
    host: infra-core
    port: 80
    container: caddy
    compose: /opt/stacks/caddy-auth/docker-compose.yml
    notes: "Reverse proxy (HTTP only — CF tunnel handles public TLS)"

  authentik:
    host: infra-core
    port: 9000
    health: /if/flow/initial-setup/
    container: authentik-server
    compose: /opt/stacks/caddy-auth/docker-compose.yml
    secrets_project: infrastructure
    public_url: https://auth.ronny.works
    notes: "SSO/Authentication. Initial setup required at first login."

  # ─── Dashy (docker-host) ──────────────────────────────────────────
  dashy:
    host: docker-host
    port: 4000
    health: /
    compose: ~/stacks/dashy/docker-compose.yml
    container: dashy
    status: active
    public_url: https://dash.ronny.works
    notes: "Visual runtime map of all spine-managed services. Lissy93/dashy, CF tunnel routed."

  # ─── Mint Modules (docker-host — interim; fresh-slate target: mint-apps VM) ──
  files-api:
    host: docker-host
    port: 3500
    health: /health
    source: mint-modules/artwork
    compose: ~/artwork-module/docker-compose.yml
    container: files-api
    networks: [storage-network, mint-os-network]
    status: active
    fresh_slate_target: mint-apps VM (ADR-001)
    notes: >
      Artwork module API. Seeds intake, asset management, presigned URLs.
      Currently on docker-host (interim). Fresh-slate target: mint-apps VM
      with postgres+minio on mint-data VM. See ADR-001 in mint-modules.

  quote-page:
    host: docker-host
    port: 3341
    health: /health
    source: mint-modules/quote-page
    compose: ~/quote-page/docker-compose.yml
    container: quote-page
    networks: [storage-network, mint-os-network]
    status: active
    public_url: https://customer.mintprints.co
    fresh_slate_target: mint-apps VM (ADR-001)
    notes: >
      Quote intake form at customer.mintprints.co. Posts to files-api seeds
      API, uploads to MinIO. Currently on docker-host (interim).
      Fresh-slate target: mint-apps VM (ADR-001).

  # ─── Automation Stack (VM 202) ────────────────────────────────────
  n8n:
    host: automation-stack
    port: 5678
    health: /healthz
    compose: /home/automation/stacks/automation/docker-compose.yml
    container: n8n
    notes: "Workflow automation (VM 202)."

  open-webui:
    host: automation-stack
    port: 3000
    health: /
    compose: /home/automation/stacks/automation/docker-compose.yml
    container: open-webui
    notes: "Web UI for Ollama (VM 202). Host port 3000 -> container 8080."

  ollama:
    host: automation-stack
    port: 11434
    compose: /home/automation/stacks/automation/docker-compose.yml
    container: ollama
    notes: "Local model runtime (VM 202)."

  automation-postgres:
    host: automation-stack
    port: 5432
    compose: /home/automation/stacks/automation/docker-compose.yml
    container: automation-postgres
    notes: "Postgres for n8n (internal-only; not exposed on host)."

  automation-redis:
    host: automation-stack
    port: 6379
    compose: /home/automation/stacks/automation/docker-compose.yml
    container: automation-redis
    notes: "Redis for automation stack (internal-only; not exposed on host)."

  mcpjungle:
    host: automation-stack
    port: 8080
    health: /health
    compose: ~/stacks/mcpjungle/docker-compose.yml
    container: mcpjungle
    notes: "MCP gateway/runtime (migrated off docker-host to automation-stack tooling plane)."

  prometheus:
    host: observability
    port: 9090
    health: /-/healthy
    compose: /opt/stacks/prometheus/docker-compose.yml
    container: prometheus
    notes: "Metrics collection and alerting"

  grafana:
    host: observability
    port: 3000
    health: /api/health
    compose: /opt/stacks/grafana/docker-compose.yml
    container: grafana
    notes: "Monitoring dashboards and visualization"

  loki:
    host: observability
    port: 3100
    health: /ready
    compose: /opt/stacks/loki/docker-compose.yml
    container: loki
    notes: "Log aggregation"

  uptime-kuma:
    host: observability
    port: 3001
    health: /
    compose: /opt/stacks/uptime-kuma/docker-compose.yml
    container: uptime-kuma
    notes: "Uptime monitoring"

  node-exporter:
    host: observability
    port: 9100
    health: /metrics
    compose: /opt/stacks/node-exporter/docker-compose.yml
    container: node-exporter
    notes: "Host metrics exporter for Prometheus"

  gitea:
    host: dev-tools
    port: 3000
    ssh_port: 2222
    health: /api/healthz
    compose: /opt/stacks/gitea/docker-compose.yml
    container: gitea
    secrets_project: infrastructure
    public_url: https://git.ronny.works
    notes: "Git forge (dev-tools VM 206), Authentik SSO"

  gitea-runner:
    host: dev-tools
    container: gitea-runner
    compose: /opt/stacks/gitea/docker-compose.yml
    notes: "Gitea Actions CI runner (Docker-in-Docker)"

  gitea-postgres:
    host: dev-tools
    port: 5432
    container: gitea-postgres
    compose: /opt/stacks/gitea/docker-compose.yml
    notes: "PostgreSQL for Gitea"

  # ─── Download Stack (VM 209) ──────────────────────────────────────
  radarr:
    host: download-stack
    port: 7878
    health: /ping
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: radarr
    notes: "Movie management (migrated from media-stack)"

  sonarr:
    host: download-stack
    port: 8989
    health: /ping
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: sonarr
    notes: "TV management (migrated from media-stack)"

  lidarr:
    host: download-stack
    port: 8686
    health: /ping
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: lidarr
    notes: "Music management (migrated from media-stack)"

  prowlarr:
    host: download-stack
    port: 9696
    health: /ping
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: prowlarr
    notes: "Indexer manager (migrated from media-stack)"

  sabnzbd:
    host: download-stack
    port: 8080
    health: /api?mode=version&output=json
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: sabnzbd
    notes: "Usenet downloader (migrated from media-stack). Health uses API version endpoint (web UI root too slow for probes)."

  tdarr:
    host: download-stack
    port: 8265
    health: /
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: tdarr
    status: parked
    notes: "Transcode automation. Intentionally stopped during soak period. Health probe disabled."

  trailarr:
    host: download-stack
    port: 7667
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: trailarr
    notes: "Trailer management (migrated from media-stack)"

  qbittorrent:
    host: download-stack
    port: 8081
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: qbittorrent
    notes: "BitTorrent client (migrated from media-stack)"

  unpackerr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: unpackerr
    notes: "Archive extraction for downloads (migrated from media-stack)"

  recyclarr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: recyclarr
    notes: "TRaSH guide sync for radarr/sonarr (migrated from media-stack)"

  flaresolverr:
    host: download-stack
    port: 8191
    health: /health
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: flaresolverr
    notes: "Cloudflare challenge solver for indexers (migrated from media-stack)"

  slskd:
    host: download-stack
    port: 5030
    p2p_port: 50300
    health: /metrics
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: slskd
    status: parked
    notes: "Soulseek client (soularr dependency). Localhost-bound; intentionally stopped. Health probe disabled."

  soularr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: soularr
    notes: "Soulseek integration for lidarr (migrated from media-stack)"

  swaparr-radarr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: swaparr-radarr
    notes: "Stalled download swapper for radarr (migrated from media-stack)"

  swaparr-sonarr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: swaparr-sonarr
    status: active
    notes: "Stalled download swapper for sonarr. Recovered — running as of 2026-02-11."

  swaparr-lidarr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: swaparr-lidarr
    status: active
    notes: "Stalled download swapper for lidarr. Recovered — running as of 2026-02-11."

  posterizarr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: posterizarr
    notes: "Poster art management (migrated from media-stack)"

  decypharr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: decypharr
    notes: "Real-Debrid integration (migrated from media-stack)"

  huntarr:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: huntarr
    status: stopped
    notes: "Missing media hunter. Exited (255) — crashed, no health monitoring."

  autopulse:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: autopulse
    notes: "Library refresh trigger for Jellyfin (migrated from media-stack, cross-VM to VM 210)"

  crosswatch:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: crosswatch
    notes: "Cross-service watch sync (migrated from media-stack)"

  crowdsec:
    host: download-stack
    compose: /opt/stacks/download-stack/docker-compose.yml
    container: crowdsec
    notes: "Security monitoring (migrated from media-stack)"

  watchtower-download:
    host: download-stack
    container: watchtower
    compose: /opt/stacks/download-stack/docker-compose.yml
    status: active
    notes: "Auto-update utility. Requires DOCKER_API_VERSION=1.45 on Docker CE 29.x. No health probe (infrastructure sidecar)."

  download-node-exporter:
    host: download-stack
    port: 9100
    health: /metrics
    container: node-exporter
    compose: /opt/stacks/download-stack/docker-compose.yml
    status: active
    notes: "Host metrics exporter for Prometheus on download-stack."

  # ─── Streaming Stack (VM 210) ───────────────────────────────────────
  jellyfin:
    host: streaming-stack
    port: 8096
    health: /health
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: jellyfin
    notes: "Video streaming (migrated from media-stack)"

  navidrome:
    host: streaming-stack
    port: 4533
    health: /ping
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: navidrome
    notes: "Music streaming (migrated from media-stack)"

  jellyseerr:
    host: streaming-stack
    port: 5055
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: jellyseerr
    notes: "Media request management (migrated from media-stack)"

  bazarr:
    host: streaming-stack
    port: 6767
    health: /ping
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: bazarr
    notes: "Subtitle management (migrated from media-stack)"

  homarr:
    host: streaming-stack
    port: 7575
    health: /
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: homarr
    notes: "Dashboard (migrated from media-stack)"

  wizarr:
    host: streaming-stack
    port: 5690
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: wizarr
    notes: "Media server invitation management (migrated from media-stack)"

  spotisub:
    host: streaming-stack
    port: 8766
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: spotisub
    notes: "Spotify-to-Navidrome sync (migrated from media-stack)"

  subgen:
    host: streaming-stack
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    container: subgen
    notes: "AI subtitle generation for Jellyfin (migrated from media-stack)"

  watchtower-streaming:
    host: streaming-stack
    container: watchtower
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    status: active
    notes: "Auto-update utility. Requires DOCKER_API_VERSION=1.45 on Docker CE 29.x. No health probe (infrastructure sidecar)."

  streaming-node-exporter:
    host: streaming-stack
    port: 9100
    health: /metrics
    container: node-exporter
    compose: /opt/stacks/streaming-stack/docker-compose.yml
    status: active
    notes: "Host metrics exporter for Prometheus on streaming-stack."

  # ─── Immich (VM 203) ────────────────────────────────────────────────
  immich-server:
    host: immich
    port: 2283
    health: /api/server/ping
    compose: ~/immich/docker-compose.yml
    container: immich_server
    secrets_project: immich
    notes: "Photo management server (VM 203). 135K+ assets, 4 users, 3TB library."

  immich-ml:
    host: immich
    compose: ~/immich/docker-compose.yml
    container: immich_machine_learning
    notes: "Immich ML worker (face recognition, CLIP, OCR). No external port."

  immich-postgres:
    host: immich
    port: 5432
    container: immich_postgres
    compose: ~/immich/docker-compose.yml
    notes: "PostgreSQL for Immich. Daily pg_dump at 03:00, 7-day retention."

  immich-redis:
    host: immich
    container: immich_redis
    compose: ~/immich/docker-compose.yml
    notes: "Redis cache for Immich (ephemeral, regenerated on restart)."

  # ─── Finance Stack (VM 211 — LIVE) ─────────────────
  firefly-iii-vm211:
    host: finance-stack
    port: 8080
    health: /api/v1/about
    compose: /opt/stacks/finance/docker-compose.yml
    container: firefly-iii
    status: active
    notes: "Firefly III on finance-stack VM 211. Live — migrated from docker-host (LOOP-FINANCE-VM-SEPARATION-20260211)."

  firefly-importer-vm211:
    host: finance-stack
    port: 8091
    compose: /opt/stacks/finance/docker-compose.yml
    container: firefly-importer
    status: active
    notes: "Firefly III data importer on finance-stack VM 211."

  firefly-cron-vm211:
    host: finance-stack
    compose: /opt/stacks/finance/docker-compose.yml
    container: firefly-cron
    status: active
    notes: "Firefly III cron job on finance-stack VM 211."

  finance-postgres-vm211:
    host: finance-stack
    port: 5432
    compose: /opt/stacks/finance/docker-compose.yml
    container: firefly-postgres
    status: active
    notes: "PostgreSQL 16 for Firefly III, Ghostfolio, and Paperless on finance-stack VM 211."

  finance-redis-vm211:
    host: finance-stack
    port: 6379
    compose: /opt/stacks/finance/docker-compose.yml
    container: firefly-redis
    status: active
    notes: "Redis 7 for Firefly III on finance-stack VM 211."

  paperless-ngx-vm211:
    host: finance-stack
    port: 8000
    health: /api/
    compose: /opt/stacks/finance/docker-compose.yml
    container: paperless-ngx
    status: active
    notes: "Paperless-ngx document management on finance-stack VM 211. Live — migrated from docker-host."

  ghostfolio-vm211:
    host: finance-stack
    port: 3333
    compose: /opt/stacks/finance/docker-compose.yml
    container: ghostfolio
    status: active
    notes: "Ghostfolio investment tracking on finance-stack VM 211. Live — migrated from docker-host."

  mail-archiver-vm211:
    host: finance-stack
    port: 5100
    health: /
    compose: /opt/stacks/finance/docker-compose.yml
    container: mail-archiver
    status: active
    notes: "Mail Archiver on finance-stack VM 211. Isolated Postgres 17 DB (mail-archiver-db). Bundled with finance stack."

  mail-archiver-db-vm211:
    host: finance-stack
    port: null
    compose: /opt/stacks/finance/docker-compose.yml
    container: mail-archiver-db
    status: active
    notes: "Isolated PostgreSQL 17 for Mail Archiver on finance-stack VM 211. Separate from shared finance postgres."

  # ─── Other ──────────────────────────────────────────────────────────
  anythingllm:
    host: ai-consolidation
    port: 3002
    health: /api/ping
    compose: /opt/stacks/ai-consolidation/docker-compose.yml
    container: ai-consolidation-anythingllm-1
    notes: "Migrated from macbook (LOOP-AI-CONSOLIDATION-20260208)"

  qdrant:
    host: ai-consolidation
    port: 6333
    health: /healthz
    compose: /opt/stacks/ai-consolidation/docker-compose.yml
    container: ai-consolidation-qdrant-1
    notes: "Migrated from macbook (LOOP-AI-CONSOLIDATION-20260208)"

hosts:
  docker-host:
    tailscale_ip: 100.92.156.118
    ssh: docker-host
    os: linux-mint

  automation-stack:
    tailscale_ip: 100.98.70.70
    ssh: automation-stack
    os: ubuntu-24.04
    vmid: 202
    proxmox_host: pve

  infra-core:
    tailscale_ip: 100.92.91.128
    ssh: infra-core
    os: ubuntu-24.04
    vmid: 204
    proxmox_host: pve

  proxmox-home:
    tailscale_ip: 100.103.99.62
    ssh: proxmox-home
    os: debian-12
    notes: "Beelink Mini - home hypervisor"

  observability:
    tailscale_ip: 100.120.163.70
    ssh: observability
    os: ubuntu-24.04
    vmid: 205
    proxmox_host: pve

  dev-tools:
    tailscale_ip: 100.90.167.39
    ssh: dev-tools
    os: ubuntu-24.04
    vmid: 206
    proxmox_host: pve

  immich:
    tailscale_ip: 100.114.101.50
    ssh: immich
    ssh_user: ronny
    os: ubuntu-24.04
    vmid: 203
    proxmox_host: pve
    notes: "Photo management VM. SSH user is 'ronny' (non-standard). GAP-OP-094 network fixed."

  ai-consolidation:
    tailscale_ip: 100.71.17.29
    ssh: ai-consolidation
    os: ubuntu-24.04
    vmid: 207
    proxmox_host: pve

  download-stack:
    tailscale_ip: 100.107.36.76
    ssh: download-stack
    os: ubuntu-24.04
    vmid: 209
    proxmox_host: pve

  streaming-stack:
    tailscale_ip: 100.123.207.64
    ssh: streaming-stack
    os: ubuntu-24.04
    vmid: 210
    proxmox_host: pve

  finance-stack:
    tailscale_ip: 100.76.153.100
    ssh: finance-stack
    os: ubuntu-24.04
    vmid: 211
    proxmox_host: pve
    notes: "Finance VM (Firefly III, Paperless-ngx, Ghostfolio, Mail Archiver). Live — post cutover (LOOP-FINANCE-VM-SEPARATION-20260211)."

  macbook:
    # IP source: DEVICE_IDENTITY_SSOT.md (canonical for host/IPs)
    tailscale_ip: 100.85.186.7
    ssh: localhost
    os: macos

infisical_projects:
  mint-os-api: 6c67b03e-ed17-4154-9a94-59837738e432
  infrastructure: 01ddd93a-e0f8-4c7c-ad9f-903d76ef94d9
