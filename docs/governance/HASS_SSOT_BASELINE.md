---
status: authoritative
owner: "@ronny"
last_verified: 2026-02-15
scope: ha-ssot-baseline
---

# HA SSOT Baseline

> Canonical reference for the Home Assistant single source of truth (SSOT) system.
> The unified baseline at `ops/bindings/ha.ssot.baseline.yaml` is the single file
> a home agent reads to understand the entire HA installation.

## 1. Architecture Overview

The HA SSOT baseline is a two-tier system:

**Tier 1: Sub-Bindings** — Individual domain snapshots generated by capability scripts.
Each sub-binding is authoritative for its domain (addons, automations, devices, etc.).

**Tier 2: Unified Baseline** — `ha.ssot.baseline.yaml` aggregates all sub-bindings into
a single index with summary counts, health metrics, and binding freshness tracking.

### Binding Index

| Binding | Source Capability | Domain |
|---------|-------------------|--------|
| `ha.addons.yaml` | `ha.addons.snapshot` | Supervisor add-ons |
| `ha.automations.yaml` | `ha.automations.snapshot` | Automation entities |
| `ha.helpers.yaml` | `ha.helpers.snapshot` | Helper entities (input_*, counter, timer) |
| `ha.integrations.yaml` | `ha.integrations.snapshot` | Config entries (integrations) |
| `ha.scenes.yaml` | `ha.scenes.snapshot` | Scene entities |
| `ha.scripts.yaml` | `ha.scripts.snapshot` | Script entities |
| `ha.hacs.yaml` | `ha.hacs.snapshot` | HACS repository inventory |
| `ha.entity.state.baseline.yaml` | `ha.entity.state.baseline` | Full entity state dump |
| `ha.device.map.yaml` | `ha.device.map.build` | Device cross-reference map |
| `z2m.devices.yaml` | `ha.z2m.devices.snapshot` | Zigbee2MQTT device registry |
| `zwave.devices.yaml` | `ha.zwave.devices.snapshot` | Z-Wave device list |
| `ha.dashboards.yaml` | `ha.dashboard.snapshot` | Lovelace dashboards (optional) |

### Expected-Unavailable Allowlist

`ha.entity.state.expected-unavailable.yaml` lists entities that are normally unavailable
(TVs off, phones off-network, vacuum docked, dead batteries, etc.). The entity state baseline
cross-references this list to compute `entities_unexpected_unavailable` — the regression signal.

Categories: `lg-tv-standby`, `phone-companion`, `roborock-vacuum`, `zigbee-battery-device`,
`wifi-curtain-offline`, `synology-usb-disk`, `tplink-cloud-offline`, `tuya-bulb-offline`,
`winix-purifier`.

## 2. How to Refresh

### Full Refresh (Recommended)

```bash
# Run all sub-binding snapshots, then build the unified baseline
./bin/ops cap run ha.addons.snapshot
./bin/ops cap run ha.automations.snapshot
./bin/ops cap run ha.helpers.snapshot
./bin/ops cap run ha.integrations.snapshot
./bin/ops cap run ha.scenes.snapshot
./bin/ops cap run ha.scripts.snapshot
./bin/ops cap run ha.hacs.snapshot
./bin/ops cap run ha.entity.state.baseline
./bin/ops cap run ha.device.map.build
./bin/ops cap run ha.z2m.devices.snapshot
./bin/ops cap run ha.zwave.devices.snapshot
./bin/ops cap run ha.ssot.baseline.build
```

### Quick Refresh (Baseline Only)

If sub-bindings are recent enough, rebuild just the unified index:

```bash
./bin/ops cap run ha.ssot.baseline.build
```

### Single Domain Refresh

```bash
./bin/ops cap run ha.automations.snapshot   # then rebuild baseline
./bin/ops cap run ha.ssot.baseline.build
```

## 3. Regression Detection

The baseline provides three regression signals:

1. **Unexpected unavailable entities** — `health.entities_unexpected_unavailable > 0` means
   entities that should be available are now unavailable. If this count increases between
   baseline refreshes, something broke.

2. **Binding staleness** — Each binding in `bindings[]` has `age_days`. If any required
   binding exceeds 14 days, D115 will flag it.

3. **Count drift** — Compare `counts.*` between consecutive baseline builds. Significant
   drops in entity count, integration count, or automation count signal regressions.

### Updating the Expected-Unavailable Allowlist

When a device is intentionally taken offline (e.g., replaced, retired, or moved):

1. Add its entities to `ha.entity.state.expected-unavailable.yaml` with category and reason
2. Re-run `ha.entity.state.baseline` to verify the count drops
3. Commit the allowlist update

When a device comes back online:
1. Remove its entities from the allowlist (optional — extra entries are harmless)
2. Re-run baseline to verify

## 4. Home Agent Daily Workflow

```bash
# 1. Read the baseline (one file = full picture)
cat ops/bindings/ha.ssot.baseline.yaml

# 2. Check health summary
yq '.health' ops/bindings/ha.ssot.baseline.yaml

# 3. Refresh baseline (detects drift since last build)
./bin/ops cap run ha.ssot.baseline.build

# 4. Review unexpected unavailable count
yq '.health.entities_unexpected_unavailable' ops/bindings/ha.ssot.baseline.yaml

# 5. If count > 0, investigate which entities are newly unavailable
# Compare current entity state baseline against previous commit

# 6. Run targeted snapshots for stale domains
./bin/ops cap run ha.automations.snapshot

# 7. Verify gates
./bin/ops cap run spine.verify
```

## 5. Binding Schema Reference

### Unified Baseline (`ha.ssot.baseline.yaml`)

| Field | Type | Description |
|-------|------|-------------|
| `schema_version` | string | Always "1.0" |
| `generated` | ISO 8601 | When this baseline was built |
| `source` | string | Always "ha.ssot.baseline.build" |
| `infrastructure` | object | VM ID, IPs, HA version, supervisor version |
| `coordinators` | object | Zigbee, Z-Wave, Thread coordinator status |
| `counts` | object | Entity/device/addon/integration/automation/etc. totals |
| `health` | object | Unavailable counts, automation status, addon errors |
| `bindings` | list | Each sub-binding with path, exists, generated, age_days |
| `missing_bindings` | list | Required bindings not found on disk (if any) |

### Sub-Binding Common Fields

All sub-bindings share: `schema_version`, `generated`, `source`, `summary`, plus domain-specific data.

## 6. Drift Gate

D115 (`ha-ssot-baseline-freshness`) enforces:
- Baseline file exists and is non-empty
- Generated timestamp is <= 14 days old
- All required sub-bindings exist on disk
- Unexpected unavailable count < 50

Triage: Run `ha.ssot.baseline.build` to refresh.
